function Fog(a,b){function c(a){if(!("center"in a&&a.center))throw"Center cannot be null when constructing a GMFog!";if(g.center=a.center,!("radius"in a&&a.radius))throw"Radius cannot be null when constructing a GMFog!";g.radius=a.radius,"max"in a&&!a.max?g.max=360:g.max=700,"strokeColor"in a&&!a.strokeColor?g.strokeColor=a.strokeColor:g.strokeColor="#080A17","fillColor"in a&&!a.fillColor?g.fillColor=a.fillColor:g.fillColor="#080A17","strokeOpacity"in a&&!a.strokeOpacity?g.strokeOpacity=a.strokeOpacity:g.strokeOpacity=.7,"fillOpacity"in a&&!a.fillOpacity?g.fillOpacity=a.fillOpacity:g.fillOpacity=.7,"strokeWeight"in a&&!a.strokeWeight?g.strokeWeight=a.strokeWeight:g.strokeWeight=.7,"zoomViewAngles"in a&&a.zoomViewAngles?g.zoomviewAngle=a.zoomViewAngles:(g.zoomviewAngle=[],g.zoomviewAngle[1]=Math.PI/6,g.zoomviewAngle[2]=Math.PI/10,g.zoomviewAngle[3]=Math.PI/14),g.visitedColor="#66c2a5",g.visitedOpacity=.3,g.infiniteDistance=1}function d(a){for(var b=a;0>b;)b+=2*Math.PI;for(;b>2*Math.PI;)b-=2*Math.PI;return b}function e(a,b,c){c="undefined"!=typeof c?c:!0;var e=(a+b)/2;return a<Math.PI?b<Math.PI&&a>b&&(e+=Math.PI):b<Math.PI?e+=Math.PI:a>b&&(e+=Math.PI),d(e)}var f={className:"Fog"},g={},h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=null,q=null,r=null,s=null,t=null,u=null,v=0,w=1,x=!0,y=!1,z=0,A=0,B=a;return f.completionRate=function(a){return a="undefined"!=typeof a?a:0,0==a?z:A},f.updateFromPOV=function(a,b,c,f){var C=a.lat(),D=a.lng();x&&(v=c);var E=getPOV(),F=g.zoomviewAngle[E.zoom],G=d(c-v);if(j=d(G-F),k=d(G+F),x?(h=j,i=k):(h>j&&Math.abs(j-h)<w&&(h=j),k>i&&Math.abs(k-i)<w&&(i=k),i>h&&!y&&(y=!0)),z=(i+2*Math.PI-h)/(2*Math.PI),A=(i+2*Math.PI-h-g.zoomviewAngle[1])/(2*Math.PI),z>1&&(z=1),A>1&&(A=1),j=d(j+v),k=d(k+v),y)l=d(e(j,k,!1)+Math.PI),s=[new google.maps.LatLng(C,D),new google.maps.LatLng(C+Math.cos(k),D+Math.sin(k)),new google.maps.LatLng(C+Math.cos(l),D+Math.sin(l)),new google.maps.LatLng(C+Math.cos(j),D+Math.sin(j))],u=[new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance),new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance),new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance),new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance)],t=[new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance),new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance),new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance),new google.maps.LatLng(C+g.infiniteDistance,D+g.infiniteDistance)];else{l=e(j,k,!0);var H=d(h+v),I=d(i+v);n=e(H,j,!0),o=e(k,I,!0),m=e(I,H,!0),u=[new google.maps.LatLng(C,D),new google.maps.LatLng(C+Math.cos(I),D+Math.sin(I)),new google.maps.LatLng(C+Math.cos(m),D+Math.sin(m)),new google.maps.LatLng(C+Math.cos(H),D+Math.sin(H))],s=[new google.maps.LatLng(C,D),new google.maps.LatLng(C+Math.cos(H),D+Math.sin(H)),new google.maps.LatLng(C+Math.cos(n),D+Math.sin(n)),new google.maps.LatLng(C+Math.cos(j),D+Math.sin(j))],t=[new google.maps.LatLng(C,D),new google.maps.LatLng(C+Math.cos(k),D+Math.sin(k)),new google.maps.LatLng(C+Math.cos(o),D+Math.sin(o)),new google.maps.LatLng(C+Math.cos(I),D+Math.sin(I))]}x?(p=new google.maps.Polygon({paths:s,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeWeight:g.strokeWeight,fillColor:g.visitedColor,fillOpacity:g.visitedOpacity,map:B}),q=new google.maps.Polygon({paths:t,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeWeight:g.strokeWeight,fillColor:g.visitedColor,fillOpacity:g.visitedOpacity,map:B}),r=new google.maps.Polygon({paths:u,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeWeight:g.strokeWeight,fillColor:g.fillColor,fillOpacity:g.fillOpacity,map:B}),x=!1):(p.setPath(s),q.setPath(t),r.setPath(u))},f.setProperty=function(a,b){g[a]=b},c(b),f}function ActionStack(a,b){function c(a){svl.ui&&svl.ui.actionStack&&(f=svl.ui.actionStack.redo,g=svl.ui.actionStack.undo,f.css("opacity",.5),g.css("opacity",.5),f.bind("click",d),g.bind("click",e))}function d(){i.disableRedo||("tracker"in svl&&svl.tracker.push("Click_Redo"),h.redo())}function e(){i.disableUndo||("tracker"in svl&&svl.tracker.push("Click_Undo"),h.undo())}var f,g,h={className:"ActionStack"},i={actionStackCursor:0,disableRedo:!1,disableUndo:!1},j={disableRedo:!1,disableUndo:!1},k=[];return h.disableRedo=function(){return j.disableRedo?!1:(i.disableRedo=!0,svl.ui&&svl.ui.actionStack&&f.css("opacity",.5),this)},h.disableUndo=function(){return j.disableUndo?!1:(i.disableUndo=!0,svl.ui&&svl.ui.actionStack&&g.css("opacity",.5),this)},h.enableRedo=function(){return j.disableRedo?!1:(i.disableRedo=!1,svl.ui&&svl.ui.actionStack&&f.css("opacity",1),this)},h.enableUndo=function(){return j.disableUndo?!1:(i.disableUndo=!1,svl.ui&&svl.ui.actionStack&&g.css("opacity",1),this)},h.getStatus=function(a){return a in i||console.warn("You have passed an invalid key for status."),i[a]},h.lockDisableRedo=function(){return j.disableRedo=!0,this},h.lockDisableUndo=function(){return j.disableUndo=!0,this},h.pop=function(){return k.length>0&&(i.actionStackCursor-=1,k.splice(i.actionStackCursor)),this},h.push=function(a,b){var c=["addLabel","deleteLabel"];if(-1===c.indexOf(a))throw h.className+": Illegal action.";var d={action:a,label:b,index:i.actionStackCursor};return 0!==k.length&&k.length>i.actionStackCursor&&k.splice(i.actionStackCursor),k.push(d),i.actionStackCursor+=1,this},h.redo=function(){if(!i.disableRedo){if(k.length>i.actionStackCursor){var a=k[i.actionStackCursor];"addLabel"===a.action?("tracker"in svl&&svl.tracker.push("Redo_AddLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!1)):"deleteLabel"===a.action&&("tracker"in svl&&svl.tracker.push("Redo_RemoveLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!0),a.label.setVisibility("hidden")),i.actionStackCursor+=1}"canvas"in svl&&svl.canvas.clear().render2()}},h.size=function(){return k.length},h.undo=function(){if(!i.disableUndo){if(i.actionStackCursor-=1,i.actionStackCursor>=0){var a=k[i.actionStackCursor];"addLabel"===a.action?("tracker"in svl&&svl.tracker.push("Undo_AddLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!0)):"deleteLabel"===a.action&&("tracker"in svl&&svl.tracker.push("Undo_RemoveLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!1),a.label.setVisibility("visible"))}else i.actionStackCursor=0;"canvas"in svl&&svl.canvas.clear().render2()}},h.unlockDisableRedo=function(){return j.disableRedo=!1,this},h.unlockDisableUndo=function(){return j.disableUndo=!1,this},h.getLock=function(a){return a in j||console.warn("You have passed an invalid key for status."),j[a]},h.updateOpacity=function(){svl.ui&&svl.ui.actionStack&&(i.actionStackCursor<k.length?f.css("opacity",1):f.css("opacity",.5),i.actionStackCursor>0?g.css("opacity",1):g.css("opacity",.5),i.disableUndo&&g.css("opacity",.5),i.disableRedo&&f.css("opacity",.5))},c(b),h}function Canvas(a,b){function c(a){var b=document.getElementById("label-canvas");return b?(ba=b.getContext("2d"),ia.width=b.width,ia.height=b.height,a&&"evaluationMode"in a&&(ea.evaluationMode=a.evaluationMode),na&&(na.bind("mousedown",e),na.bind("mouseup",f),na.bind("mousemove",g)),pa&&pa.bind("click",h),void("path"==ea.drawingMode?(ea.pointInnerCircleRadius=5,ea.pointOuterCircleRadius=6):(ea.pointInnerCircleRadius=13,ea.pointOuterCircleRadius=14))):!1}function d(){svl.tracker.push("LabelingCanvas_FinishLabeling");var a=svl.ribbon.getStatus("selectedLabelType"),b=getLabelColors()[a],c=getLabelDescriptions()[svl.ribbon.getStatus("selectedLabelType")],d=getLabelIconImagePath()[c.id].iconImagePath;fa.fillStyleInnerCircle=b.fillStyle,fa.iconImagePath=d,fa.radiusInnerCircle=ea.pointInnerCircleRadius,fa.radiusOuterCircle=ea.pointOuterCircleRadius;var e,f=ja.length,g=[],h=svl.getPOV();for(e=0;f>e;e++)g.push(new Point(ja[e].x,ja[e].y,h,fa));var i=new Path(g,{}),j=getPosition(),k={canvasWidth:svl.canvasWidth,canvasHeight:svl.canvasHeight,canvasDistortionAlphaX:svl.alpha_x,canvasDistortionAlphaY:svl.alpha_y,labelId:svl.getLabelCounter(),labelType:c.id,labelDescription:c.text,labelFillStyle:b.fillStyle,panoId:getPanoId(),panoramaLat:j.lat,panoramaLng:j.lng,panoramaHeading:h.heading,panoramaPitch:h.pitch,panoramaZoom:h.zoom,svImageWidth:svl.svImageWidth,svImageHeight:svl.svImageHeight,svMode:"html4"};if("panorama"in svl&&"getPhotographerPov"in svl.panorama){var l=svl.panorama.getPhotographerPov();k.photographerHeading=l.heading,k.photographerPitch=l.pitch}ga.currentLabel=new Label(i,k),ma.push(ga.currentLabel),svl.actionStack.push("addLabel",ga.currentLabel),ja=[],svl.ribbon.backToWalk(),"goldenInsertion"in svl&&svl.goldenInsertion&&svl.goldenInsertion.isRevisingLabels()&&svl.goldenInsertion.reviewLabels()}function e(a){da.isLeftDown=!0,da.leftDownX=mouseposition(a,this).x,da.leftDownY=mouseposition(a,this).y,ea.evaluationMode||svl.tracker.push("LabelingCanvas_MouseDown",{x:da.leftDownX,y:da.leftDownY}),da.prevMouseDownTime=(new Date).getTime()}function f(a){var b;if(da.isLeftDown=!1,da.leftUpX=mouseposition(a,this).x,da.leftUpY=mouseposition(a,this).y,b=(new Date).getTime(),!ea.evaluationMode)if(!ga.disableLabeling&&b-da.prevMouseUpTime>300){var c=svl.ribbon.getStatus("selectedLabelType"),e=svl.misc.getLabelDescriptions()[c];if("point"==ea.drawingMode){getLabelIconImagePath()[e.id].iconImagePath;ja.push({x:da.leftUpX,y:da.leftUpY}),d()}else if("path"==ea.drawingMode&&"ribbon"in svl&&svl.ribbon)if(ga.drawing){var f=!1;if(ja.length>2){var g=Math.sqrt(Math.pow(ja[0].x-da.leftUpX,2)+Math.pow(ja[0].y-da.leftUpY,2));g<ea.radiusThresh&&(f=!0,ga.drawing=!1,d())}f||ja.push({x:da.leftUpX,y:da.leftUpY})}else ga.drawing=!0,"tracker"in svl&&svl.tracker&&svl.tracker.push("LabelingCanvas_StartLabeling"),ja.push({x:da.leftUpX,y:da.leftUpY});ca.clear(),ca.setVisibilityBasedOnLocation("visible",getPanoId()),ca.render2()}else if(b-da.prevMouseUpTime<400&&"path"==ea.drawingMode){var h=ja.length;ga.drawing&&h>2&&(ga.drawing=!1,d(),ca.clear(),ca.setVisibilityBasedOnLocation("visible",getPanoId()),ca.render2())}svl.tracker.push("LabelingCanvas_MouseUp",{x:da.leftUpX,y:da.leftUpY}),da.prevMouseUpTime=(new Date).getTime(),da.prevMouseDownTime=0}function g(b){var c=mouseposition(b,this);if(da.currX=c.x,da.currY=c.y,!("ribbon"in svl))throw ca.className+": Import the RibbonMenu.js and instantiate it!";var d=svl.misc.getLabelCursorImagePath(),e=svl.ribbon.getStatus("mode");if(e){var f=d[e].cursorImagePath,g="url("+f+") 6 25, auto";ka&&ka.isAnyOpen()&&(g="default"),a(this).css("cursor",g)}if(!ga.drawing){var h=E(da.currX,da.currY);h&&"Path"===h.className?(ca.showLabelTag(ga.currentLabel),h.renderBoundingBox(ba)):ca.showLabelTag(void 0)}ca.clear(),ca.render2(),da.prevX=mouseposition(b,this).x,da.prevY=mouseposition(b,this).y}function h(){if(!ga.disableLabelDelete){svl.tracker.push("Click_LabelDelete");var a=ca.getCurrentLabel();if(!a){var b=oa.css("left"),c=oa.css("top");b=b.replace("px",""),c=c.replace("px",""),b=parseInt(b,10)+5,c=parseInt(c,10)+5;var d=E(b,c);if(d&&"Point"===d.className){var e=d.belongsTo();a=e.belongsTo()}else d&&"Label"===d.className?a=d:d&&"Path"===d.className&&(a=d.belongsTo())}a&&(ca.removeLabel(a),svl.actionStack.push("deleteLabel",ca.getCurrentLabel()),oa.css("visibility","hidden"),ha.showLabelTag&&ca.unlockShowLabelTag())}}function i(){if(!svl.ribbon)return!1;var a=0,b=ja.length,c=getLabelColors()[svl.ribbon.getStatus("selectedLabelType")],d=c.fillStyle;if(d=svl.util.color.changeAlphaRGBA(d,.5),ba.strokeStyle="rgba(255,255,255,1)",ba.lineWidth=2,b>1){var e=ja[1],f=ja[0],g=Math.sqrt(Math.pow(ja[0].x-da.currX,2)+Math.pow(ja[0].y-da.currY,2));g<ea.radiusThresh&&b>2?svl.util.shape.lineWithRoundHead(ba,f.x,f.y,2*ea.tempPointRadius,e.x,e.y,ea.tempPointRadius,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d):svl.util.shape.lineWithRoundHead(ba,f.x,f.y,ea.tempPointRadius,e.x,e.y,ea.tempPointRadius,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d)}for(a=2;b>a;a++){var e=ja[a],f=ja[a-1];svl.util.shape.lineWithRoundHead(ba,f.x,f.y,5,e.x,e.y,5,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d)}g<ea.radiusThresh&&b>2?svl.util.shape.lineWithRoundHead(ba,ja[b-1].x,ja[b-1].y,ea.tempPointRadius,ja[0].x,ja[0].y,2*ea.tempPointRadius,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d):svl.util.shape.lineWithRoundHead(ba,ja[b-1].x,ja[b-1].y,ea.tempPointRadius,da.currX,da.currY,ea.tempPointRadius,"both","rgba(255,255,255,1)",d,"stroke","rgba(255,255,255,1)",d)}function j(){return"tracker"in svl&&svl.tracker&&ga.drawing&&svl.tracker.push("LabelingCanvas_CancelLabeling"),ja=[],ga.drawing=!1,ca.clear().render2(),this}function k(){return ba?ba.clearRect(0,0,ia.width,ia.height):console.warn("The ctx is not set."),this}function l(){return ga.lockDisableLabelDelete?!1:(ga.disableLabelDelete=!0,this)}function m(){return ga.lockDisableLabelEdit?!1:(ga.disableLabelEdit=!0,this)}function n(){return ga.lockDisableLabeling?!1:(ga.disableLabeling=!0,this)}function o(){return ga.lockDisableLabelDelete?!1:(ga.disableLabelDelete=!1,this)}function p(){return ga.lockDisableLabelEdit?!1:(ga.disableLabelEdit=!1,this)}function q(){return ga.lockDisableLabeling?!1:(ga.disableLabeling=!1,this)}function r(){return ga.currentLabel}function s(a){return a||(a="user"),"system"===a?ca.getSystemLabels(!1):ca.getUserLabels(!1)}function t(a){return ha[a]}function u(){var a,b=ma.length,c=0;for(a=0;b>a;a++)!ma[a].isDeleted()&&ma[a].isVisible()&&c++;return c}function v(){return ka}function w(a){return a in ga||console.warn("You have passed an invalid key for status."),ga[a]}function x(b){return b||(b=!1),b?la:a.extend(!0,[],la)}function y(){var a=ca.getUserLabels();return a=a.filter(function(a){return!a.isDeleted()&&a.isVisible()}),a.length}function z(b){return b||(b=!1),b?ma:a.extend(!0,[],ma)}function A(a,b){return ka.hideDeleteLabel(),this}function B(){return ka.hideBusStopType(),ka.hideBusStopPosition(),this}function C(a,b){b||(b="user");var c,d,e,f,g=svl.misc.getLabelColors(),h=svl.misc.getIconImagePaths(),i=a.length,j=[];for(c=0;i>c;c+=1)d=a[c],e={heading:d.originalHeading,pitch:d.originalPitch,zoom:d.originalZoom},f=new Point,"PhotographerHeading"in d&&d.PhotographerHeading&&"PhotographerPitch"in d&&d.PhotographerPitch&&f.setPhotographerPov(parseFloat(d.PhotographerHeading),parseFloat(d.PhotographerPitch)),f.resetSVImageCoordinate({x:parseInt(d.svImageX,10),y:parseInt(d.svImageY,10)}),f.setProperties({fillStyleInnerCircle:g[d.LabelType].fillStyle,lineWidthOuterCircle:2,iconImagePath:h[d.LabelType].iconImagePath,originalCanvasCoordinate:d.originalCanvasCoordinate,originalHeading:d.originalHeading,originalPitch:d.originalPitch,originalZoom:d.originalZoom,pov:e,radiusInnerCircle:ea.pointInnerCircleRadius,radiusOuterCircle:ea.pointOuterCircleRadius,strokeStyleOuterCircle:"rgba(255,255,255,1)",storedInDatabase:!1}),j.push(f);var k,l={},m=svl.misc.getLabelDescriptions();k=new Path(j),l.canvasWidth=svl.canvasWidth,l.canvasHeight=svl.canvasHeight,l.canvasDistortionAlphaX=svl.alpha_x,l.canvasDistortionAlphaY=svl.alpha_y,l.labelId=a[0].LabelId,l.labelerId=a[0].AmazonTurkerId,l.labelType=a[0].LabelType,l.labelDescription=m[l.labelType].text,l.labelFillStyle=g[l.labelType].fillStyle,l.panoId=a[0].LabelGSVPanoramaId,l.panoramaLat=a[0].Lat,l.panoramaLng=a[0].Lng,l.panoramaHeading=a[0].heading,l.panoramaPitch=a[0].pitch,l.panoramaZoom=a[0].zoom,l.svImageWidth=svl.svImageWidth,l.svImageHeight=svl.svImageHeight,l.svMode="html4","PhotographerPitch"in a[0]&&"PhotographerHeading"in a[0]&&(l.photographerHeading=a[0].PhotographerHeading,l.photographerPitch=a[0].PhotographerPitch);var n=new Label(k,l);"system"===b?la.push(n):ma.push(n)}function D(){return ga.drawing}function E(a,b){var c,d,e;for(d=ma.length,e=!1,c=0;d>c;c+=1)if(e=ma[c].isOn(a,b))return ga.currentLabel=ma[c],e;return!1}function F(){return ga.lockCurrentLabel=!0,this}function G(){return ga.lockDisableLabelDelete=!0,this}function H(){return ga.lockDisableLabelEdit=!0,this}function I(){return ga.lockDisableLabeling=!0,this}function J(){return ha.showLabelTag=!0,this}function K(a){return ga.currentLabel=a,ma.push(a),svl.actionStack&&svl.actionStack.push("addLabel",a),this}function L(){return ma=[],this}function M(a){return a?(svl.tracker.push("RemoveLabel",{labelId:a.getProperty("labelId")}),a.setStatus("deleted",!0),a.setStatus("visibility","hidden"),"goldenInsertion"in svl&&svl.goldenInsertion&&svl.goldenInsertion.isRevisingLabels()&&svl.goldenInsertion.reviewLabels(),ca.clear(),ca.render2(),this):!1}function N(){if(!ba)return console.warn("The ctx is not set."),this;var a,b,c,d={Landmark_Bench:0,Landmark_Shelter:0,Landmark_TrashCan:0,Landmark_MailboxAndNewsPaperBox:0,Landmark_OtherPole:0,StopSign:0,CurbRamp:0,NoCurbRamp:0};ga.totalLabelCount=0;var e=svl.getPOV();if(!ga.svImageCoordinatesAdjusted){var f=svl.panorama.getPhotographerPov();if(f&&"heading"in f&&"pitch"in f){var g;for(c=ma.length,a=0;c>a;a+=1){b=ma[a];var h=b.getPoints(!0),j=h.length;for(g=0;j>g;g++){var k=h[g].getProperties(),l=h[g].getGSVImageCoordinate();if("photographerHeading"in k&&k.photographerHeading){var m=f.heading-k.photographerHeading,n=f.pitch-k.photographerPitch,o=(l.x+m/360*svl.svImageWidth+svl.svImageWidth)%svl.svImageWidth,p=l.y+n/90*svl.svImageHeight;h[g].resetSVImageCoordinate({x:o,y:p})}}}for(c=la.length,a=0;c>a;a+=1){b=la[a];var h=b.getPoints(!0),j=h.length;for(g=0;j>g;g++){var k=h[g].getProperties(),l=h[g].getGSVImageCoordinate();if("photographerHeading"in k&&k.photographerHeading){var m=f.heading-k.photographerHeading,n=f.pitch-k.photographerPitch,o=(l.x+m/360*svl.svImageWidth+svl.svImageWidth)%svl.svImageWidth,p=l.y+n/180*svl.svImageHeight;h[g].resetSVImageCoordinate({x:o,y:p})}}}ga.svImageCoordinatesAdjusted=!0}}for(c=ma.length,a=0;c>a;a+=1)b=ma[a],ea.evaluationMode?b.render(ba,e,!0):b.render(ba,e),b.isVisible()&&!b.isDeleted()&&(d[b.getLabelType()]+=1,ga.totalLabelCount+=1);for(c=la.length,a=0;c>a;a+=1)b=la[a],ea.evaluationMode?b.render(ba,e,!0):b.render(ba,e);return ga.drawing&&i(),"form"in svl&&svl.form.checkSubmittable(),"progressPov"in svl&&svl.progressPov.updateCompletionRate(),svl.labeledLandmarkFeedback&&svl.labeledLandmarkFeedback.setLabelCount(d),svl.actionStack&&svl.actionStack.updateOpacity(),svl.zoomControl&&svl.zoomControl.updateOpacity(),"goldenInsertion"in svl&&svl.goldenInsertion&&svl.goldenInsertion.renderMessage(),this}function O(a){return a.renderBoundingBox(ba),this}function P(a){return ga.lockCurrentLabel?!1:(ga.currentLabel=a,this)}function Q(a,b){if(!(a in ga))throw ca.className+": Illegal status name.";return"disableLabeling"===a?"boolean"==typeof b?(b?ca.disableLabeling():ca.enableLabeling(),this):!1:"disableMenuClose"===a?"boolean"==typeof b?(b?ca.disableMenuClose():ca.enableMenuClose(),this):!1:void("disableLabelDelete"===a?b===!0?ca.disableLabelDelete():b===!1&&ca.enableLabelDelete():ga[a]=b)}function R(a){if(!ha.showLabelTag){var b,c,d=!1;if(c=ma.length,a)for(b=0;c>b;b+=1)ma[b].getLabelId()===a.getLabelId()?(ma[b].setTagVisibility("visible"),d=!0):(ma[b].setTagVisibility("hidden"),ma[b].resetTagCoordinate());else{for(b=0;c>b;b++)ma[b].setTagVisibility("hidden"),ma[b].resetTagCoordinate();oa.css("visibility","hidden")}return d||oa.css("visibility","hidden"),ca.clear().render2(),this}}function S(a){return ca.showLabelTag(a)}function T(a){var b=0,c=0;for(c=ma.length,b=0;c>b;b+=1)ma[b].unlockVisibility().setVisibility("visible");return this}function U(a){var b=0,c=0;for(c=ma.length,b=0;c>b;b+=1)ma[b].setVisibilityBasedOnLocation(a,getPanoId());return this}function V(a,b,c){var d=0,e=0;for(e=ma.length,d=0;e>d;d+=1)ma[d].setVisibilityBasedOnLabelerId(a,b,c);return this}function W(a,b,c){var d=0,e=0;for(e=ma.length,d=0;e>d;d+=1)ma[d].setVisibilityBasedOnLabelerIdAndLabelTypes(a,b,c);return this}function X(a,b){ka.showDeleteLabel(a,b)}function Y(){return ga.lockCurrentLabel=!1,this}function Z(){return ga.lockDisableLabelDelete=!1,this}function $(){return ga.lockDisableLabelEdit=!1,this}function _(){return ga.lockDisableLabeling=!1,this}function aa(){return ha.showLabelTag=!1,this}var ba,ca={className:"Canvas"},da={currX:0,currY:0,prevX:0,prevY:0,leftDownX:0,leftDownY:0,leftUpX:0,leftUpY:0,isLeftDown:!1,prevMouseDownTime:0,prevMouseUpTime:0},ea={drawingMode:"point",evaluationMode:!1,radiusThresh:7,showDeleteMenuTimeOutToken:void 0,tempPointRadius:5},fa={fillStyleInnerCircle:"rgba(0,0,0,1)",lineWidthOuterCircle:2,iconImagePath:void 0,radiusInnerCircle:5,radiusOuterCircle:6,strokeStyleOuterCircle:"rgba(255,255,255,1)",storedInDatabase:!1},ga={currentLabel:null,disableLabelDelete:!1,disableLabelEdit:!1,disableLabeling:!1,disableWalking:!1,drawing:!1,lockCurrentLabel:!1,lockDisableLabelDelete:!1,lockDisableLabelEdit:!1,lockDisableLabeling:!1,svImageCoordinatesAdjusted:!1,totalLabelCount:0,visibilityMenu:"hidden"},ha={showLabelTag:!1},ia={height:0,width:0},ja=[],ka=void 0,la=[],ma=[],na=(0===a("#labelCanvas").length?null:a("#labelCanvas"),0===a("div#labelDrawingLayer").length?null:a("div#labelDrawingLayer")),oa=0===a("#Holder_LabelDeleteIcon").length?null:a("#Holder_LabelDeleteIcon"),pa=(0===a("#Holder_LabelEditIcon").length?null:a("#Holder_LabelEditIcon"),0===a("#LabelDeleteIcon").length?null:a("#LabelDeleteIcon"));return c(b),ca.cancelDrawing=j,ca.clear=k,ca.disableLabelDelete=l,ca.disableLabelEdit=m,ca.disableLabeling=n,ca.enableLabelDelete=o,ca.enableLabelEdit=p,ca.enableLabeling=q,ca.getCurrentLabel=r,ca.getLabels=s,ca.getLock=t,ca.getNumLabels=u,ca.getRightClickMenu=v,ca.getStatus=w,ca.getSystemLabels=x,ca.getUserLabelCount=y,ca.getUserLabels=z,ca.hideDeleteLabel=A,ca.hideRightClickMenu=B,ca.insertLabel=C,ca.isDrawing=D,ca.isOn=E,ca.lockCurrentLabel=F,ca.lockDisableLabelDelete=G,ca.lockDisableLabelEdit=H,ca.lockDisableLabeling=I,ca.lockShowLabelTag=J,ca.pushLabel=K,ca.removeAllLabels=L,ca.removeLabel=M,ca.render2=N,ca.renderBoundingBox=O,ca.setCurrentLabel=P,ca.setStatus=Q,ca.showLabelTag=R,ca.setTagVisibility=S,ca.setVisibility=T,ca.setVisibilityBasedOnLocation=U,ca.setVisibilityBasedOnLabelerId=V,ca.setVisibilityBasedOnLabelerIdAndLabelTypes=W,ca.showDeleteLabel=X,ca.unlockCurrentLabel=Y,ca.unlockDisableLabelDelete=Z,ca.unlockDisableLabelEdit=$,ca.unlockDisableLabeling=_,ca.unlockShowLabelTag=aa,ca}function ExampleWindow(a,b){function c(b){f=a(b.domIds.holder),g=a(b.domIds.closeButtonHolder),h=a(b.domIds.StopSign_OneLeg),i=a(b.domIds.StopSign_TwoLegs),j=a(b.domIds.StopSign_Column),k=a(b.domIds.NextToCurb),l=a(b.domIds.AwayFromCurb),p={StopSign_OneLeg:h,StopSign_TwoLegs:i,StopSign_Column:j,NextToCurb:k,AwayFromCurb:l},g.bind({click:m.close,mouseenter:d,mouseleave:e})}function d(){return a(this).css({cursor:"pointer"}),this}function e(){return a(this).css({cursor:"default"}),this}var f,g,h,i,j,k,l,m={className:"ExampleWindow"},n={exampleCategories:["StopSign_OneLeg","StopSign_TwoLegs","StopSign_Column","NextToCurb","AwayFromCurb"]},o={open:!1},p={};return m.close=function(){return o.open=!1,f.css({visibility:"hidden"}),a.each(p,function(a,b){b.css({visibility:"hidden"})}),this},m.isOpen=function(){return o.open},m.show=function(b){return-1===n.exampleCategories.indexOf(b)?!1:(o.open=!0,f.css({visibility:"visible"}),a.each(p,function(a,c){console.log(a),a===b?c.css({visibility:"visible"}):c.css({visibility:"hidden"})}),this)},c(b),m}function Form(a,b){function c(b){var c=(""!==getURLParameter("groupId"),""!==getURLParameter("hitId")),d=""!==getURLParameter("workerId"),f=getURLParameter("assignmentId");if(D.onboarding=b.onboarding,D.dataStoreUrl=b.dataStoreUrl,"assignmentId"in b&&b.assignmentId&&(D.assignmentId=b.assignmentId),"hitId"in b&&b.hitId&&(D.hitId=b.hitId),"turkerId"in b&&b.turkerId&&(D.turkerId=b.turkerId),"userExperiment"in b&&b.userExperiment&&(D.userExperiment=!0),p=a("#BusStopLabelerForm"),q=svl.ui.form.commentField,r=svl.ui.form.submitButton,s=svl.ui.form.skipButton,t=a("#BusStopAbsence_Submit"),u=a("#BusStopAbsence_Cancel"),v=a(".Radio_BusStopAbsence"),w=a("#Text_BusStopAbsenceOtherReason"),x=a("#Holder_SkipOptions"),y=a("#page-overlay-holder"),D.userExperiment&&(A=a("#task-difficulty-button"),z=a("#task-difficulty-wrapper")),a('input[name="assignmentId"]').attr("value",D.assignmentId),a('input[name="workerId"]').attr("value",D.turkerId),a('input[name="hitId"]').attr("value",D.hitId),f&&"ASSIGNMENT_ID_NOT_AVAILABLE"===f?(D.isPreviewMode=!0,D.isAMTTask=!0,C.unlockDisableSubmit().disableSubmit().lockDisableSubmit(),C.unlockDisableSkip().disableSkip().lockDisableSkip()):d&&!f?(D.isPreviewMode=!1,D.isAMTTask=!1):f||c||d?(D.isPreviewMode=!1,D.isAMTTask=!0):(D.isPreviewMode=!1,D.isAMTTask=!1),D.isSandbox=!1,D.isAMTTask&&-1!==document.referrer.indexOf("workersandbox.mturk.com")&&(D.isSandbox=!0,p.prop("action","https://workersandbox.mturk.com/mturk/externalSubmit")),D.isAMTTask&&D.isPreviewMode){var h='<div class="amt-preview-warning-holder"><div class="amt-preview-warning">Warning: you are on a Preview Mode!</div></div>';a("body").append(h),C.disableSubmit(),C.lockDisableSubmit()}D.commentFieldMessage=q.attr("title"),q.val(D.commentFieldMessage),e(),q.bind("focus",focusCallback),q.bind("blur",blurCallback),p.bind("submit",g),s.bind("click",k),t.on("click",j),u.on("click",l),v.on("click",m),w.get().length>0&&(w[0].oninput=n),D.userExperiment&&A.bind("click",o)}function d(){var b,c,d,e={},f=svl.map.getInitialPanoId();b=D.hitId?D.hitId:getURLParameter("hitId"),c=D.assignmentId?D.assignmentId:getURLParameter("assignmentId"),d=D.turkerId?D.turkerId:getURLParameter("workerId"),d||(d="Test_Kotaro"),b||(b="Test_Hit"),c||(c="Test_Assignment"),e.assignment={amazon_turker_id:d,amazon_hit_id:b,amazon_assignment_id:c,interface_type:"StreetViewLabeler",interface_version:"3",completed:0,need_qualification:0,task_description:D.taskDescription},e.labelingTask={task_panorama_id:D.taskPanoramaId,task_gsv_panorama_id:f,no_label:0,description:"",previous_labeling_task_id:D.previousLabelingTaskId},e.labelingTaskEnvironment={browser:getBrowser(),browser_version:getBrowserVersion(),browser_width:a(window).width(),browser_height:a(window).height(),screen_width:screen.width,screen_height:screen.height,avail_width:screen.availWidth,avail_height:screen.availHeight,operating_system:getOperatingSystem()},e.userInteraction=svl.tracker.getActions(),e.labels=[];for(var g=svl.canvas.getLabels(),h=0;h<g.length;h+=1){var i=g[h],j=i.getProperties(),k=i.getPath().getPoints(),l=k.length,m={deleted:i.isDeleted()?1:0,label_id:i.getLabelId(),label_type:i.getLabelType(),label_gsv_panorama_id:j.panoId,label_points:[],label_additional_information:void 0};"photographerHeading"in j&&"photographerPitch"in j&&(m.photographer_heading=j.photographerHeading,m.photographer_pitch=j.photographerPitch);for(var n=0;l>n;n+=1){var o=k[n],p=o.getGSVImageCoordinate(),r={svImageX:p.x,svImageY:p.y,originalCanvasX:o.originalCanvasCoordinate.x,originalCanvasY:o.originalCanvasCoordinate.y,originalHeading:o.originalPov.heading,originalPitch:o.originalPov.pitch,originalZoom:o.originalPov.zoom,canvasX:o.canvasCoordinate.x,canvasY:o.canvasCoordinate.y,heading:o.pov.heading,pitch:o.pov.pitch,zoom:o.pov.zoom,lat:j.panoramaLat,lng:j.panoramaLng,svImageHeight:j.svImageHeight,svImageWidth:j.svImageWidth,canvasHeight:j.canvasHeight,canvasWidth:j.canvasWidth,alphaX:j.canvasDistortionAlphaX,alphaY:j.canvasDistortionAlphaY};m.label_points.push(r)}e.labels.push(m)}0===e.labels.length&&(e.labelingTask.no_label=0);var s=q.val();return e.comment=void 0,s&&s!==q.attr("title")&&(e.comment=q.val()),e}function e(){t.attr("disabled",!0),t.css("color","rgba(96,96,96,0.5)")}function f(){t.attr("disabled",!1),t.css("color","rgba(96,96,96,1)")}function g(b){(!D.isAMTTask||D.taskRemaining>1)&&b.preventDefault();var c=D.dataStoreUrl,e={};if(E.disableSubmit)return i(),!1;if(window.location.reload(),"goldenInsertion"in svl&&svl.goldenInsertion){svl.goldenInsertion.reviewLabels();return C.disableSubmit().lockDisableSubmit(),C.disableSkip().lockDisableSkip(),!1}if(t.attr("disabled",!0),y.css("visibility","visible"),D.userExperiment&&!E.taskDifficulty)return E.submitType="submit",z.css("visibility","visible"),!1;if(!D.onboarding){svl.tracker.push("TaskSubmit"),e=d(),void 0!=E.taskDifficulty&&(e.taskDifficulty=E.taskDifficulty,e.labelingTask.description="TaskDifficulty:"+E.taskDifficulty,E.taskDifficultyComment&&(e.comment="TaskDifficultyCommentField:"+E.taskDifficultyComment+";InterfaceCommentField:"+e.comment));try{a.ajax({async:!1,url:c,type:"post",data:e,dataType:"json",success:function(a){a.error&&console.log(a.error)},error:function(a){throw a}})}catch(b){return console.error(b),!1}return D.taskRemaining>1?(window.location.reload(),!1):D.isAMTTask?!0:(window.location.reload(),!1)}return!1}function h(){if(!("goldenInsertion"in svl&&svl.goldenInsertion))throw C.className+": This method cannot be called without GoldenInsertion";svl.tracker.push("GoldenInsertion_Submit");var b,c=D.dataStoreUrl;svl.goldenInsertion.disableOkButton(),b=d(),b.labelingTask.description="GoldenInsertion";try{a.ajax({async:!1,url:c,type:"post",data:b,dataType:"json",success:function(a){"object"==typeof a&&"error"in a&&a.error&&console.log(a.error)},error:function(a){throw a}})}catch(e){return console.error(e),!1}return window.location.reload(),!1}function i(){var b=parseInt(100*svl.progressPov.getCompletionRate(),10);if(!("onboarding"in svl&&svl.onboarding)&&100>b){var c,d="You have inspected "+b+"% of the scene. Let's inspect all the corners before you submit the task!",e=void 0;if(B.clear(),B.renderMessage(300,250,d,350,140),B.renderArrow(650,282,710,282),"hidden"===E.disabledButtonMessageVisibility){E.disabledButtonMessageVisibility="visible";var f='<button id="TempOKButton" class="button bold" style="left:20px;position:relative; width:100px;">OK</button>';e.append(f),c=a("#TempOKButton"),c.bind("click",function(){c.remove(),B.clear(),E.disabledButtonMessageVisibility="hidden"})}}}function j(b){(!D.isAMTTask||D.taskRemaining>1)&&b.preventDefault();var c=D.dataStoreUrl,e={};if("goldenInsertion"in svl&&svl.goldenInsertion){C.disableSubmit().lockDisableSubmit(),s.attr("disabled",!0),t.attr("disabled",!0),x.css({visibility:"hidden"});svl.goldenInsertion.reviewLabels();return!1}if(r.attr("disabled",!0),s.attr("disabled",!0),t.attr("disabled",!0),y.css("visibility","visible"),D.userExperiment&&!E.taskDifficulty)return E.submitType="skip",z.css("visibility","visible"),!1;if("Other:"===E.radioValue&&(E.skipReasonDescription="Other: "+w.val()),!D.onboarding){svl.tracker.push("TaskSubmitSkip"),e=d(),e.noLabels=!0,e.labelingTask.no_label=1,e.labelingTask.description=E.skipReasonDescription,void 0!=E.taskDifficulty&&(e.taskDifficulty=E.taskDifficulty,e.labelingTask.description="TaskDifficulty:"+E.taskDifficulty,E.taskDifficultyComment&&(e.comment="TaskDifficultyCommentField:"+E.taskDifficultyComment+";InterfaceCommentField:"+e.comment));try{a.ajax({async:!1,url:c,type:"post",data:e,success:function(a){a.error&&console.log(a.error)},error:function(a){throw a}})}catch(b){return console.error(b),!1}return D.taskRemaining>1?(window.location.reload(),!1):D.isAMTTask?(document.getElementById("BusStopLabelerForm").submit(),!0):(window.location.reload(),!1)}return!1}function k(a){return a.preventDefault(),E.disableSkip?i():(svl.tracker.push("Click_OpenSkipWindow"),x.css({visibility:"visible"})),!1}function l(a){return a.preventDefault(),svl.tracker.push("Click_CloseSkipWindow"),x.css({visibility:"hidden"}),!1}function m(){if(E.radioValue=a(this).attr("value"),svl.tracker.push("Click_SkipRadio",{RadioValue:E.radioValue}),"Other:"!==E.radioValue)E.skipReasonDescription=E.radioValue,f();else{var b=w.val();b?f():e()}}function n(){if(E.radioValue&&"Other:"===E.radioValue){var a=w.val();a?f():e()}}function o(b){E.taskDifficulty=parseInt(a('input[name="taskDifficulty"]:radio:checked').val(),10),E.taskDifficultyComment=a("#task-difficulty-comment").val(),E.taskDifficultyComment=""!=E.taskDifficultyComment?E.taskDifficultyComment:void 0,console.log(E.taskDifficultyComment),E.taskDifficulty&&("submitType"in E&&"submit"==E.submitType?g(b):"submitType"in E&&"skip"==E.submitType&&j(b));
}var p,q,r,s,t,u,v,w,x,y,z,A,B,C={className:"Form"},D={commentFieldMessage:void 0,isAMTTask:!1,isPreviewMode:!1,previousLabelingTaskId:void 0,dataStoreUrl:void 0,onboarding:!1,taskRemaining:0,taskDescription:void 0,taskPanoramaId:void 0,hitId:void 0,assignmentId:void 0,turkerId:void 0,userExperiment:!1},E={disabledButtonMessageVisibility:"hidden",disableSkipButton:!1,disableSubmit:!1,radioValue:void 0,skipReasonDescription:void 0,submitType:void 0,taskDifficulty:void 0,taskDifficultyComment:void 0},F={disableSkipButton:!1,disableSubmit:!1};return C.checkSubmittable=function(){if("progressPov"in svl&&svl.progressPov)var a=svl.progressPov.getCompletionRate();else var a=0;var b=svl.canvas.getNumLabels();return.01>1-a?(b>0?(C.enableSubmit(),C.disableSkip()):(C.disableSubmit(),C.enableSkip()),!0):(C.disableSubmit(),C.disableSkip(),!1)},C.compileSubmissionData=function(){return d()},C.disableSubmit=function(){return F.disableSubmit?!1:(E.disableSubmit=!0,r.css("opacity",.5),this)},C.disableSkip=function(){return F.disableSkip?!1:(E.disableSkip=!0,s.css("opacity",.5),this)},C.enableSubmit=function(){return F.disableSubmit?!1:(E.disableSubmit=!1,r.css("opacity",1),this)},C.enableSkip=function(){return F.disableSkip?!1:(E.disableSkip=!1,s.css("opacity",1),this)},C.goldenInsertionSubmit=function(){return h()},C.isPreviewMode=function(){return D.isPreviewMode},C.lockDisableSubmit=function(){return F.disableSubmit=!0,this},C.lockDisableSkip=function(){return F.disableSkip=!0,this},C.setPreviousLabelingTaskId=function(a){return D.previousLabelingTaskId=a,this},C.setTaskDescription=function(a){return D.taskDescription=a,this},C.setTaskRemaining=function(a){return D.taskRemaining=a,this},C.setTaskPanoramaId=function(a){return D.taskPanoramaId=a,this},C.unlockDisableSubmit=function(){return F.disableSubmit=!1,this},C.unlockDisableSkip=function(){return F.disableSkipButton=!1,this},c(b),C}function GoldenInsertion(a,b){function c(a){"goldenLabelVisibility"in a&&(p.goldenLabelVisibility=a.goldenLabelVisibility),l=new Onboarding(a,b),m=b("#ModeSwitchButton_CurbRamp"),n=b("#ModeSwitchButton_NoCurbRamp")}function d(){q.currentLabel=void 0,l.clear()}function e(){if(!("form"in svl&&svl.form))throw o.className+": Cannnot submit without a Form object.";svl.form.goldenInsertionSubmit()}function f(a,b){return a.relativeHeading<b.relativeHeading?-1:a.relativeHeading>b.relativeHeading?1:0}function g(a){if("canvas"in svl&&svl.canvas&&"map"in svl&&svl.map){svl.tracker.push("GoldenInsertion_ReviseFalseNegative");var b,c=a.getLabelId(),d=svl.canvas.getSystemLabels(!0),e=d.length;for(b=0;e>b;b++)c==d[b].getLabelId()?(a=d[b],a.unlockVisibility().setVisibility("visible").lockVisibility()):d[b].unlockVisibility().setVisibility("hidden").lockVisibility();var f=a.getLabelPov(),g=a.getLabelType();q.currentLabel=a,"CurbRamp"===g?q.boxMessage="You did not label this <b>curb ramp</b>. Please draw an outline around it.":q.boxMessage="You did not label this <b>missing curb ramp</b>. Please draw an outline around it.",svl.messageBox.hide(),svl.map.setPov(f,p.cameraMovementDuration,function(){q.currentLabel=a,j(),"CurbRamp"===g?svl.ribbon.modeSwitch("CurbRamp"):"NoCurbRamp"===g&&svl.ribbon.modeSwitch("NoCurbRamp")});var h="rgba(0,0,255, 0.5)";a.fill(h).blink(5)}}function h(a,b){if(b&&"number"==typeof b||(b=0),"canvas"in svl&&svl.canvas&&"map"in svl&&svl.map){svl.tracker.push("GoldenInsertion_ReviseFalsePositive");var c,d=a.getLabelId(),e=svl.canvas.getUserLabels(!0),f=svl.canvas.getUserLabelCount();for(c=0;f>c;c++)if(d==e[c].getLabelId()){a=e[c];break}var g=a.getLabelPov(),h=a.getLabelType();q.currentLabel=a,"CurbRamp"===h?b>0?q.boxMessage='This label does not precisely outline the <b>curb ramp</b>. Mouse over the label and click <img src="'+svl.rootDirectory+'img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.':q.boxMessage='There does not appear to be a curb ramp to label here. Mouse over the label and click <img src="'+svl.rootDirectory+'/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.':b>0?q.boxMessage='Your label is not on a <b>missing curb ramp</b>. Mouse over the label and click <img src="'+svl.rootDirectory+'/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.':q.boxMessage='There does not appear to be any missing curb ramp to label here. Mouse over the label and click <img src="'+svl.rootDirectory+'/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.',svl.messageBox.hide(),svl.map.setPov(g,p.cameraMovementDuration,function(){q.currentLabel=a,j()});var i="rgba(255, 0, 0, 0.7)";a.fill(i).blink(5)}}function i(){if("canvas"in svl&&svl.canvas&&"form"in svl&&svl.form&&"map"in svl&&svl.map&&"panorama"in svl&&svl.panorama){svl.tracker.push("GoldenInsertion_ReviewLabels");var a=svl.canvas.getLabels("user"),c=svl.canvas.getLabels("system"),i=[];d(),a=a.filter(function(a){return!a.isDeleted()&&a.isVisible()});var j=a.map(function(a){return a.labeledBy="user",a}),l=c.map(function(a){return a.labeledBy="system",a}),i=j.concat(l);i=i.map(function(a){var b=svl.panorama.getPov().heading,c=a.getLabelPov().heading,d=10;return a.relativeHeading=parseInt((c-b+360)%360),a.relativeHeading=a.relativeHeading<360-a.relativeHeading?a.relativeHeading:360-a.relativeHeading,a.relativeHeading="system"===a.labeledBy?a.relativeHeading+d:a.relativeHeading,a}),i.sort(f);var m,n,o,s,t,u=i.length;for(n=0;u>n;n++)if(!("correct"in i[n]&&i[n].correct)){t=!1;var v=0;if("user"===i[n].labeledBy){for(s=c.length,o=0;s>o;o++)if(i[n].getLabelType()===c[o].getLabelType()&&(m=i[n].overlap(c[o]),m>v&&(v=m),"CurbRamp"===i[n].getLabelType()&&m>p.curbRampThreshold||"NoCurbRamp"===i[n].getLabelType()&&m>p.noCurbRampThreshold)){i[n].correct=!0,c[o].correct=!0,t=!0;break}if(!t)return void(q.hasMistake?h(i[n],v):(k(h,{label:i[n],overlap:v}),q.hasMistake=!0))}else{for(s=a.length,o=0;s>o;o++)if(i[n].getLabelType()===a[o].getLabelType()&&(m=i[n].overlap(a[o]),"CurbRamp"===i[n].getLabelType()&&m>p.curbRampThreshold||"NoCurbRamp"===i[n].getLabelType()&&m>p.noCurbRampThreshold)){i[n].correct=!0,a[o].correct=!0,t=!0;break}if(!t)return void(q.hasMistake?g(i[n]):(k(g,{label:i[n]}),q.hasMistake=!0))}}var w="<div style='height: 10px'></div>";if(q.hasMistake)var x="Great, you corrected all the mistakes! Please try to be as accurate as possible. Your labels will be used to make our cities better and more accessible.Now, let's move on to the next task. <br/>"+w+r;else var x="Fantastic! You labeled everything correctly! Let's move on to the next task. <br />"+w+r;var y=0,z=320,A=700,B=null;return svl.messageBox.setMessage(x).setPosition(y,z,A,B,!0).show(),void b("#GoldenInsertionOkButton").bind("click",e)}}function j(){l.clear();var a=q.currentLabel.getBoundingBox(),b=a.x+a.width+50,c=a.y+a.height/2+60;svl.messageBox.setMessage(q.boxMessage).setPosition(b,c).show(),l.renderArrow(b,a.y+a.height/2+10,b-25,a.y+a.height/2,{arrowWidth:3})}function k(a,c){if(!c)return!1;if(!("label"in c&&c.label))return!1;var d="<div style='height: 10px'></div>",e='<img src="'+svl.rootDirectory+'/img/icons/Icon_WarningSign.svg" class="MessageBoxIcons" style="height:30px; width:30px; top:6px;"/> Uh oh, looks like there is a problem with your labels. Let\'s see if we can fix this. <br />'+d+r,f=0,g=320,h=720,i=null;svl.messageBox.setMessage(e).setPosition(f,g,h,i,!0).show(),b("#GoldenInsertionOkButton").bind("click",function(){svl.messageBox.hide(),"overlap"in c?a(c.label,c.overlap):a(c.label)})}var l,m,n,o={className:"GoldenInsertion"},p={cameraMovementDuration:500,curbRampThreshold:.35,goldenLabelVisibility:"hidden",noCurbRampThreshold:.1},q={boxMessage:"",currentLabel:void 0,hasMistake:!1,revisingLabels:!1},r='<button id="GoldenInsertionOkButton" class="button" style="">OK</button>';return o.disableOkButton=function(){b("#GoldenInsertionOkButton").unbind("click"),b("#GoldenInsertionOkButton").css("opacity",.7)},o.getGoldenLabelVisibility=function(){return p.goldenLabelVisibility},o.isRevisingLabels=function(){return q.revisingLabels},o.renderMessage=function(){q.currentLabel&&""!==q.boxMessage&&j()},o.reviewLabels=function(){return q.revisingLabels=!0,i()},c(a),o}function Keyboard(a){function b(){"ui"in svl&&"form"in svl.ui&&(g=svl.ui.form.commentField.length>0?svl.ui.form.commentField:null),h=a("#task-difficulty-comment").length>0?a("#task-difficulty-comment"):null,i=a("#Text_BusStopAbsenceOtherReason").length>0?a("#Text_BusStopAbsenceOtherReason"):null,g&&(g.bind("focus",f),g.bind("blur",e)),h&&(h.bind("focus",f),h.bind("blur",e)),i&&(i.bind("focus",f),i.bind("blur",e)),a(document).bind("keyup",d),a(document).bind("keydown",c)}function c(a){if(!k.focusOnTextField)switch("tracker"in svl&&svl.tracker.push("KeyDown",{keyCode:a.keyCode}),a.keyCode){case 16:k.shiftDown=!0}}function d(a){if(!k.focusOnTextField)switch("tracker"in svl&&svl.tracker.push("KeyUp",{keyCode:a.keyCode}),a.keyCode){case 16:k.shiftDown=!1;break;case 27:svl.canvas.getStatus("drawing")?svl.canvas.cancelDrawing():svl.ribbon.backToWalk();break;case 67:svl.ribbon.modeSwitchClick("CurbRamp");break;case 69:svl.ribbon.modeSwitchClick("Walk");break;case 77:svl.ribbon.modeSwitchClick("NoCurbRamp");break;case 90:k.shiftDown?"zoomControl"in svl&&svl.zoomControl.zoomOut():"zoomControl"in svl&&svl.zoomControl.zoomIn()}}function e(){k.focusOnTextField=!1}function f(){k.focusOnTextField=!0}var g,h,i,j={className:"Keyboard"},k={focusOnTextField:!1,shiftDown:!1};return j.getStatus=function(a){return a in k||console.warn("You have passed an invalid key for status."),k[a]},j.isShiftDown=function(){return k.shiftDown},j.setStatus=function(a,b){return a in k&&(k[a]=b),this},b(),j}function Label(a,b){function c(a,b){try{if(!b){var c='The passed "path" is empty.';throw c}h=b;for(attrName in k)if("tagHeight"!==attrName&&"tagWidth"!==attrName&&"tagX"!==attrName&&"tagY"!==attrName&&"labelerId"!==attrName&&"photographerPov"!==attrName&&"photographerHeading"!==attrName&&"photographerPitch"!==attrName&&"distanceThreshold"!==attrName||a[attrName]){if(!(attrName in a)){var c='"'+attrName+'" is not in the passed parameter.';throw c}k[attrName]=a[attrName]}return h.setBelongsTo(j),i=g(),!0}catch(d){return console.error(j.className,":","Error initializing the Label object.",d),!1}}function d(a){if(3!==arguments.length)return!1;var b=h.getBoundingBox(),c=k.labelDescription,d=c.split("\n");"DefaultValue"!==k.labelerId&&d.push("Labeler: "+k.labelerId),a.font="10.5pt Calibri";for(var e=k.tagHeight*d.length,f=-1,g=0;g<d.length;g+=1){var i=a.measureText(d[g]).width+5;i>f&&(f=i)}k.tagWidth=f;var j,l;a.save(),a.lineWidth=3.5,a.fillStyle="rgba(255,255,255,1)",a.strokeStyle="rgba(255,255,255,1)",a.beginPath();var m=15;m>b.width&&(m=b.width-1),j=b.x<5?5:b.x,b.y+b.height<400?(a.moveTo(j+m,b.y+b.height),a.lineTo(j+m,b.y+b.height+10),a.stroke(),a.closePath(),a.restore(),l=b.y+b.height+10):(a.moveTo(j+m,b.y),a.lineTo(j+m,b.y-10),a.stroke(),a.closePath(),a.restore(),l=b.y-e-20);var n=16,o=30,p=10;a.save(),a.lineCap="square",a.lineWidth=2,a.fillStyle="rgba(255, 255, 255, 0.9)",a.strokeStyle="rgba(255,255,255,1)",a.beginPath(),a.moveTo(j,l),a.lineTo(j+f+n+o,l),a.lineTo(j+f+n+o,l+e+p),a.lineTo(j,l+e+p),a.lineTo(j,l),a.fill(),a.stroke(),a.closePath(),a.restore(),a.save(),a.fillStyle="#000";var q,r,s,t,u,v=k.labelType,w=getLabelIconImagePath()[v].iconImagePath;q=new Image,r=s=25,t=j+5,u=l+2,q.src=w,a.drawImage(q,t,u,r,s);for(var g=0;g<d.length;g+=1)a.fillText(d[g],j+n+20,l+20+20*g);a.restore()}function e(){if("hidden"!==l.tagVisibility){var a=h.getBoundingBox(),b=a.x+a.width-20,c=a.y,d=$("#Holder_LabelDeleteIcon");d.css({visibility:"visible",left:b,top:c})}}function f(){var a=h.getImageCoordinates(),b=(k.panoramaLat,svl.pointCloud.getPointCloud(k.panoId));if(b){for(var c,d=1e3,e=1e3,f=0;f<a.length;f++){var g=svl.util.scaleImageCoordinate(a[f].x,a[f].y,1/26),i=3*(Math.ceil(g.x)+512*Math.ceil(g.y)),j=b.pointCloud[i],l=b.pointCloud[i+1],m=j*j+l*l,n=d*d+e+e;n>m&&(d=j,e=l)}return c=svl.util.math.latlngOffset(k.panoramaLat,j,l),{lat:k.panoramaLat+c.dlat,lng:k.panoramaLng+c.dlng}}return null}function g(){var a=f(),b=new google.maps.LatLng(a.lat,a.lng);({url:svl.rootDirectory+"img/icons/Sidewalk/Icon_CurbRamp.png",size:new google.maps.Size(20,20),origin:new google.maps.Point(a.lat,a.lng)});return new google.maps.Marker({position:b,map:svl.map.getMap(),title:"Hi!",icon:svl.rootDirectory+"img/icons/Sidewalk/Icon_CurbRampSmall.png"})}var h,i,j={className:"Label"},k={canvasWidth:void 0,canvasHeight:void 0,canvasDistortionAlphaX:void 0,canvasDistortionAlphaY:void 0,distanceThreshold:100,labelerId:"DefaultValue",labelId:"DefaultValue",labelType:void 0,labelDescription:void 0,labelFillStyle:void 0,panoId:void 0,panoramaLat:void 0,panoramaLng:void 0,panoramaHeading:void 0,panoramaPitch:void 0,panoramaZoom:void 0,photographerHeading:void 0,photographerPitch:void 0,svImageWidth:void 0,svImageHeight:void 0,svMode:void 0,tagHeight:20,tagWidth:1,tagX:-1,tagY:-1},l={deleted:!1,tagVisibility:"visible",visibility:"visible"},m={tagVisibility:!1,visibility:!1};return j.blink=function(a,b){a?0>a&&(a=0):a=3;var c,d,e=!0,f=j.getPath(),g=f.getPoints(),h=g.length,i="rgba(200,200,200,0.1)",k=f.getFillStyle();return c=setInterval(function(){if(a>0)if(e){for(e=!1,f.setFillStyle(i),d=0;h>d;d++)g[d].setFillStyle(i);svl.canvas.clear().render2()}else{for(e=!0,f.setFillStyle(k),d=0;h>d;d++)g[d].setFillStyle(k);svl.canvas.clear().render2(),a-=1}else{if(b){for(f.setFillStyle(i),d=0;h>d;d++)g[d].setFillStyle(i);svl.canvas.clear().render2()}j.setAlpha(.05),svl.canvas.clear().render2(),window.clearInterval(c)}},500),this},j.fadeFillStyle=function(a){var b=j.getPath(),c=b.getPoints(),d=0,e=c.length,f=void 0;for(a||(a="default"),f="gray"===a?"rgba(200,200,200,0.5)":"rgba(255,165,0,0.8)",b.setFillStyle(f);e>d;d++)c[d].setFillStyle(f);return this},j.getBoundingBox=function(a){var b=j.getPath();return b.getBoundingBox(a)},j.getCoordinate=function(){if(h&&h.points.length>0){var a=h.getPOV();return $.extend(!0,{},h.points[0].getCanvasCoordinate(a))}return h},j.getGSVImageCoordinate=function(){return h&&h.points.length>0?h.points[0].getGSVImageCoordinate():void 0},j.getImageCoordinates=function(){return h?h.getImageCoordinates():!1},j.getLabelId=function(){return k.labelId},j.getLabelType=function(){return k.labelType},j.getPath=function(a){return h?a?h:$.extend(!0,{},h):!1},j.getPoint=function(){return h&&h.points.length>0?h.points[0]:h},j.getPoints=function(a){return h?h.getPoints(a):!1},j.getLabelPov=function(){var a,b=parseInt(k.panoramaPitch,10),c=parseInt(k.panoramaZoom,10),d=j.getPoints(),e=d.map(function(a){return a.svImageCoordinate.x});if(e.max()-e.min()>svl.svImageWidth/2){e=e.map(function(a){return a<svl.svImageWidth/2&&(a+=svl.svImageWidth),a});var f=parseInt(e.mean(),10)%svl.svImageWidth}else var f=parseInt(e.mean(),10);return a=parseInt(f/svl.svImageWidth*360,10)%360,{heading:parseInt(a,10),pitch:b,zoom:c}},j.getProperties=function(){return $.extend(!0,{},k)},j.getProperty=function(a){return a in k?k[a]:!1},j.getstatus=function(a){return l[a]},j.getVisibility=function(){return l.visibility},j.fill=function(a){var b=j.getPath(),c=b.getPoints(),d=0,e=c.length;for(b.setFillStyle(a);e>d;d++)c[d].setFillStyle(a);return this},j.highlight=function(){var a="rgba(255,165,0,0.8)";return j.fill(a)},j.isDeleted=function(){return l.deleted},j.isOn=function(a,b){if(l.deleted||"hidden"===l.visibility)return!1;var c=h.isOn(a,b);return c?c:!1},j.isVisible=function(){return"visible"===l.visibility?!0:!1},j.lockTagVisibility=function(){return m.tagVisibility=!0,this},j.lockVisibility=function(){return m.visibility=!0,this},j.overlap=function(a,b){if(b||(b="boundingbox"),"boundingbox"!==b)throw j.className+": "+mobede+" is not a valid option.";var c=j.getPath(),d=a.getPath();return c.overlap(d,b)},j.removePath=function(){h.removePoints(),h=void 0},j.render=function(a,b,c){if(c||(c=!1),!l.deleted)if("visible"===l.visibility){if("visible"===l.tagVisibility){k.labelDescription;c||(d(a),h.renderBoundingBox(a),e())}h.render2(a,b)}else;return this},j.renderOnMap=g,j.resetFillStyle=function(){var a=j.getPath(),b=a.getPoints(),c=0,d=b.length;for(a.resetFillStyle();d>c;c++)b[c].resetFillStyle();return this},j.resetTagCoordinate=function(){return k.tagX=0,k.tagY=0,this},j.setAlpha=function(a){var b=j.getPath(),c=b.getPoints(),d=0,e=c.length,f=b.getFillStyle();for(f=svl.util.color.changeAlphaRGBA(f,.3),b.setFillStyle(f);e>d;d++)c[d].setFillStyle(f);return this},j.setIconPath=function(a){if(h&&h.points[0]){var b=h.points[0];return b.setIconPath(a),this}return!1},j.setLabelerId=function(a){return k.labelerId=a,this},j.setStatus=function(a,b){a in l&&("visibility"!==a||"visible"!==b&&"hidden"!==b?"tagVisibility"!==a||"visible"!==b&&"hidden"!==b?"deleted"===a&&"boolean"==typeof b&&(l[a]=b):j.setTagVisibility(b):j.setVisibility(b))},j.setTagVisibility=function(a){return m.tagVisibility||("visible"===a||"hidden"===a)&&(l.tagVisibility=a),this},j.setSubLabelDescription=function(a){var b=getLabelDescriptions(),c=b[a].text;return k.labelProperties.subLabelDescription=c,this},j.setVisibility=function(a){return m.visibility||(l.visibility=a),this},j.setVisibilityBasedOnLocation=function(a,b){return l.deleted||(b===k.panoId?j.setVisibility(a):(a="visible"===a?"hidden":"visible",j.setVisibility(a))),this},j.setVisibilityBasedOnLabelerId=function(a,b,c){return void 0===c?-1!==b.indexOf(k.labelerId)?j.unlockVisibility().setVisibility(a).lockVisibility():(a="visible"===a?"hidden":"visible",j.unlockVisibility().setVisibility(a).lockVisibility()):c?-1!==b.indexOf(k.labelerId)&&j.unlockVisibility().setVisibility(a).lockVisibility():-1===b.indexOf(k.labelerId)&&j.unlockVisibility().setVisibility(a).lockVisibility(),this},j.setVisibilityBasedOnLabelerIdAndLabelTypes=function(a,b,c){var d,e=b.length,f=!1;for(d=0;e>d;d+=1)-1!==b[d].userIds.indexOf(k.labelerId)&&-1!==b[d].labelTypesToRender.indexOf(k.labelProperties.labelType)&&(f=!0);void 0===c?f?j.unlockVisibility().setVisibility(a).lockVisibility():(a="visible"===a?"hidden":"visible",j.unlockVisibility().setVisibility(a).lockVisibility()):c?f&&j.unlockVisibility().setVisibility(a).lockVisibility():f||j.unlockVisibility().setVisibility(a).lockVisibility()},j.unlockTagVisibility=function(){return m.tagVisibility=!1,this},j.unlockVisibility=function(){return m.visibility=!1,this},j.toLatLng=f,c(b,a)?j:!1}function LabeledLandmarkFeedback(a,b){function c(a){svl.ui&&svl.ui.ribbonMenu&&(d=svl.ui.labeledLandmark.curbRamp,e=svl.ui.labeledLandmark.noCurbRamp,f=svl.ui.labeledLandmark.submitted,d.html(0),e.html(0))}var d,e,f,g={className:"LabeledLandmarkFeedback"};return g.setLabelCount=function(a){return svl.ui&&svl.ui.ribbonMenu&&(d.html(a.CurbRamp),e.html(a.NoCurbRamp)),this},g.setSubmittedLabelMessage=function(a){if(!a)return this;if(svl.ui&&svl.ui.ribbonMenu)if("message"in a)f.html(b);else if("numCurbRampLabels"in a&&"numMissingCurbRampLabels"in a){var b="You've submitted <b>"+a.numCurbRampLabels+"</b> curb ramp labels and <br /><b>"+a.numMissingCurbRampLabels+"</b> missing curb ramp labels.";f.html(b)}return this},c(b),g}function Main(a,b){function c(b){var c,d=b.panoId,e=parseFloat(b.initLat),f=parseFloat(b.initLng);c=parseFloat(c),svl.rootDirectory="rootDirectory"in b?b.rootDirectory:"/",svl.ui=new UI(a),svl.tracker=new Tracker,svl.keyboard=new Keyboard(a),svl.canvas=new Canvas(a),svl.form=new Form(a,b.form),svl.examples=void 0,svl.overlayMessageBox=new OverlayMessageBox(a),svl.missionDescription=new MissionDescription(a,b.missionDescription),svl.labeledLandmarkFeedback=new LabeledLandmarkFeedback(a),svl.qualificationBadges=void 0,svl.progressFeedback=new ProgressFeedback(a),svl.actionStack=new ActionStack(a),svl.ribbon=new RibbonMenu(a),svl.messageBox=new MessageBox(a),svl.zoomControl=new ZoomControl(a),svl.tooltip=void 0,svl.onboarding=void 0,svl.progressPov=new ProgressPov(a),svl.pointCloud=new PointCloud(a,{panoIds:[d]}),svl.form.disableSubmit(),svl.tracker.push("TaskStart");var g={};g.canvas=svl.canvas,g.overlayMessageBox=svl.overlayMessageBox;var h=[],i=-1,j=-1,k=-1,l=!1;i=1,j=1,k=i-j,c=k/i,svl.form.setTaskRemaining(j),svl.form.setTaskDescription("TestTask"),svl.form.setTaskPanoramaId(d),g.Lat=e,g.Lng=f,g.panoramaPov={heading:0,pitch:-10,zoom:1},g.taskPanoId=d,h=[g.taskPanoId],g.availablePanoIds=h,svl.missionDescription.setCurrentStatusDescription('Your mission is to <span class="bold">find and label</span> presence and absence of curb ramps at intersections.'),svl.progressFeedback.setProgress(c),svl.progressFeedback.setMessage("You have finished "+(i-j)+" out of "+i+"."),l?(svl.messageBox.setPosition(10,120,width=400,height=void 0,background=!0),svl.messageBox.setMessage("<span class='bold'>Remember, label all the landmarks close to the bus stop.</span> Now the actual task begins. Click OK to start the task."),svl.messageBox.appendOKButton(),svl.messageBox.show()):svl.messageBox.hide(),svl.map=new Map(a,g),svl.map.disableClickZoom()}var d={moduleName:"Main"};return c(b),d}function getPanoId(){if(svl.panorama){var a=svl.panorama.getPano();return a}throw"getPanoId() (in Map.js): panorama not defined."}function getPosition(){if(!svl.panorama)throw"getPosition() (in Map.js): panorama not defined.";var a=svl.panorama.getPosition();if(a){var b={lat:a.lat(),lng:a.lng()};return b}}function getPOV(){if(svl.panorama){for(var a=svl.panorama.getPov();a.heading<0;)a.heading+=360;for(;a.heading>360;)a.heading-=360;return a}throw"getPOV() (in Map.js): panoarama not defined."}function getLinks(){if(svl.panorama){var a=svl.panorama.getLinks();return a}throw"getLinks() (in Map.js): panorama not defined."}function Map(a,b){function c(b){if(b=b||{},Q.properties=V,V.browser=svl.util.getBrowser(),"overlayMessageBox"in b&&(C=b.overlayMessageBox),!b.taskPanoId)throw b.Lat&&b.Lng?(E=new google.maps.LatLng(b.Lat,b.Lng),D={mode:"html4",position:E,pov:V.panoramaPov},Q.className+" init(): Specifying a dropping point with a latlng coordinate is no longer a good idea. It does not drop the pegman on the specified position."):Q.className+" init(): The pano id nor panorama position is give. Cannot initialize the panorama.";D={mode:"html4",pov:V.panoramaPov,pano:b.taskPanoId};var c=document.getElementById("pano");svl.panorama=new google.maps.StreetViewPanorama(c,D),svl.panorama.set("addressControl",!1),svl.panorama.set("clickToGo",!1),svl.panorama.set("disableDefaultUI",!0),svl.panorama.set("linksControl",!0),svl.panorama.set("navigationControl",!1),svl.panorama.set("panControl",!1),svl.panorama.set("zoomControl",!1),V.initialPanoId=b.taskPanoId,J=svl.ui.map.canvas,K=svl.ui.map.drawingLayer,L=svl.ui.map.pano,M=svl.ui.map.streetViewHolder,N=svl.ui.map.viewControlLayer,O=svl.ui.map.modeSwitchWalk,P=svl.ui.map.modeSwitchDraw,W.availablePanoIds=b.availablePanoIds,N.bind("mousedown",u),N.bind("mouseup",v),N.bind("mousemove",w),N.bind("mouseleave",x),google.maps.event.addListener(svl.panorama,"pov_changed",p),google.maps.event.addListener(svl.panorama,"position_changed",p),google.maps.event.addListener(svl.panorama,"pano_changed",s),F.setStreetView(svl.panorama),google.maps.event.addListenerOnce(svl.panorama,"pano_changed",Q.modeSwitchWalkClick),I=setInterval(o,100),"onboarding"in svl&&svl.onboarding&&"Onboarding_LabelingCurbRampsDifficultScene"===svl.onboarding.className&&(Y.zoomViewAngles=[Math.PI/2,Math.PI/4,Math.PI/8]),Y.interval=setInterval(n,250),S=setInterval(d,.2),V.isInternetExplore=a.browser.msie,V.isInternetExplore&&N.append('<canvas width="720px" height="480px"  class="Window_StreetView" style=""></canvas>')}function d(){var b=a(".gmnoprint");b.length>0&&(window.clearInterval(S),a.each(a(".gmnoprint"),function(b,c){var d=a(c).find("img");d&&d.css("visibility","hidden")}))}function e(){W.disableClickZoom=!0}function f(){return W.lockDisableWalking||(l(),O.css("opacity",.5),W.disableWalking=!0),this}function g(){W.disableClickZoom=!1}function h(){W.lockDisableWalking||(r(),O.css("opacity",1),W.disableWalking=!1)}function i(){var a=svl.getPOV();if(a){var b=a.heading,c=b*(Math.PI/180);svl.fog.updateFromPOV(current,radius,c,Math.PI/2)}}function j(){return V.map}function k(){return L.find("svg").parent()}function l(){return"chrome"===V.browser?a("path").css("visibility","hidden"):a("path").css("visibility","hidden"),this}function m(){var a=k();N.append(a),"mozilla"===V.browser?N.append(J):"msie"===V.browser&&N.insertBefore(K)}function n(){current&&(Y.center=current,Y.radius=200,current=svl.panorama.getPosition(),svl.fog=new Fog(F,Y),fogSet=!0,window.clearInterval(Y.interval),i())}function o(){var a=N.find("path").length;0!==a&&(W.svLinkArrowsLoaded=!0,window.clearTimeout(I))}function p(){if(svl.canvas){getPosition(),svl.getPOV().heading;svl.canvas.clear(),W.currentPanoId!==svl.getPanoId()&&svl.canvas.setVisibilityBasedOnLocation("visible",svl.getPanoId()),W.currentPanoId=svl.getPanoId(),"Evaluation"===V.mode&&myTables.updateCanvas(),svl.canvas.render2()}fogMode&&"fog"in svl&&(current=svl.panorama.getPosition(),current&&fogSet&&i()),a("svg")[0]&&(Z||(Z=!0,a("svg")[0].addEventListener("mousedown",function(a){r()})))}function q(a){switch(a){case"ZoomOut":N.css("cursor","url("+svl.rootDirectory+"img/cursors/Cursor_ZoomOut.png) 4 4, move");break;case"OpenHand":N.css("cursor","url("+svl.rootDirectory+"img/cursors/openhand.cur) 4 4, move");break;case"ClosedHand":N.css("cursor","url("+svl.rootDirectory+"img/cursors/closedhand.cur) 4 4, move");break;default:N.css("cursor","default")}}function r(b){if(!W.svLinkArrowsLoaded){var c=N.find("path").length;0===c?m():W.svLinkArrowsLoaded=!0}W.hideNonavailablePanoLinks&&W.availablePanoIds?a.each(a("path"),function(b,c){if(a(c).attr("pano")){var d=a(c).attr("pano"),e=W.availablePanoIds.indexOf(d);-1===e?(a(c).prev().prev().remove(),a(c).prev().remove(),a(c).remove()):(a(c).prev().prev().css("visibility","visible"),a(c).prev().css("visibility","visible"),a(c).css("visibility","visible"))}}):"chrome"===V.browser?a("path").css("visibility","visible"):(b||(b=0),a("path").css("visibility","visible"))}function s(){if(!svl.panorama)throw Q.className+" updateMap(): panorama not defined.";var a=svl.panorama.getPosition();if(F.setCenter(a),svl.canvas&&(svl.canvas.clear(),svl.canvas.setVisibilityBasedOnLocation("visible",svl.getPanoId()),"Evaluation"===V.mode&&myTables.updateCanvas(),svl.canvas.render2()),fogSet&&i(),"pointCloud"in svl&&svl.pointCloud){var b=svl.getPanoId(),c=svl.pointCloud.getPointCloud(b);c||(svl.pointCloud.createPointCloud(svl.getPanoId()),svl.pointCloud.ready(b,function(){}))}}function t(a,b){if(!svl.panorama)throw R+" updatePov(): panorama not defined!";var c=svl.panorama.getPov(),d=.25;c.heading-=d*a,c.pitch+=d*b,c.pitch>V.maxPitch?c.pitch=V.maxPitch:c.pitch<V.minPitch&&(c.pitch=V.minPitch),V.minHeading&&V.maxHeading&&(V.minHeading<=V.maxHeading?c.heading>V.maxHeading?c.heading=V.maxHeading:c.heading<V.minHeading&&(c.heading=V.minHeading):c.heading<V.minHeading&&c.heading>V.maxHeading&&(Math.abs(c.heading-V.maxHeading)<Math.abs(c.heading-V.minHeading)?c.heading=V.maxHeading:c.heading=V.minHeading)),V.panoramaPov=c,svl.panorama.setPov(c)}function u(b){if(X.isLeftDown=!0,X.leftDownX=mouseposition(b,this).x,X.leftDownY=mouseposition(b,this).y,!W.disableWalking)try{q(svl.keyboard.isShiftDown()?"ZoomOut":"ClosedHand")}catch(b){console.error(b)}if(!W.panoLinkListenerSet)try{a("svg")[0].addEventListener("click",function(a){var b=a.target.getAttribute("pano");b&&svl.tracker.push("WalkTowards",{TargetPanoId:b})}),W.panoLinkListenerSet=!0}catch(c){}svl.tracker.push("ViewControl_MouseDown",{x:X.leftDownX,y:X.leftDownY})}function v(a){var b;if(X.isLeftDown=!1,X.leftUpX=mouseposition(a,this).x,X.leftUpY=mouseposition(a,this).y,svl.tracker.push("ViewControl_MouseUp",{x:X.leftUpX,y:X.leftUpY}),!W.disableWalking)try{q(svl.keyboard.isShiftDown()?"ZoomOut":"OpenHand")}catch(a){console.error(a)}b=(new Date).getTime(),b-X.prevMouseUpTime<300&&(W.disableClickZoom||(svl.tracker.push("ViewControl_DoubleClick"),svl.keyboard.isShiftDown()?(svl.zoomControl.zoomOut(),svl.tracker.push("ViewControl_ZoomOut")):(svl.zoomControl.pointZoomIn(X.leftUpX,X.leftUpY),svl.tracker.push("ViewControl_ZoomIn")))),X.prevMouseUpTime=b}function w(a){if(X.currX=mouseposition(a,this).x,X.currY=mouseposition(a,this).y,W.disableWalking)q("default");else if(r(2e3),!X.isLeftDown)try{q(svl.keyboard.isShiftDown()?"ZoomOut":"OpenHand")}catch(a){console.error(a)}if(X.isLeftDown&&W.disableWalking===!1){var b=X.currX-X.prevX,c=X.currY-X.prevY,d=svl.getPOV(),e=d.zoom,f=svl.zoomFactor[e];b/=2*f,c/=2*f,b*=1.5,c*=1.5,t(b,c)}if("canvas"in svl&&svl.canvas){var g=svl.canvas.isOn(X.currX,X.currY);if(g&&"Point"===g.className){var h=g.belongsTo(),i=h.belongsTo();svl.canvas.setCurrentLabel(i),svl.canvas.showLabelTag(i),svl.canvas.clear(),svl.canvas.render2()}else if(g&&"Label"===g.className){var i=g;svl.canvas.setCurrentLabel(i),svl.canvas.showLabelTag(i)}else if(g&&"Path"===g.className){var j=g.belongsTo();svl.canvas.clear(),svl.canvas.render2(),svl.canvas.showLabelTag(j)}else svl.canvas.showLabelTag(void 0),svl.canvas.setCurrentLabel(void 0)}X.prevX=mouseposition(a,this).x,X.prevY=mouseposition(a,this).y}function x(a){X.isLeftDown=!1}function y(){return V.maxPitch}function z(){return V.minPitch}function A(){K.css("z-index","1"),N.css("z-index","0"),"mozilla"===V.browser&&K.append(J),l()}var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q={className:"Map"},R="Map",S=void 0,T={renderLabels:!1},U=[],V={browser:"unknown",latlng:{lat:void 0,lng:void 0},initialPanoId:void 0,panoramaPov:{heading:359,pitch:-10,zoom:1},map:null,maxPitch:0,minPitch:-35,minHeading:void 0,maxHeading:void 0,mode:"Labeling",isInternetExplore:void 0},W={availablePanoIds:void 0,currentPanoId:void 0,disableWalking:!1,disableClickZoom:!1,hideNonavailablePanoLinks:!1,lockDisableWalking:!1,panoLinkListenerSet:!1,svLinkArrowsLoaded:!1},X={currX:0,currY:0,prevX:0,prevY:0,leftDownX:0,leftDownY:0,leftUpX:0,leftUpY:0,isLeftDown:!1},Y={interval:void 0,ready:void 0},Z=!1;if(b.panoramaPov?V.panoramaPov=b.panoramaPov:V.panoramaPov={heading:0,pitch:0,zoom:1},b.latlng)V.latlng=b.latlng;else{if(!("Lat"in b&&"Lng"in b))throw Q.className+": latlng not defined.";V.latlng={lat:b.Lat,lng:b.Lng}}E=new google.maps.LatLng(V.latlng.lat,V.latlng.lng),G={center:E,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,maxZoom:20,minZoom:14,overviewMapControl:!1,panControl:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!0,zoomControl:!1,zoom:18};var $=document.getElementById("google-maps");return F=new google.maps.Map($,G),V.map=F,H=[{featureType:"all",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"on"}]},{elementType:"labels",stylers:[{visibility:"off"}]}],F.setOptions({styles:H}),Q.disableWalking=function(){return W.lockDisableWalking?!1:(f(),this)},Q.enableWalking=function(){return W.lockDisableWalking?!1:(h(),this)},Q.getInitialPanoId=function(){return V.initialPanoId},Q.getMap=j,Q.getMaxPitch=y,Q.getMinPitch=z,Q.getProperty=function(a){return a in V?V[a]:!1},Q.lockDisableWalking=function(){return W.lockDisableWalking=!0,this},Q.lockRenderLabels=function(){return T.renderLabels=!0,this},Q.modeSwitchWalkClick=function(){N.css("z-index","1"),K.css("z-index","0"),W.disableWalking||(r(),m())},Q.plotMarkers=function(){if(B){var a=void 0,b=0,c=void 0,d=void 0,e=void 0;a=B.getLabels(),b=a.length;for(var f=0;f<U.length;f+=1)U[f].setMap(null);for(U=[],f=0;b>f;f++)if(c=a[f].getProperties(),d=c.labelProperties.labelType,e=c.panoramaProperties.latlng,-1===c.labelerId.indexOf("Researcher")){var g=new google.maps.LatLng(e.lat,e.lng),h=new google.maps.Marker({position:g,map:F,zIndex:f});U.push(h)}}return!1},Q.setHeadingRange=function(a){return V.minHeading=a[0],V.maxHeading=a[1],this},Q.setMode=function(a){return V.mode=a,this},Q.setPitchRange=function(a){return V.minPitch=a[0],V.maxPitch=a[1],this},Q.setPov=function(a,b,c){if("panorama"in svl&&svl.panorama){var d,e=svl.panorama.getPov();if(a.heading=parseInt(a.heading,10),a.pitch=parseInt(a.pitch,10),
a.zoom=parseInt(a.zoom,10),a.pitch>V.maxPitch?a.pitch=V.maxPitch:a.pitch<V.minPitch&&(a.pitch=V.minPitch),V.minHeading&&V.maxHeading&&(V.minHeading<=V.maxHeading?a.heading>V.maxHeading?a.heading=V.maxHeading:a.heading<V.minHeading&&(a.heading=V.minHeading):a.heading<V.minHeading&&a.heading>V.maxHeading&&(Math.abs(a.heading-V.maxHeading)<Math.abs(a.heading-V.minHeading)?a.heading=V.maxHeading:a.heading=V.minHeading)),b){var f,g=25,h=(a.heading-e.heading+360)%360,i=360-h;f=i>h?h*(g/b):-i*(g/b);var j,k=a.pitch-e.pitch;j=k*(g/b),d=window.setInterval(function(){var b=a.heading-e.heading;Math.abs(b)>1?(e.heading+=f,e.pitch+=j,e.heading=(e.heading+360)%360,e.pitch=e.pitch,svl.panorama.setPov(e)):(a.zoom||(a.zoom=1),svl.panorama.setZoom(a.zoom),window.clearInterval(d),c&&c())},g)}else svl.panorama.setPov(a)}return this},Q.setStatus=function(a,b){if(a in W){if("disableWalking"===a){if("boolean"!=typeof b)return!1;b?f():h()}else W[a]=b;return this}return!1},Q.unlockDisableWalking=function(){return W.lockDisableWalking=!1,this},Q.unlockRenderLabels=function(){return T.renderLabels=!1,this},Q.disableClickZoom=e,Q.enableClickZoom=g,Q.hideLinks=l,Q.modeSwitchLabelClick=A,c(b),Q}function MessageBox(a,b){function c(){d=a("#message-box-holder"),e=a("#message-box")}var d,e,f={className:"MessageBox"},g='<button id="MessageBoxOkButton" class="button" style="position: absolute; bottom: 10px; left: 10px;">OK</button>';return f.setMessage=function(a){return e.html(a),this},f.setPosition=function(a,b,c,f,g){return a&&"number"==typeof a&&(a+="px"),b&&"number"==typeof b&&(b+="px"),c?"number"==typeof c&&(c+="px"):c="240px",f&&"number"==typeof f&&(f+="px"),g||(g=!1),g?(d.css({height:"100%",left:"0px",top:"0px",visibility:"visible",width:"100%",zIndex:1e3}),e.css({left:a,top:b,width:c,zIndex:1e3}),f&&e.css("height",f)):(d.css({height:"1px",left:a,top:b,width:"1px",zIndex:1e3}),e.css({left:"0px",top:"0px",width:c}),f&&e.css("height",f)),this},f.appendOKButton=function(b){e.css("padding-bottom","50px"),e.append(g),a("#MessageBoxOkButton").on("click",function(){"tracker"in svl&&svl.tracker&&(b?svl.tracker.push("MessageBox_ClickOk",{message:b}):svl.tracker.push("MessageBox_ClickOk")),d.css({visibility:"hidden"}),e.css({"padding-bottom":"",visibility:"hidden"}),a("#MessageBoxOkButton").remove()})},f.hide=function(){return e.css("visibility","hidden"),d.css("visibility","hidden"),this},f.show=function(a){return a||(a=!1),e.css("visibility","visible"),a&&d.css("visibility","visible"),this},c(),f}function MissionDescription(a,b){function c(a){svl.ui&&svl.ui.missinDescription&&(e=svl.ui.missinDescription.description,e.html(a.description))}function d(a){return svl.ui&&svl.ui.missinDescription&&e.html(a),this}var e,f={className:"MissionDescription"};return f.setCurrentStatusDescription=d,c(b),f}function Mouse(a){function b(){a(document).bind("mouseup",c)}function c(a){var b;a=a||window.event,"which"in a?b=3==a.which:"button"in a&&(b=2==a.button)}var d={className:"Mouse"};return b(),d}function OverlayMessageBox(a,b){function c(){svl.ui&&svl.ui.overlayMessage&&(d=svl.ui.overlayMessage.message,e=svl.ui.overlayMessage.box,f.setMessage("Walk"))}var d,e,f={className:"OverlayMessageBox"},g={visibility:"visible"};return f.setMessage=function(a,b){var c=svl.misc.getLabelInstructions(),f=svl.misc.getLabelColors();if(a in c&&a in f){var g=f[a],h=changeAlphaRGBA(g.fillStyle,.85);return h=changeDarknessRGBA(h,.35),e.css({background:h}),d.css({color:c[a].textColor}),b?d.html(b):d.html("<strong>"+c[a].instructionalText+"</strong>"),this}return!1},f.setVisibility=function(a){return("visible"===a||"hidden"===a)&&(g.visibility=a),this},c(),f}function Path(a,b){function c(a,b){var c,d;for(m.points=a,c=a.length,d=0;c>d;d+=1)a[d].setBelongsTo(m);if(b)for(var e in b)e in n&&(n[e]=b[e]);n.fillStyle=changeAlphaRGBA(a[0].getProperty("fillStyleInnerCircle"),.5),n.originalFillStyle=n.fillStyle,n.originalStrokeStyle=n.strokeStyle}function d(){return n.lineWidth}function e(){return n.fillStyle}function f(a){n.fillStyle=a}function g(b){var c,d,e,f,g,h,j=b?b:svl.getPOV(),k=i(j);if(a.length>2){d=-1,c=1e6,f=-1,e=1e6;for(var l=0;l<k.length;l+=1){var m=k[l];m.x<c&&(c=m.x),m.x>d&&(d=m.x),m.y<e&&(e=m.y),m.y>f&&(f=m.y)}g=d-c,h=f-e}else c=k[0].x,e=k[0].y,g=0,h=0;return{x:c,y:e,width:g,height:h}}function h(){var a,b,c=j(),d=c.length,e=-1,f=1e6,g=-1e6,h=1e6,i=!1;for(a=0;d>a;a++)b=c[a],b.x<f&&(f=b.x),b.x>e&&(e=b.x),b.y<h&&(h=b.y),b.y>g&&(g=b.y);if(e-f>5e3)for(i=!0,e=-1,f=1e6,a=0;d>a;a++)b=c[a],b.x>6e3?b.x<f&&(f=b.x):b.x>e&&(e=b.x);return i?{x:f,y:h,width:svl.svImageWidth-f+e,height:g-h,boundary:!0}:{x:f,y:h,width:e-f,height:g-h,boundary:!1}}function i(a){var b,c,d=j(),e=d.length,f=[],g=1e7,h=-1;for(b=0;e>b;b+=1)g>d[b].x&&(g=d[b].x),h<d[b].x&&(h=d[b].x);var i=3328;for(b=0;e>b;b+=1)a.heading<180?h>svl.svImageWidth-i&&d[b].x>i&&(d[b].x-=svl.svImageWidth):i>g&&d[b].x<svl.svImageWidth-i&&(d[b].x+=svl.svImageWidth),c=svl.gsvImageCoordinate2CanvasCoordinate(d[b].x,d[b].y,a),f.push(c);return f}function j(){var a,b=m.points.length,c=[];for(a=0;b>a;a+=1)c.push(m.points[a].getGSVImageCoordinate());return c}function k(a){var b=g();a.save(),a.lineWidth=2,a.strokeStyle="rgba(255,255,255,1)",a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(b.x+b.width,b.y),a.lineTo(b.x+b.width,b.y+b.height),a.lineTo(b.x,b.y+b.height),a.lineTo(b.x,b.y),a.stroke(),a.closePath(),a.restore()}var l,m={className:"Path",points:void 0},n={fillStyle:"rgba(255,255,255,0.5)",lineCap:"round",lineJoin:"round",lineWidth:"3",numPoints:a.length,originalFillStyle:void 0,originalStrokeStyle:void 0,strokeStyle:"rgba(255,255,255,1)",strokeStyle_bg:"rgba(255,255,255,1)"},o={visibility:"visible"};return m.belongsTo=function(){return l?l:!1},m.getPOV=function(){return a[0].getPOV()},m.getBoundingBox=function(a){return g(a)},m.getLineWidth=function(){return d()},m.getFill=function(){return e()},m.getFillStyle=function(){return n.fillStyle},m.getSvImageBoundingBox=function(){return h()},m.getImageCoordinates=function(){return j()},m.getPoints=function(b){return b||(b=!1),b?a:$.extend(!0,[],a)},m.getProperty=function(a){return n[a]},m.isOn=function(a,b){var c,d,e,f,h;for(f=m.points.length,d=0;f>d;d+=1)if(e=m.points[d],h=e.isOn(a,b))return h;return c=g(),c.x<a&&c.x+c.width>a&&c.y<b&&c.y+c.height>b?this:!1},m.overlap=function(a,b){b||(b="boundingbox");var c=0;if("boundingbox"===b){var d,e,f=h(),g=a.getSvImageBoundingBox();f.boundary&&g.boundary||(f.boundary?(f.x=f.x-svl.svImageWidth,g.x>6e3&&(g.x=g.x-svl.svImageWidth)):g.boundary&&(g.x=g.x-svl.svImageWidth,f.x>6e3&&(f.x=f.x-svl.svImageWidth))),d=f.x<g.x?f.x:g.x,e=f.y<g.y?f.y:g.y,f.x-=d,g.x-=d,f.y-=e,g.y-=e;var i=f.x,j=f.x+f.width,k=f.y,l=f.y+f.height,m=g.x,n=g.x+g.width,o=g.y,p=g.y+g.height,q=0,r=0,s=n>j?n:j,t=p>l?p:l,u=0,v=0,w=!1,x=!1;for(q=0;s>q;q++)for(r=0;t>r;r++)w=q>i&&j>q&&r>k&&l>r,x=q>m&&n>q&&r>o&&p>r,w&&x&&(v+=1),(w||x)&&(u+=1);c=v/u}return c},m.removePoints=function(){m.points=void 0},m.render2=function(a,b){return m.render(b,a)},m.render=function(a,b){if("visible"===o.visibility){var c,d,e;c=m.points.length;var f=i(a);if(d=m.points[0],b.save(),b.beginPath(),n.fillStyle?b.fillStyle=n.fillStyle:(n.fillStyle=changeAlphaRGBA(d.getProperty("fillStyleInnerCircle"),.5),n.originalFillStyle=n.fillStyle,b.fillStyle=n.fillStyle),c>1){for(b.moveTo(f[0].x,f[0].y),e=1;c>e;e+=1)b.lineTo(f[e].x,f[e].y);b.lineTo(f[0].x,f[0].y),b.fill(),b.closePath(),b.restore()}for(e=0;c>e;e+=1)d=m.points[e],d.render(a,b);if(c>1)for(e=0;c>e;e+=1){if(e>0)var g=f[e],h=f[e-1];else var g=f[e],h=f[c-1];var j=d.getProperty("radiusInnerCircle");b.save(),b.strokeStyle=n.strokeStyle,svl.util.shape.lineWithRoundHead(b,h.x,h.y,j,g.x,g.y,j),b.restore()}}},m.renderBoundingBox=k,m.resetFillStyle=function(){return n.fillStyle=n.originalFillStyle,this},m.resetStrokeStyle=function(){return n.strokeStyle=n.originalStrokeStyle,this},m.setFill=function(a){return f("rgba"==a.substring(0,4)?a:"rgba"+a.substring(3,a.length-1)+",0.5)"),this},m.setBelongsTo=function(a){return l=a,this},m.setLineWidth=function(a){return isNaN(a)||(n.lineWidth=""+a),this},m.setFillStyle=function(a){return void 0!=a&&(n.fillStyle=a),this},m.setStrokeStyle=function(a){return n.strokeStyle=a,this},m.setVisibility=function(a){return("visible"===a||"hidden"===a)&&(o.visibility=a),this},c(a,b),m}function Point(a,b,c,d){"use strict";function e(a,b,c,d){var e=c.zoom,f=svl.zoomFactor[e],g=svl.svImageHeight,h=svl.svImageWidth;q.svImageCoordinate={},q.svImageCoordinate.x=h*c.heading/360+svl.alpha_x*(a-svl.canvasWidth/2)/f,q.svImageCoordinate.y=g/2*c.pitch/90+svl.alpha_y*(b-svl.canvasHeight/2)/f,q.svImageCoordinate.x<0&&(q.svImageCoordinate.x=q.svImageCoordinate.x+h),q.canvasCoordinate={x:a,y:b},q.originalCanvasCoordinate={x:a,y:b},q.pov={heading:c.heading,pitch:c.pitch,zoom:c.zoom},q.originalPov={heading:c.heading,pitch:c.pitch,zoom:c.zoom};for(var i in s){if("iconImagePath"===i){if(!d.iconImagePath)continue;s.iconImagePath=d.iconImagePath}i in d?s[i]=d[i]:-1===t.indexOf(i)}return s.originalFillStyleInnerCircle=s.fillStyleInnerCircle,s.originalStrokeStyleOuterCircle=s.strokeStyleOuterCircle,!0}function f(){return!0}function g(){return q.canvasCoordinate.x}function h(){return q.canvasCoordinate.y}function i(){return s.fillStyleInnerCircle}function j(){return c}function k(){return s.fillStyleInnerCircle=s.originalFillStyleInnerCircle,this}function l(a){return q.svImageCoordinate=a,q.canvasCoordinate={x:0,y:0},this}function m(){return s.strokeStyleOuterCircle=s.originalStrokeStyleOuterCircle,this}function n(a){return r=a,this}function o(a){return s.fillStyleInnerCircle=a,this}function p(a){return s.iconImagePath=a,this}void 0==d.fillStyle&&(d.fillStyle="rgba(255,255,255,0.5)");var q={className:"Point",svImageCoordinate:void 0,canvasCoordinate:void 0,originalCanvasCoordinate:void 0,pov:void 0,originalPov:void 0},r=void 0,s={fillStyleInnerCircle:d.fillStyle,lineWidthOuterCircle:2,iconImagePath:void 0,originalFillStyleInnerCircle:void 0,originalStrokeStyleOuterCircle:void 0,radiusInnerCircle:4,radiusOuterCircle:5,strokeStyleOuterCircle:"rgba(255,255,255,1)",storedInDatabase:!1},t=["originalFillStyleInnerCircle","originalStrokeStyleOuterCircle"],u={deleted:!1,visibility:"visible",visibilityIcon:"visible"};q.belongsTo=function(){return r?r:!1},q.getPOV=function(){return j()},q.getCanvasCoordinate=function(a){return q.canvasCoordinate=svl.gsvImageCoordinate2CanvasCoordinate(q.svImageCoordinate.x,q.svImageCoordinate.y,a),svl.gsvImageCoordinate2CanvasCoordinate(q.svImageCoordinate.x,q.svImageCoordinate.y,a)},q.getCanvasX=g,q.getCanvasY=h,q.getFill=i,q.getFillStyle=function(){return i()},q.getGSVImageCoordinate=function(){return $.extend(!0,{},q.svImageCoordinate)},q.getProperty=function(a){if(!(a in s))throw q.className+' : A property name "'+a+'" does not exist in properties.';return s[a]},q.getProperties=function(){return $.extend(!0,{},s)},q.isOn=function(a,b){var c=s.radiusOuterCircle/2+3;return a<q.canvasCoordinate.x+c&&a>q.canvasCoordinate.x-c&&b<q.canvasCoordinate.y+c&&b>q.canvasCoordinate.y-c?this:!1},q.render=function(a,b){if("visible"===u.visibility){var c,d,e;s.radiusInnerCircle;c=q.getCanvasCoordinate(a),d=c.x,e=c.y,b.save(),b.strokeStyle=s.strokeStyleOuterCircle,b.lineWidth=s.lineWidthOuterCircle,b.beginPath(),b.arc(d,e,s.radiusOuterCircle,2*Math.PI,0,!0),b.closePath(),b.stroke(),b.fillStyle=s.fillStyleInnerCircle,b.beginPath(),b.arc(d,e,s.radiusInnerCircle,2*Math.PI,0,!0),b.closePath(),b.fill(),b.restore()}},q.resetFillStyle=k,q.resetSVImageCoordinate=l,q.resetStrokeStyle=m,q.setBelongsTo=n,q.setFillStyle=o,q.setIconPath=p,q.setPhotographerPov=function(a,b){return s.photographerHeading=a,s.photographerPitch=b,this},q.setProperties=function(a){for(var b in a)b in s&&(s[b]=a[b]);return"originalCanvasCoordinate"in a&&(q.originalCanvasCoordinate=a.originalCanvasCoordinate),q.pov=q.pov||{},"pov"in a&&(q.pov=a.pov),"heading"in a&&(q.pov.heading=a.heading),"pitch"in a&&(q.pov.pitch=a.pitch),"zoom"in a&&(q.pov.zoom=a.zoom),q.originalPov=q.originalPov||{},"originalHeading"in a&&(q.originalPov.heading=a.originalHeading),"originalPitch"in a&&(q.originalPov.pitch=a.originalPitch),"originalZoom"in a&&(q.originalPov.zoom=a.originalZoom),s.originalFillStyleInnerCircle||(s.originalFillStyleInnerCircle=s.fillStyleInnerCircle),s.originalStrokeStyleOuterCircle||(s.originalStrokeStyleOuterCircle=s.strokeStyleOuterCircle),this},q.setStrokeStyle=function(a){return s.strokeStyleOuterCircle=a,this},q.setVisibility=function(a){return("visible"===a||"hidden"===a)&&(u.visibility=a),this},q.resetProperties=q.setProperties;var v=arguments.length;return 4===v?e(a,b,c,d):f(),q}function PointCloud(a,b){function c(a){if(a=a||{},"panoIds"in a&&a.panoIds)for(var b=0;b<a.panoIds.length;b++)d(a.panoIds[b])}function d(a){if(!(a in j)){var b=new GSVPANO.PanoPointCloudLoader;j[a]=null,b.onPointCloudLoad=function(){if(j[a]=this.pointCloud,a in i){for(var b=0;b<i[a].length;b++)i[a][b]();i[a]=null}},b.load(a)}}function e(a){return a in j?j[a]:(d(a),null)}function f(a,b){a in i||(i[a]=[]),i[a].push(b)}function g(a,b){if(a in j&&e(a)){var c=e(a),d=c.tree.nearest({x:b.x,y:b.y,z:b.z},1,40);if(d&&d[0]){var f=d[0][0].id;return f}}return null}var h={},i={},j={};return h.createPointCloud=d,h.getPointCloud=e,h.ready=f,h.search=g,c(b),h}function ProgressFeedback(a,b){function c(b){d=a("#ProgressBarContainer"),e=a("#ProgressBarFilled"),f=a("#Progress_Message"),h.progressBarWidth=d.width(),b&&b.message?g.setMessage(b.message):g.setMessage(""),g.setProgress(0)}var d,e,f,g={className:"ProgressFeedback"},h={progressBarWidth:void 0},i={progress:void 0};return g.setMessage=function(a){f.html(a)},g.setProgress=function(a){if("number"!=typeof a&&(a=parseFloat(a)),NaN===a)throw new TypeError(g.className+": The passed value cannot be parsed.");if(a>1&&(a=1,console.error(g.className+": You can not pass a value larger than 1 to setProgress.")),i.progress=a,h.progressBarWidth){var b,c,d;.5>a?(b=255,c=parseInt(255*a*2)):(b=parseInt(255*(1-a)*2),c=255),d="rgba("+b+","+c+",0,1)",e.css({background:d,width:a*h.progressBarWidth})}return this},c(b),g}function ProgressPov(a,b){function c(a){g=svl.ui.progressPov.rate,h=svl.ui.progressPov.bar,i=svl.ui.progressPov.filler,k.surveyedAngles=new Array(100);for(var b=0;100>b;b++)k.surveyedAngles[b]=0;if(a&&a.pov)k.previousHeading=a.pov.heading;else try{var c=svl.getPov();k.previousHeading=c.heading}catch(e){k.previousHeading=0}d()}function d(){var a=100*j.getCompletionRate();return a=a.toFixed(0,10),a+="%",g.html(a),this}function e(){var a,b,c,d=j.getCompletionRate(),e=255;.5>d?(a=e,b=parseInt(e*d*2)):(a=parseInt(e*(1-d)*2),b=e),c="rgba("+a+","+b+",0,1)",d*=100,d=d.toFixed(0,10),d-=.8,d+="%",i.css({background:c,width:d})}function f(){d(),e()}var g,h,i,j={className:"ProgressPov"},k={currentCompletionRate:0,previousHeading:0,surveyedAngles:void 0};return j.getCompletionRate=function(){try{if(k.currentCompletionRate<1){var a=25,b=svl.getPOV(),c=b.heading,d=(c-a+360)%360,e=(c+a)%360,f=Math.floor(d/360*100),g=Math.floor(e/360*100),h=0;if(g>f)for(h=f;g>h;h++)k.surveyedAngles[h]=1;else{for(h=f;100>h;h++)k.surveyedAngles[h]=1;for(h=0;g>h;h++)k.surveyedAngles[h]=1}var i=Math.floor(c/360*100),j=k.previousHeading;if(c!==j){var l=Math.floor(j/360*100),m=c-j;if(m>0&&300>m||-300>m)for(h=l;h==k.surveyedAngles.length&&(h=0),k.surveyedAngles[h]=1,h!=i;h++);else for(h=l;-1==h&&(h=k.surveyedAngles.length-1),k.surveyedAngles[h]=1,h!=i;h--);}var n=k.surveyedAngles.reduce(function(a,b){return a+b});return k.currentCompletionRate=n/100,k.previousHeading=c,n/100}return 1}catch(o){return 0}},j.setCompletedHeading=function(a){var b,c=a[0],d=a[1],e=Math.floor(c/360*100),f=Math.floor(d/360*100);for(b=e;f>b;b++)k.surveyedAngles[b]=1;return this},j.updateCompletionRate=function(){return f()},c(b),j}function QualificationBadges(a,b){function c(b){d=a("#BadgeImageHolder_BusStopAuditor"),e=a("#BadgeImageHolder_BusStopExplorer"),d.html('<img src="'+g.badgePlaceHolderImagePath+'" class="'+g.badgeClassName+'">'),e.html('<img src="'+g.badgePlaceHolderImagePath+'" class="'+g.badgeClassName+'">')}var d,e,f={className:"QualificationBadges"},g={badgeClassName:"Badge",badgePlaceHolderImagePath:svl.rootDirectory+"/img/badges/EmptyBadge.png",busStopAuditorImagePath:svl.rootDirectory+"/img/badges/Onboarding_BusStopExplorerBadge_Orange.png",busStopExplorerImagePath:svl.rootDirectory+"/img/badges/Onboarding_BusStopInspector_Green.png"};return f.giveBusStopAuditorBadge=function(){return d.html('<img src="'+g.busStopAuditorImagePath+'" class="'+g.badgeClassName+'">'),this},f.giveBusStopExplorerBadge=function(){e.html('<img src="'+g.busStopExplorerImagePath+'" class="'+g.badgeClassName+'">')},c(b),f}function RibbonMenu(a,b){function c(){var b=getBrowser();"mozilla"===b?o.originalBackgroundColor="-moz-linear-gradient(center top , #fff, #eee)":"msie"===b?o.originalBackgroundColor="#ffffff":o.originalBackgroundColor="-webkit-gradient(linear, left top, left bottom, from(#fff), to(#eee))";var c=svl.misc.getLabelColors();svl.ui&&svl.ui.ribbonMenu&&(j=svl.ui.ribbonMenu.streetViewHolder,k=svl.ui.ribbonMenu.bottonBottomBorders,l=svl.ui.ribbonMenu.connector,m=svl.ui.ribbonMenu.buttons,a.each(k,function(b,d){var e=a(d).attr("value"),f=c[e].fillStyle;"Walk"===e&&a(d).css("width","56px"),a(d).css("border-top-color",f),a(d).css("background",f)}),i(p.mode),h(p.mode),m.bind("click",e),m.bind({mouseenter:f,mouseleave:g}))}function d(b){var c;if(c="string"==typeof b?b:a(this).attr("val"),p.disableModeSwitch===!1){var d,e,f;"canvas"in svl&&svl.canvas&&svl.canvas.isDrawing()&&svl.canvas.cancelDrawing(),d=getLabelColors(),e=getRibbonConnectionPositions(),f=d[c].fillStyle,"map"in svl&&svl.map&&("Walk"===c?(n.setStatus("mode","Walk"),n.setStatus("selectedLabelType",void 0),svl.map&&svl.map.modeSwitchWalkClick()):(n.setStatus("mode",c),n.setStatus("selectedLabelType",c),svl.map&&svl.map.modeSwitchLabelClick())),svl.ui&&svl.ui.ribbonMenu&&(i(c),h(c),l.css("left",e[c].labelRibbonConnection),l.css("border-left-color",f),j.css("border-color",f)),svl.overlayMessageBox&&svl.overlayMessageBox.setMessage(c)}}function e(){if(p.disableModeSwitch===!1){var b;if(b=a(this).attr("val"),p.allowedMode&&p.allowedMode!==b)return!1;svl.tracker.push("Click_ModeSwitch_"+b),d(b)}}function f(){if(p.disableModeSwitch===!1){var b=a(this).attr("val");if(p.allowedMode&&p.allowedMode!==b)return!1;h(b),i(b)}}function g(){p.disableModeSwitch===!1&&(i(p.mode),h(p.mode))}function h(b){if(svl.ui&&svl.ui.ribbonMenu){var c,d,e,f;d=getLabelColors(),e=d[b].fillStyle,a.each(m,function(d,g){c=a(g).attr("val"),c===b?(f="Walk"===c?"#ccc":e,a(this).css({background:f})):(f=o.originalBackgroundColor,c!==p.mode&&a(this).css({background:f}))})}return this}function i(b){if(svl.ui&&svl.ui.ribbonMenu){var c,d,e;d=getLabelColors(),e=d[b].fillStyle,a.each(m,function(d,f){c=a(f).attr("val"),c===b?a(this).css({"border-color":e,"border-style":"solid","border-width":o.borderWidth}):c!==p.mode&&a(this).css({"border-color":o.modeSwitchDefaultBorderColor,"border-style":"solid","border-width":o.borderWidth})})}return this}var j,k,l,m,n={className:"RibbonMenu"},o={borderWidth:"3px",modeSwitchDefaultBorderColor:"rgba(200,200,200,0.75)",originalBackgroundColor:"white"},p={disableModeSwitch:!1,lockDisableModeSwitch:!1,mode:"Walk",selectedLabelType:void 0};return n.backToWalk=function(){return d("Walk"),this},n.disableModeSwitch=function(){return p.lockDisableModeSwitch||(p.disableModeSwitch=!0,svl.ui&&svl.ui.ribbonMenu&&m.css("opacity",.5)),this},n.disableLandmarkLabels=function(){return svl.ui&&svl.ui.ribbonMenu&&a.each(m,function(b,c){var d=a(c).attr("val");"Walk"!==d&&"StopSign"!==d&&"Landmark_Shelter"!==d&&a(c).css("opacity",.5)}),p.disableLandmarkLabels=!0,this},n.enableModeSwitch=function(){return p.lockDisableModeSwitch||(p.disableModeSwitch=!1,svl.ui&&svl.ui.ribbonMenu&&m.css("opacity",1)),this},n.enableLandmarkLabels=function(){return svl.ui&&svl.ui.ribbonMenu&&a.each(m,function(b,c){a(c).attr("val");a(c).css("opacity",1)}),p.disableLandmarkLabels=!1,this},n.lockDisableModeSwitch=function(){return p.lockDisableModeSwitch=!0,this},n.modeSwitch=function(a){d(a)},n.modeSwitchClick=function(a){d(a)},n.getStatus=function(a){return a in p?p[a]:void console.warn(n.className,'You cannot access a property "'+a+'".')},n.setAllowedMode=function(a){return p.allowedMode=a,this},n.setStatus=function(a,b){try{if(a in p)return"disableModeSwitch"===a?"boolean"==typeof b?(b?n.disableModeSwitch():n.enableModeSwitch(),this):!1:(p[a]=b,this);var c='"'+a+'" is not a modifiable status.';throw c}catch(d){return console.error(n.className,d),!1}},n.unlockDisableModeSwitch=function(){return p.lockDisableModeSwitch=!1,this},c(b),n}function RightClickMenu(a){function b(a){B=a.canvas,C=a.ribbonMenu,D=$("div#labelDrawingLayer_LabelMenu"),E=$("#labelDrawingLayer_LabelMenuBar"),F=$("div#LabelDeleteMenu"),G=$("div#Holder_RightClickMenu"),H=$("input.Radio_BusStopType"),I=$("button#LabelDeleteMenu_DeleteButton"),J=$("button#LabelDeleteMenu_CancelButton"),K=$(".BusStopLabelMenuItem"),P=$("#Holder_BusStopLabelMenuOptionCloseIcon"),L=$("#BusStopPositionMenu"),M=$("#BusStopPositionMenu_MenuBar"),N=$(".BusStopPositionMenu_MenuItem"),O=$("#BusStopPositinoMenu_BackButton"),Q=$("#Holder_BusStopPositionMenuCloseIcon"),R=$(".RightClickMenuBar"),S=$(".Holder_BusStopLabelMenuQuestionMarkIcon"),T=$(".Holder_BusStopPositionMenuQuestionMarkIcon"),K.bind("mouseup",g),K.bind("mouseenter",h),K.bind("mouseleave",i),E.bind("mousedown",j),E.bind("mouseup",k),E.bind("mousemove",l),P.bind("click",m),P.bind("mouseenter",n),P.bind("mouseleave",o),N.bind("mouseup",p),N.bind("mouseenter",q),N.bind("mouseleave",r),M.bind("mousedown",v),M.bind("mouseup",w),M.bind("mousemove",x),Q.bind("click",u),Q.bind("mouseenter",s),Q.bind("mouseleave",t),S.bind({mouseenter:c,mouseleave:d,mouseup:e}),T.bind({mouseenter:c,mouseleave:d,mouseup:e}),R.bind("mouseenter",f),O.bind("click",A)}function c(a){$(this).find(".tooltip").css("visibility","visible")}function d(){$(this).find(".tooltip").css("visibility","hidden")}function e(a){a.stopPropagation();var b=$(this).parent().attr("value");myExamples.show(b)}function f(){$(this).css("cursor","url("+svl.rootDirectory+"/img/cursors/openhand.cur) 4 4, move")}function g(){if(!V.disableMenuSelect){var a,b,c,d;a=getLabelColors().StopSign.fillStyle,d=$(this),d.css("background","transparent"),setTimeout(function(){d.css("background",a),setTimeout(function(){d.css("background","transparent"),U.hideBusStopType(),c=d.attr("value"),c||(c="StopSign"),V.currentLabel.setSubLabelDescription(c),b=getLabelIconImagePath()[c].iconImagePath,V.currentLabel.setIconPath(b),B.clear().render(),z()},100)},100)}}function h(){if(!V.disableMenuSelect){var a=getLabelColors().StopSign.fillStyle;return $(this).css({background:a,cursor:"pointer"}),this}return!1}function i(){return V.disableMenuSelect?void 0:($(this).css({background:"transparent",cursor:"default"}),this)}function j(){W.mouseDownOnBusStopLabelMenuBar=!0,$(this).css("cursor","url("+svl.rootDirectory+"/img/cursors/closedhand.cur) 4 4, move")}function k(){W.mouseDownOnBusStopLabelMenuBar=!1,$(this).css("cursor","url("+svl.rootDirectory+"/img/cursors/openhand.cur) 4 4, move")}function l(a){if(W.mouseDownOnBusStopLabelMenuBar){var b,c,d=D.css("left"),e=D.css("top");e=parseInt(e.replace("px","")),d=parseInt(d.replace("px","")),b=a.pageX-W.prevX,c=a.pageY-W.prevY,d+=b,e+=c,D.css({left:d,top:e})}W.prevX=a.pageX,W.prevY=a.pageY}function m(){if(!V.disableMenuClose){var a;V.currentLabel&&(a=V.currentLabel.getProperties(),("DefaultValue"===a.labelProperties.busStopPosition||"DefaultValue"===a.labelProperties.subLabelDescription)&&(myCanvas.removeLabel(V.currentLabel),myActionStack.pop())),W.mouseDownOnBusStopLabelMenuBar=!1,U.hideBusStopType(),B.enableLabeling(),myMenu.setStatus("disableModeSwitch",!1)}}function n(){V.disableMenuClose||$(this).css("cursor","pointer")}function o(){$(this).css("cursor","default")}function p(){if(!V.disableMenuSelect){var a,b,c;b=getLabelColors().StopSign.fillStyle,V.currentLabel.setStatus("visibilityTag","visible"),c=$(this),c.css("background","transparent"),a=c.attr("value"),V.currentLabel.setBusStopPosition(a),setTimeout(function(){c.css("background",b),setTimeout(function(){c.css("background","transparent"),y(),myMap.enableWalking(),myMenu.backToWalk()},100)},100)}}function q(){if(!V.disableMenuSelect){var a=getLabelColors().StopSign.fillStyle;return $(this).css({background:a,cursor:"pointer"}),this}}function r(){return V.disableMenuSelect?void 0:($(this).css({background:"transparent",cursor:"default"}),this)}function s(){V.disableMenuClose||$(this).css({cursor:"pointer"})}function t(){$(this).css({cursor:"default"})}function u(){if(!V.disableMenuClose&&V.currentLabel){var a;a=V.currentLabel.getProperties(),("DefaultValue"===a.labelProperties.busStopPosition||"DefaultValue"===a.labelProperties.subLabelDescription)&&(myCanvas.removeLabel(V.currentLabel),myActionStack.pop()),W.mouseDownOnBusStopPositionMenuBar=!1,y(),B.enableLabeling(),myMenu.setStatus("disableModeSwitch",!1)}}function v(a){W.mouseDownOnBusStopPositionMenuBar=!0,$(this).css("cursor","url("+svl.rootDirectory+"/img/cursors/closedhand.cur) 4 4, move")}function w(a){W.mouseDownOnBusStopPositionMenuBar=!1,$(this).css("cursor","url("+svl.rootDirectory+"/img/cursors/openhand.cur) 4 4, move")}function x(a){if(W.mouseDownOnBusStopPositionMenuBar){var b,c,d=L.css("left"),e=L.css("top");e=parseInt(e.replace("px","")),d=parseInt(d.replace("px","")),b=a.pageX-W.prevX,c=a.pageY-W.prevY,d+=b,e+=c,L.css({left:d,top:e})}W.prevX=a.pageX,W.prevY=a.pageY}function y(){V.visibilityBusStopPositionMenu="hidden",G.css("visibility","hidden"),L.css("visibility","hidden"),U.isAllClosed()&&(B.setStatus("disableLabeling",!1),myMenu.setStatus("disableModeSwitch",!1),V.disableLabelDelete=!1,V.currentLabel=void 0,myActionStack.unlockDisableRedo().enableRedo().lockDisableRedo(),myActionStack.unlockDisableUndo().enableUndo().lockDisableUndo(),myForm.unlockDisableSubmit().enableSubmit().lockDisableSubmit(),myForm.unlockDisableNoBusStopButton().enableNoBusStopButton().lockDisableNoBusStopButton())}function z(){var a=V.menuPosition.x,b=V.menuPosition.y;V.visibilityBusStopPositionMenu="visible",M.css({background:getLabelColors().StopSign.fillStyle}),a>400&&(a-=300),b>300&&(b-=200),L.css({visibility:"visible",position:"absolute",left:a,top:b,"z-index":4}),B.setStatus("visibilityMenu","visible"),B.disableLabeling(),myMenu.setStatus("disableModeSwitch",!0),myActionStack.unlockDisableRedo().disableRedo().lockDisableRedo(),myActionStack.unlockDisableUndo().disableUndo().lockDisableUndo()}function A(){var a=V.currentLabel;y(),U.showBusStopType(a.getCoordinate().x,a.getCoordinate().y)}var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U={className:"RightClickMenu"},V={currentLabel:void 0,disableLabelDelete:!1,disableMenuClose:!1,disableMenuSelect:!1,lockDisableMenuSelect:!1,visibilityDeleteMenu:"hidden",visibilityBusStopLabelMenu:"hidden",visibilityBusStopPositionMenu:"hidden",menuPosition:{x:-1,y:-1}},W={currX:0,currY:0,prevX:0,prevY:0,leftDownX:0,leftDownY:0,leftUpX:0,leftUpY:0,mouseDownOnBusStopLabelMenuBar:!1,mouseDownOnBusStopPositionMenuBar:!1};return U.close=function(){m(),u()},U.disableMenuClose=function(){return V.disableMenuClose=!0,this},U.disableMenuSelect=function(){return V.lockDisableMenuSelect||(V.disableMenuSelect=!0),this},U.enableMenuClose=function(){return V.disableMenuClose=!1,this},U.enableMenuSelect=function(){return V.lockDisableMenuSelect||(V.disableMenuSelect=!1),this},U.getMenuPosition=function(){return{x:V.menuPosition.x,y:V.menuPosition.y}},U.hideBusStopPosition=function(){return y(),this},U.hideBusStopType=function(){G.css("visibility","hidden"),D.css("visibility","hidden"),V.visibilityBusStopLabelMenu="hidden",B.setStatus("visibilityMenu","hidden"),U.isAllClosed()&&(myActionStack.unlockDisableRedo().enableRedo().lockDisableRedo(),myActionStack.unlockDisableUndo().enableUndo().lockDisableUndo(),myForm.unlockDisableSubmit().disableSubmit().lockDisableSubmit(),myForm.unlockDisableNoBusStopButton().disableNoBusStopButton().lockDisableNoBusStopButton())},U.hideDeleteLabel=function(){G.css("visibility","hidden"),V.visibilityDeleteMenu="hidden",F.css("visibility","hidden"),B.setStatus("visibilityMenu","hidden"),U.isAllClosed()&&(B.enableLabeling(),myMenu.setStatus("disableModeSwitch",!1))},U.isAllClosed=function(){return"hidden"===V.visibilityBusStopLabelMenu&&"hidden"===V.visibilityDeleteMenu&&"hidden"===V.visibilityBusStopPositionMenu?!0:!1},U.isAnyOpen=function(){return!U.isAllClosed()},U.lockDisableMenuSelect=function(){return V.lockDisableMenuSelect=!0,this},U.setStatus=function(a,b){return a in V?"disableMenuClose"===a?"boolean"==typeof b?(b?U.enableMenuClose():U.disableMenuClose(),this):!1:(V[a]=b,this):!1},U.showBusStopType=function(a,b){if(V.currentLabel=B.getCurrentLabel(),V.currentLabel&&"StopSign"===V.currentLabel.getLabelType()){var c,d;G.css("visibility","visible"),V.visibilityBusStopLabelMenu="visible",E.css({background:getLabelColors().StopSign.fillStyle}),c=a+25,d=b+25,c>400&&(c-=300),d>300&&(d-=200),V.menuPosition.x=c,V.menuPosition.y=d,D.css({visibility:"visible",position:"absolute",left:c,top:d,"z-index":4}),V.visibilityBusStopLabelMenu="visible",B.setStatus("visibilityMenu","visible"),B.setStatus("disableLabeling",!0),B.disableLabeling(),myMap.setStatus("disableWalking",!0),myMenu.setStatus("disableModeSwitch",!0)}},U.showDeleteLabel=function(a,b){var c,d;V.disableLabelDelete||(G.css("visibility","visible"),c=a-5,d=b-5,F.css({visibility:"visible",position:"absolute",left:c,top:d,"z-index":4}),V.visibilityDeleteMenu="visible",V.visibilityMenu="visible",V.disableLabeling=!0,myMenu.setStatus("disableModeSwitch",!0))},U.unlockDisableMenuSelect=function(){return V.lockDisableMenuSelect=!1,this},b(a),U}function Tooltip(a,b){function c(b){d=a(b.domIds.tooltipHolder)}var d,e={className:"Tooltip"};return e.show=function(a){d.html(a),d.css("visibility","visible")},e.hide=function(){d.css("visibility","hidden")},c(b),e}function Tracker(){var a={className:"Tracker"},b=[],c=["TaskStart","TaskSubmit","TaskSubmitSkip","Click_ModeSwitch_Walk","Click_ModeSwitch_CurbRamp","Click_ModeSwitch_NoCurbRamp","Click_Undo","Click_Redo","Click_ZoomIn","Click_ZoomOut","Click_LabelDelete","Click_LabelEdit","Click_Path","Click_OpenSkipWindow","Click_CloseSkipWindow","Click_SkipRadio","LabelingCanvas_MouseUp","LabelingCanvas_MouseDown","LabelingCanvas_CancelLabeling","LabelingCanvas_StartLabeling","LabelingCanvas_FinishLabeling","ViewControl_MouseDown","ViewControl_MouseUp","ViewControl_DoubleClick","ViewControl_ZoomIn","ViewControl_ZoomOut","WalkTowards","KeyDown","KeyUp","RemoveLabel","Redo_AddLabel","Redo_RemoveLabel","Undo_AddLabel","Undo_RemoveLabel","MessageBox_ClickOk","GoldenInsertion_Submit","GoldenInsertion_ReviewLabels","GoldenInsertion_ReviseFalseNegative","GoldenInsertion_ReviseFalsePositive","Onboarding1_Start","Onboarding1_FirstCorner_IntroduceCurbRamps","Onboarding1_FirstCorner_LabelTheFirstCurbRamps","Onboarding1_FirstCorner_RedoLabelingTheFirstCurbRamps","Onboarding1_FirstCorner_SwitchTheModeToCurbRampForLabelTheSecondCurbRamps","Onboarding1_FirstCorner_LabelTheSecondCurbRamps","Onboarding1_FirstCorner_RedoLabelingTheSecondCurbRamps","Onboarding1_GrabAndDragToMoveToTheNextCorner","Onboarding1_KeepDragging","Onboarding1_SecondCorner_ModeSwitchToCurbRamps","Onboarding1_SecondCorner_LabelTheCurbRamps","Onboarding1_SecondCorner_RedoLabelingTheThirdCurbRamps","Onboarding1_SecondCorner_IntroductionToAMissingCurbRamp","Onboarding1_SecondCorner_LabelTheMissingCurbRamp","Onboarding1_SecondCorner_RedoLabelingTheMissingCurbRamps","Onboarding1_DoneLabelingAllTheCorners_EndLabeling","Onboarding1_Submit","Onboarding2_Start","Onboarding2_FirstCorner_IntroduceMissingCurbRamps","Onboarding2_FirstCorner_LabelTheMissingCurbRamps","Onboarding2_FirstCorner_RedoLabelingTheMissingCurbRamps","Onboarding2_FirstCorner_V2_LabelTheFirstMissingCurbRamps","Onboarding2_FirstCorner_V2_RedoLabelingTheFirstMissingCurbRamps","Onboarding2_FirstCorner_V2_ModeSwitchToMissingCurbRamp","Onboarding2_FirstCorner_V2_LabelTheSecondMissingCurbRamps","Onboarding2_FirstCorner_V2_RedoLabelingTheSecondMissingCurbRamps","Onboarding2_FirstCorner_MissingCurbRampExampleLabels","Onboarding2_GrabAndDragToTheSecondCorner","Onboarding2_KeepDraggingToTheSecondCorner","Onboarding2_SecondCorner_ModeSwitchToCurbRamp","Onboarding2_SecondCorner_LabelTheCurbRamp","Onboarding2_SecondCorner_RedoLabelingTheCurbRamps","Onboarding2_SecondCorner_ExamplesOfDiagonalCurbRamps","Onboarding2_RemindAboutTheCompletionRateMeter","Onboarding2_GrabAndDragToTheThirdCorner","Onboarding2_KeepDraggingToTheThirdCorner","Onboarding2_ThirdCorner_FirstZoomIn","Onboarding2_ThirdCorner_FirstModeSwitchToCurbRamp","Onboarding2_ThirdCorner_LabelTheFirstCurbRamp","Onboarding2_ThirdCorner_RedoLabelingTheFirstCurbRamps","Onboarding2_ThirdCorner_AdjustTheCameraAngle","Onboarding2_ThirdCorner_KeepAdjustingTheCameraAngle","Onboarding2_ThirdCorner_SecondZoomIn","Onboarding2_ThirdCorner_SecondModeSwitchToCurbRamp","Onboarding2_ThirdCorner_LabelTheSecondCurbRamps","Onboarding2_ThirdCorner_RedoLabelingTheSecondCurbRamps","Onboarding2_ThirdCorner_FirstZoomOut","Onboarding2_ThirdCorner_SecondZoomOut","Onboarding2_GrabAndDragToTheFourthCorner","Onboarding2_KeepDraggingToTheFourthCorner","Onboarding2_FourthCorner_IntroduceOcclusion","Onboarding2_DoneLabelingAllTheCorners_EndLabeling","Onboarding2_Submit","Onboarding3_Start","Onboarding3_ShowNorthSideOfTheIntersection","Onboarding3_GrabAndDrag","Onboarding3_KeepDragging","Onboarding3_SouthSideOfTheIntersection","Onboarding3_GrabAndDragToNorth","Onboarding3_ClickSkip","Onboarding3_SelectSkipOption","Onboarding3_ClickSkipOk","Onboarding3_finalMessage","Onboarding3_Submit","OnboardingQuickCheck_nextClick","OnboardingQuickCheck_clickQuickCheckImages","OnboardingQuickCheck_submitClick","OnboardingQuickCheck_submit"],d="undefined";
return a.getActions=function(){return b},a.getAvailableActionTypes=function(){var a=c.slice(0);return a},a.push=function(a,e){if(-1===c.indexOf(a))return console.warn("Unknown action: "+a),!1;var f,g,h,i,j;j=e?"x"in e&&"y"in e?"x:"+e.x+",y:"+e.y:"TargetPanoId"in e?e.TargetPanoId:"RadioValue"in e?e.RadioValue:"keyCode"in e?"keyCode:"+e.keyCode:"errorType"in e?"errorType:"+e.errorType:"quickCheckImageId"in e?e.quickCheckImageId:"quickCheckCorrectness"in e?e.quickCheckCorrectness:"labelId"in e?"labelId:"+e.labelId:d:d;try{f=svl.getPOV()}catch(k){f={heading:d,pitch:d,zoom:d}}try{g=getPosition()}catch(k){g={lat:d,lng:d}}g||(g={lat:d,lng:d});try{h=getPanoId()}catch(k){h=d}return i={actionType:a,heading:f.heading,lat:g.lat,lng:g.lng,panoId:h,pitch:f.pitch,timestamp:(new Date).getTime(),zoom:f.zoom,note:j},b.push(i),this},a}function UI(a,b){function c(b){d.actionStack={},d.actionStack.holder=a("#action-stack-control-holder"),d.actionStack.holder.append('<button id="undo-button" class="button action-stack-button" value="Undo"><img src="'+svl.rootDirectory+'img/icons/Icon_Undo.png" class="action-stack-icons" alt="Undo" /><br /><small>Undo</small></button>'),d.actionStack.holder.append('<button id="redo-button" class="button action-stack-button" value="Redo"><img src="'+svl.rootDirectory+'img/icons/Icon_Redo.png" class="action-stack-icons" alt="Redo" /><br /><small>Redo</small></button>'),d.actionStack.redo=a("#redo-button"),d.actionStack.undo=a("#undo-button"),$labelCountCurbRamp=a("#LabeledLandmarkCount_CurbRamp"),$labelCountNoCurbRamp=a("#LabeledLandmarkCount_NoCurbRamp"),$submittedLabelMessage=a("#LabeledLandmarks_SubmittedLabelCount"),d.labeledLandmark={},d.labeledLandmark.curbRamp=$labelCountCurbRamp,d.labeledLandmark.noCurbRamp=$labelCountNoCurbRamp,d.labeledLandmark.submitted=$submittedLabelMessage,d.map={},d.map.canvas=a("canvas#labelCanvas"),d.map.drawingLayer=a("div#labelDrawingLayer"),d.map.pano=a("div#pano"),d.map.streetViewHolder=a("div#streetViewHolder"),d.map.viewControlLayer=a("div#viewControlLayer"),d.map.modeSwitchWalk=a("span#modeSwitchWalk"),d.map.modeSwitchDraw=a("span#modeSwitchDraw"),d.googleMaps={},d.googleMaps.holder=a("#google-maps-holder"),d.googleMaps.holder.append('<div id="google-maps" class="google-maps-pane" style=""></div><div id="google-maps-overlay" class="google-maps-pane" style="z-index: 1"></div>'),d.missinDescription={},d.missinDescription.description=a("#CurrentStatus_Description"),d.overlayMessage={},d.overlayMessage.holder=a("#overlay-message-holder"),d.overlayMessage.holder.append("<span id='overlay-message-box'><span id='overlay-message'>Walk</span></span>"),d.overlayMessage.box=a("#overlay-message-box"),d.overlayMessage.message=a("#overlay-message"),d.progressPov={},d.progressPov.holder=a("#progress-pov-holder"),d.progressPov.holder.append("<div id='progress-pov-label' class='bold'>Observed area:</div>"),d.progressPov.holder.append("<div id='progress-pov-current-completion-bar'></div>"),d.progressPov.holder.append("<div id='progress-pov-current-completion-bar-filler'></div>"),d.progressPov.holder.append("<div id='progress-pov-current-completion-rate'>Hi</div>"),d.progressPov.rate=a("#progress-pov-current-completion-rate"),d.progressPov.bar=a("#progress-pov-current-completion-bar"),d.progressPov.filler=a("#progress-pov-current-completion-bar-filler"),$divStreetViewHolder=a("#Holder_StreetView"),$ribbonButtonBottomLines=a(".RibbonModeSwitchHorizontalLine"),$ribbonConnector=a("#StreetViewLabelRibbonConnection"),$spansModeSwitches=a("span.modeSwitch"),d.ribbonMenu={},d.ribbonMenu.streetViewHolder=$divStreetViewHolder,d.ribbonMenu.buttons=$spansModeSwitches,d.ribbonMenu.bottonBottomBorders=$ribbonButtonBottomLines,d.ribbonMenu.connector=$ribbonConnector,d.zoomControl={},d.zoomControl.holder=a("#zoom-control-holder"),d.zoomControl.holder.append('<button id="zoom-in-button" class="button zoom-control-button"><img src="'+svl.rootDirectory+'img/icons/ZoomIn.svg" class="zoom-button-icon" alt="Zoom in"><br />Zoom In</button>'),d.zoomControl.holder.append('<button id="zoom-out-button" class="button zoom-control-button"><img src="'+svl.rootDirectory+'img/icons/ZoomOut.svg" class="zoom-button-icon" alt="Zoom out"><br />Zoom Out</button>'),d.zoomControl.zoomIn=a("#zoom-in-button"),d.zoomControl.zoomOut=a("#zoom-out-button"),d.form={},d.form.holder=a("#form-holder"),d.form.commentField=a("#comment-field"),d.form.skipButton=a("#skip-button"),d.form.submitButton=a("#submit-button"),d.onboarding={},d.onboarding.holder=a("#onboarding-holder"),"onboarding"in b&&b.onboarding&&d.onboarding.holder.append("<div id='Holder_OnboardingCanvas'><canvas id='onboardingCanvas' width='720px' height='480px'></canvas><div id='Holder_OnboardingMessageBox'><div id='Holder_OnboardingMessage'></div></div></div>")}var d={moduleName:"MainUI"};return d.streetViewPane={},b=b||{},c(b),d}function Validator(a,b){function c(a){var c=b(this),d=c.attr("value");c.css("background","rgba(230, 230, 230, 1)"),I.radioCurrentLabelHoverState=d,l()}function d(a){var c=b(this);c.css("background","transparent"),I.radioCurrentLabelHoverState="ShowLabel",l()}function e(a){var c=b(this).attr("value");I.radioCurrentLabelCheckState=c,l()}function f(a,b){var c,d,e=b.length,f=[],g=1e7,h=-1;for(c=0;e>c;c+=1)g>b[c].x&&(g=b[c].x),h<b[c].x&&(h=b[c].x);var i=3328;for(c=0;e>c;c+=1)a.heading<180?h>svl.svImageWidth-i&&b[c].x>i&&(b[c].x-=svl.svImageWidth):i>g&&b[c].x<svl.svImageWidth-i&&(b[c].x+=svl.svImageWidth),d=svl.gsvImageCoordinate2CanvasCoordinate(b[c].x,b[c].y,a),f.push(d);return f}function g(a){var b,c=a.points.length,d=svl.getPOV(),e=void 0,g=[];for(b=0;c>b;b++)e={x:parseInt(a.points[b].svImageX),y:parseInt(a.points[b].svImageY)},g.push(e);var h,i=f(d,g),j=-1;for(b=0;c>b;b++)h=i[b],j<h.y&&(j=h.y);return j}function h(a){var b,c=a.points.length,d={heading:parseFloat(a.points[0].heading),pitch:parseFloat(a.points[0].pitch),zoom:parseFloat(a.points[0].zoom)},e=void 0,g=[];for(b=0;c>b;b++)e={x:parseInt(a.points[b].svImageX),y:parseInt(a.points[b].svImageY)},g.push(e);var h,i=f(d,g),j=1e6;for(b=0;c>b;b++)h=i[b],j>h.x&&(j=h.x);return j}function i(){var a,b,c=L.length,d=!0;for(a=0;c>a;a++)if(b=L[a],!b.validated){d=!1;break}return d?(I.allLabelsHaveBeenValidated=d,!1):b}function j(){var a,b=L.length,c=0;for(a=0;b>a;a++)L[a].validated&&(c+=1);return c}function k(){x.css("visibility","hidden")}function l(){if(!K)throw G.className+": highlightCurrentLabel(): currentLabel is not set.";var a,b,c,d,e,f,g,h;if(!svl.canvas)throw G.className+": highlightCurrentLabel(): canvas is not defined.";var i=void 0;for(d=svl.canvas.getLabels(),c=d.length,i="ShowLabel"===I.radioCurrentLabelHoverState?!0:!1,a=0;c>a;a++)if(e=d[a],f=e.getPath(!0),K.meta.labelId===d[a].getProperty("labelId")&&i)for(e.setVisibility("visible"),g=f.points,h=g.length,b=0;h>b;b++)g[b].resetFillStyle(),g[b].resetStrokeStyle();else for(e.setVisibility("hidden"),g=f.points,h=g.length,b=0;h>b;b++)g[b].setFillStyle("rgba(255,255,255,0)"),g[b].setStrokeStyle("rgba(255,255,255,0)");svl.canvas.clear(),svl.canvas.render2()}function m(a){H.previewMode=a.previewMode,v=b(a.domIds.holder),x=b("#ValidationDialogWindow"),w=b("#ValidationDialogWindowMenuBar"),y=b("#ValidationLabelValue"),z=b("#ValidationButtonAgree"),A=b("#ValidationButtonDisagree"),B=b(".SpanValidationCurrentLabeliVisibility"),C=b(".RadioValidationCurrentLabelVisibility"),D=b("#NumCompletedTasks"),E=b("#NumTotalTasks"),F=b("#ProgressBarFiller"),w.on({mousedown:r,mouseleave:s,mousemove:t,mouseup:u}),B.hover(c,d),C.on("mousedown",e),z.on("click",p),A.on("click",q),k(),o(),svl.ui.googleMaps.holder.css("visibility","hidden")}function n(a){if("number"!=typeof a&&(console.error(G.className,"A parameter of showDialogWindow() should be in milli-seconds (number)."),a=void 0),K){var b,c=g(K),d=h(K);b="CurbRamp"===K.meta.labelType?"We believe the green box (label) is correctly placed on a curb ramp in this image. Do you agree?":'We believe <span class="bold">there should be a curb ramp</span> under the highlighted area.',y.html(b),a?setTimeout(function(){c=g(K),d=h(K),x.css({left:d,top:c+20,visibility:"visible"})},a):x.css({left:d,top:c+20,visibility:"visible"})}}function o(){var a=L.length,b=0;b=j(),D.text(b),E.text(a);var c,d,e,f=b/a,g=parseInt(100*f,10)+"%";.5>f?(c=255,d=parseInt(255*f*2)):(c=parseInt(255*(1-f)*2),d=255),e="rgb(4,"+d+", 0)",F.css({background:e,width:g})}function p(){return K||(K=i()),K.validated=!0,K.validationLabel="Agree",G.validateNext(),o(),H.onboarding?!1:j()<L.length?!1:H.previewMode?(window.location.reload(),!1):!0}function q(){return K||(K=i()),K.validated=!0,K.validationLabel="Disagree",G.validateNext(),o(),H.onboarding?!1:j()<L.length?!1:H.previewMode?(window.location.reload(),!1):!0}function r(a){var b=mouseposition(a,"body");I.menuBarMouseDown=!0,J.menuBarPrevX=b.x,J.menuBarPrevY=b.y,J.menuBarMouseDownX=b.x,J.menuBarMouseDownY=b.y}function s(a){var b=mouseposition(a,"body");I.menuBarMouseDown=!1,J.menuBarMouseUpX=b.x,J.menuBarMouseUpY=b.y}function t(a){var b=mouseposition(a,"body");if(I.menuBarMouseDown&&b&&b.x&&b.y&&J.menuBarPrevX&&J.menuBarPrevX){var c=b.x-J.menuBarPrevX,d=b.y-J.menuBarPrevY,e=parseInt(x.css("left"),10),f=parseInt(x.css("top"),10);x.css({left:e+c,top:f+d})}J.menuBarPrevX=b.x,J.menuBarPrevY=b.y}function u(a){var b=mouseposition(a,"body");I.menuBarMouseDown=!1,J.menuBarMouseUpX=b.x,J.menuBarMouseUpY=b.y}var v,w,x,y,z,A,B,C,D,E,F,G={className:"Validator"},H={onboarding:!1},I={allLabelsHaveBeenValidated:!1,disableAgreeButton:!1,disableDisagreeButton:!1,disableRadioButtons:!1,menuBarMouseDown:!1,radioCurrentLabelCheckState:"ShowLabel",radioCurrentLabelHoverState:"ShowLabel"},J={menuBarMouseDownX:void 0,menuBarMouseDownY:void 0,menuBarMouseUpX:void 0,menuBarMouseUpY:void 0,menuBarPrevX:void 0,menuBarPrevY:void 0},K=void 0,L=[];return G.disableAgreeButton=function(){return I.disableAgreeButton=!0,z.css("opacity","0.5"),z.attr("disabled",!0),this},G.disableDisagreeButton=function(){return I.disableDisagreeButton=!0,A.css("opacity","0.5"),A.attr("disabled",!0),this},G.disableRadioButtons=function(){return I.disableRadioButtons=!0,C.each(function(a,c){b(c).attr("disabled",!0)}),this},G.enableAgreeButton=function(){return I.disableAgreeButton=!1,z.css("opacity","1"),z.attr("disabled",!1),this},G.enableDisagreeButton=function(){I.disableDisagreeButton=!1,A.css("opacity","1"),A.attr("disabled",!1)},G.enableRadioButtons=function(){I.disableRadioButtons=!1,C.each(function(a,c){b(c).attr("disabled",!1)})},G.getLabels=function(){return b.extend(!0,[],L)},G.hideDialogWindow=function(){return k(),this},G.insertLabels=function(a){var b=svl.misc.getLabelDescriptions(),c={};c.canvasWidth=svl.canvasWidth,c.canvasHeight=svl.canvasHeight,c.canvasDistortionAlphaX=svl.alpha_x,c.canvasDistortionAlphaY=svl.alpha_y,c.labelId=a[0].LabelId,c.labelType=a[0].LabelType,c.labelDescription=b[c.labelType].text,c.panoId=a[0].LabelGSVPanoramaId,c.panoramaLat=a[0].Lat,c.panoramaLng=a[0].Lng,c.panoramaHeading=a[0].heading,c.panoramaPitch=a[0].pitch,c.panoramaZoom=a[0].zoom,c.svImageWidth=svl.svImageWidth,c.svImageHeight=svl.svImageHeight,c.svMode="html4";var d={meta:c,points:a,validated:!1,validationLabel:void 0};L.push(d),o()},G.setDialogWindowBorderWidth=function(a){return x.css("border-width",a),this},G.setDialogWindowBorderColor=function(a){return x.css("border-color",a),this},G.showDialogWindow=function(a){return n(a),this},G.sortLabels=function(){function a(a,b){return parseInt(a.points[0].svImageX)<parseInt(b.points[0].svImageX)?-1:parseInt(a.points[0].svImageX)>parseInt(b.points[0].svImageX)?1:0}return L.sort(a),this},G.validateNext=function(a){if(!("map"in svl))throw G.className+": Map is not defined.";if(!("canvas"in svl))throw G.className+": Canvas is not defined.";if(K=i()){var b={heading:parseFloat(K.meta.panoramaHeading),pitch:parseFloat(K.meta.panoramaPitch),zoom:parseFloat(K.meta.zoom)};if(k(),"number"==typeof a&&a>=0){var c=500;svl.map.setPov(b,c),l(),n(c)}else svl.map.setPov(b,500),l(),n(500)}else{if(k(),H.onboarding)return!1;svl.validatorForm.submit()}return this},G.setOnboarding=function(a){H.onboarding=a},m(a),G}function ValidatorForm(a,b){function c(a){for(attr in f)f[attr]=a[attr]}function d(){if(!("validator"in svl&&svl.validator))throw e.className+": Validator not defined.";var a,c,d,h,i,j=f.panoId,k=f.dataStoreUrl,l={};if(a=f.hitId?f.hitId:"Test_Hit",c=f.assignmentId?f.assignmentId:"Test_Assignment",d=f.turkerId?f.turkerId:"Test_Kotaro",!f.onboarding){l.assignment={amazon_turker_id:d,amazon_hit_id:a,amazon_assignment_id:c,interface_type:"StreetViewValidator",interface_version:"1",completed:0,task_description:f.taskDescription},l.labelBinId=g,l.validationTask={task_panorama_id:f.taskPanoramaId,task_gsv_panorama_id:j,description:""},l.validationTaskEnvironment={browser:getBrowser(),browser_version:getBrowserVersion(),browser_width:b(window).width(),browser_height:b(window).height(),screen_width:screen.width,screen_height:screen.height,avail_width:screen.availWidth,avail_height:screen.availHeight,operating_system:getOperatingSystem()},svl.tracker.push("TaskSubmit"),l.userInteraction=svl.tracker.getActions(),l.labels=[];var m=svl.validator.getLabels();for(i=m.length,h=0;i>h;h++){console.log(m[h]);var n={};n.labelId=m[h].points[0].LabelId,n.result="Disagree"===m[h].validationLabel?0:1,l.labels.push(n)}try{b.ajax({async:!1,url:k,type:"post",data:l,dataType:"json",success:function(a){if(a.error)throw a.error.message},error:function(a){throw a}})}catch(o){console.log(o)}if(!(f.taskRemaining>1))return f.isAMTTask?(b('input[name="assignmentId"]').attr("value",c),b('input[name="workerId"]').attr("value",d),b('input[name="hitId"]').attr("value",a),!0):(window.location.reload(),!1);window.location.reload()}return!1}var e={className:"ValidatorForm"},f={dataStoreUrl:void 0,onboarding:void 0,taskDescription:void 0,taskPanoramaId:void 0,assignmentId:void 0,hitId:void 0,turkerId:void 0},g=void 0;return e.setLabelBinId=function(a){return g=a,this},e.submit=function(){return d()},c(a),e}function ZoomControl(a,b){function c(a){svl.ui&&svl.ui.zoomControl&&(h=svl.ui.zoomControl.zoomIn,i=svl.ui.zoomControl.zoomOut,h.bind("click",d),i.bind("click",e))}function d(){if("tracker"in svl&&svl.tracker.push("Click_ZoomIn"),!l.disableZoomIn){var a=svl.panorama.getPov();g(a.zoom+1),svl.canvas.clear().render2()}}function e(){if("traker"in svl&&svl.tracker.push("Click_ZoomOut"),!l.disableZoomOut){var a=svl.panorama.getPov();g(a.zoom-1),svl.canvas.clear().render2()}}function f(a,b){if(!l.disableZoomIn){if("canvas"in svl&&svl.canvas.cancelDrawing(),"panorama"in svl){var c=svl.panorama.getPov(),d=c.zoom;if(d>=k.maxZoomLevel)return!1;var e=svl.canvasWidth,f=svl.canvasHeight,g=svl.map.getProperty("minPitch"),h=svl.map.getProperty("maxPitch"),i=d,j=(a-e/2)/e*(90/i),m=-(b-f/2)/f*(70/i),n={};n.zoom=d+1,n.heading=c.heading+j,n.pitch=c.pitch+m;var h=svl.map.getMaxPitch(),g=svl.map.getMinPitch();return n.pitch>h?n.pitch=h:n.pitch<g&&(n.pitch=g),svl.panorama.setPov(n),d}return!1}}function g(a){if("number"!=typeof a)return!1;"canvas"in svl&&svl.canvas.cancelDrawing();var b=void 0;return a=parseInt(a),b=1>a?1:a>k.maxZoomLevel?k.maxZoomLevel:a,svl.panorama.setZoom(b),b}var h,i,j={className:"ZoomControl"},k={maxZoomLevel:3,minZoomLevel:1},l={disableZoomIn:!1,disableZoomOut:!1},m={disableZoomIn:!1,disableZoomOut:!1};return j.disableZoomIn=function(){return m.disableZoomIn||(l.disableZoomIn=!0,h&&h.css("opacity",.5)),this},j.disableZoomOut=function(){return m.disableZoomOut||(l.disableZoomOut=!0,i&&i.css("opacity",.5)),this},j.enableZoomIn=function(){return m.disableZoomIn||(l.disableZoomIn=!1,h&&h.css("opacity",1)),this},j.enableZoomOut=function(){return m.disableZoomOut||(l.disableZoomOut=!1,i&&i.css("opacity",1)),this},j.getLock=function(a){if(a in m)return m[a];var b='You cannot access a property "'+a+'".';throw b},j.getStatus=function(a){if(a in l)return l[a];var b='You cannot access a property "'+a+'".';throw b},j.getProperties=function(a){if(a in k)return k[a];var b='You cannot access a property "'+a+'".';throw b},j.lockDisableZoomIn=function(){return m.disableZoomIn=!0,this},j.lockDisableZoomOut=function(){return m.disableZoomOut=!0,this},j.updateOpacity=function(){var a=svl.getPOV();if(a){var b=a.zoom;b>=k.maxZoomLevel?(h.css("opacity",.5),i.css("opacity",1)):b<=k.minZoomLevel?(h.css("opacity",1),i.css("opacity",.5)):(h.css("opacity",1),i.css("opacity",1))}return l.disableZoomIn&&h.css("opacity",.5),l.disableZoomOut&&i.css("opacity",.5),this},j.pointZoomIn=function(a,b){return l.disableZoomIn?!1:f(a,b)},j.setMaxZoomLevel=function(a){return k.maxZoomLevel=a,this},j.setMinZoomLevel=function(a){return k.minZoomLevel=a,this},j.unlockDisableZoomIn=function(){return m.disableZoomIn=!1,this},j.unlockDisableZoomOut=function(){return m.disableZoomOut=!1,this},j.zoomIn=function(){if(l.disableZoomIn)return!1;var a=svl.panorama.getPov();return g(a.zoom+1),svl.canvas.clear().render2(),this},j.zoomOut=function(){if(l.disableZoomOut)return!1;var a=svl.panorama.getPov();return g(a.zoom-1),svl.canvas.clear().render2(),this},c(b),j}function mouseposition(a,b){var c,d;return c=a.pageX-$(b).offset().left,d=a.pageY-$(b).offset().top,{x:parseInt(c,10),y:parseInt(d,10)}}function focusCallback(){$(this).val()===$(this).attr("title")&&$(this).val(""),$(this).removeClass("defaultTextActive")}function blurCallback(){if(!$(this).val()){var a=$(this).attr("title");$(this).val(a),$(this).addClass("defaultTextActive")}}function getURLParameter(a){for(var b=location.search.slice(1).split("&"),c="",d=0;d<b.length;d++)if(b[d].slice(0,b[d].indexOf("="))==a){c=b[d].slice(b[d].indexOf("=")+1);break}return c=c.length>0?unescape(c).split(","):"",c=1==c.length?c[0]:""}function getBrowser(){var a;for(a in $.browser)if($.browser[a]===!0)return a;return void 0}function getBrowserVersion(){return $.browser.version}function getOperatingSystem(){var a="Unknown OS";return-1!=navigator.appVersion.indexOf("Win")&&(a="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(a="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(a="UNIX"),-1!=navigator.appVersion.indexOf("Linux")&&(a="Linux"),a}function scaleImageCoordinate(a,b,c){var d=a*c,e=(3328-b)*c;return{x:d,y:e}}function sleep(a){}function shuffle(a){for(var b,c=[],d=a.length;d;)b=Math.floor(Math.random()*a.length),b in a&&(c.push(a[b]),delete a[b],d--);return c}function getBusStopPositionLabel(){return{NextToCurb:{id:"NextToCurb",label:"Next to curb"},AwayFromCurb:{id:"AwayFromCurb",label:"Away from curb"},None:{id:"None",label:"Not provided"}}}function getHeadingEstimate(a,b,c,d){"number"!=typeof a&&(a=parseFloat(a)),"number"!=typeof b&&(b=parseFloat(b)),"number"!=typeof d&&(d=parseFloat(d)),"number"!=typeof c&&(c=parseFloat(c));var e=d-b,f=c-a;if(0===f||0===e)return 0;var g=toDegrees(Math.atan(e/f));return 90-g}function getLabelCursorImagePath(){return{Walk:{id:"Walk",cursorImagePath:void 0},StopSign:{id:"StopSign",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_OneLeg:{id:"StopSign_OneLeg",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_Column:{id:"StopSign_Column",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_None:{id:"StopSign_None",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},Landmark_Shelter:{id:"Landmark_Shelter",cursorImagePath:"public/img/cursors/Cursor_BusStopShelter2.png"},Landmark_Bench:{id:"Landmark_Bench",cursorImagePath:"public/img/cursors/Cursor_Bench2.png"},Landmark_TrashCan:{id:"Landmark_TrashCan",cursorImagePath:"public/img/cursors/Cursor_TrashCan3.png"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",cursorImagePath:"public/img/cursors/Cursor_Mailbox2.png"},Landmark_OtherPole:{id:"Landmark_OtherPole",cursorImagePath:"public/img/cursors/Cursor_OtherPole.png"}}}function getLabelIconImagePath(a){return{Walk:{id:"Walk",iconImagePath:void 0},StopSign:{id:"StopSign",iconImagePath:"public/img/icons/Icon_BusStop.png"},StopSign_OneLeg:{id:"StopSign_OneLeg",iconImagePath:"public/img/icons/Icon_BusStopSign_SingleLeg.png"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",iconImagePath:"public/img/icons/Icon_BusStopSign_TwoLegged.png"},StopSign_Column:{id:"StopSign_Column",iconImagePath:"public/img/icons/Icon_BusStopSign_Column.png"},StopSign_None:{id:"StopSign_None",iconImagePath:"public/img/icons/Icon_BusStop.png"},Landmark_Shelter:{id:"Landmark_Shelter",iconImagePath:"public/img/icons/Icon_BusStopShelter.png"},Landmark_Bench:{id:"Landmark_Bench",iconImagePath:"public/img/icons/Icon_Bench.png"},Landmark_TrashCan:{id:"Landmark_TrashCan",iconImagePath:"public/img/icons/Icon_TrashCan2.png"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",iconImagePath:"public/img/icons/Icon_Mailbox2.png"},Landmark_OtherPole:{id:"Landmark_OtherPole",iconImagePath:"public/img/icons/Icon_OtherPoles.png"}}}function getLabelInstructions(){return{Walk:{id:"Walk",instructionalText:"Explore mode: Find the closest bus stop and label surrounding landmarks",textColor:"rgba(255,255,255,1)"},StopSign:{id:"StopSign",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_OneLeg:{id:"StopSign_OneLeg",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_Column:{id:"StopSign_Column",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},Landmark_Shelter:{id:"Landmark_Shelter",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus shelter</span>',textColor:"rgba(255,255,255,1)"},Landmark_Bench:{id:"Landmark_Bench",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bench</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_TrashCan:{id:"Landmark_TrashCan",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">trash can</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">mailbox or news paper box</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_OtherPole:{id:"Landmark_OtherPole",instructionalText:'Label mode: Locate and click at the bottom of poles such as <span class="underline bold">traffic sign, traffic light, and light pole</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"}}}function getRibbonConnectionPositions(){return{Walk:{id:"Walk",text:"Walk",labelRibbonConnection:"25px"},StopSign:{id:"StopSign",text:"Stop Sign",labelRibbonConnection:"112px"},StopSign_OneLeg:{id:"StopSign_OneLeg",text:"One-leg Stop Sign",labelRibbonConnection:"112px"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",text:"Two-leg Stop Sign",labelRibbonConnection:"112px"},StopSign_Column:{id:"StopSign_Column",text:"Column Stop Sign",labelRibbonConnection:"112px"},Landmark_Shelter:{id:"Landmark_Shelter",text:"Bus Shelter",labelRibbonConnection:"188px"},Landmark_Bench:{id:"Landmark_Bench",text:"Bench",labelRibbonConnection:"265px"},Landmark_TrashCan:{id:"Landmark_TrashCan",text:"Trash Can",labelRibbonConnection:"338px"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",labelRibbonConnection:"411px"},Landmark_OtherPole:{id:"Landmark_OtherPole",labelRibbonConnection:"484px"}}}function getLabelDescriptions(){return{Walk:{id:"Walk",text:"Walk"},StopSign:{id:"StopSign",text:"Bus Stop Sign"},StopSign_OneLeg:{id:"StopSign_OneLeg",text:"One-leg Stop Sign"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",text:"Two-leg Stop Sign"},StopSign_Column:{id:"StopSign_Column",text:"Column Stop Sign"},StopSign_None:{id:"StopSign_None",text:"Not provided"},Landmark_Shelter:{id:"Landmark_Shelter",text:"Bus Stop Shelter"},Landmark_Bench:{id:"Landmark_Bench",text:"Bench"},Landmark_TrashCan:{id:"Landmark_TrashCan",text:"Trash Can / Recycle Can"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",text:"Mailbox / News Paper Box"},Landmark_OtherPole:{id:"Landmark_OtherPole",text:"Traffic Sign / Pole"}}}function getLabelColors(){return colorScheme2()}function colorScheme1(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_None:{id:"StopSign_None",fillStyle:"rgba(102, 194, 165, 0.9"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(252, 141, 98, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(141, 160, 203, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(231, 138, 195, 0.9)"}}}function colorScheme2(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(0, 161, 203, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(215, 0, 96, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(252, 217, 32, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(97, 174, 36, 0.9)"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",fillStyle:"rgba(67, 113, 190, 0.9)"},Landmark_OtherPole:{id:"Landmark_OtherPole",fillStyle:"rgba(249, 79, 101, 0.9)"}}}function colorScheme3(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(97, 210, 214, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(97, 210, 214, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(97, 210, 214, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(97, 210, 214, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(237, 20, 111, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(237, 222, 69, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(155, 240, 233, 0.9)"}}}function colorScheme4(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(252, 217, 32, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(252, 217, 32, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(252, 217, 32, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(252, 217, 32, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(229, 59, 81, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(60, 181, 181, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(236, 108, 32, 0.9)"}}}function colorScheme5(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(208, 221, 43, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(208, 221, 43, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(208, 221, 43, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(208, 221, 43, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(152, 199, 61, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(0, 169, 224, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(103, 205, 220, 0.9)"}}}function colorScheme6(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(210, 54, 125, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(210, 54, 125, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(210, 54, 125, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(210, 54, 125, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(188, 160, 0, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(207, 49, 4, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(1, 142, 74, 0.9)"}}}function changeAlphaRGBA(a,b){var c=a.replace("rgba(","").replace(")","").split(",");if(4!==c.length||isNaN(parseInt(b)))return a;var d;return d="rgba("+c[0].trim()+","+c[1].trim()+","+c[2].trim()+","+b+")"}function changeDarknessRGBA(a,b){var c=a.replace("rgba(","").replace(")","").split(",");if(4===c.length){var d,e,f,g,h,i,j,k,l,m;return d=parseInt(c[0].trim()),e=parseInt(c[1].trim()),f=parseInt(c[2].trim()),g=c[3].trim(),h=rgbToHsv(d,e,f),i=hsvToRgb(h[0],h[1],b),j=parseInt(i[0]),k=parseInt(i[1]),l=parseInt(i[2]),m="rgba("+j+","+k+","+l+","+g+")"}return a}function rgbToHsl(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return[d,e,h]}function hslToRgb(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(0==b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return[255*e,255*f,255*g]}function rgbToHsv(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return[d,e,h]}function hsvToRgb(a,b,c){var d,e,f,g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b);switch(g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return[255*d,255*e,255*f]}function toDegrees(a){return a*(180/Math.PI)}function toRadians(a){return a*(Math.PI/180)}function latlngOffset(a,b,c){var d=c/111111,e=b/(111111*Math.cos(toRadians(a)));return{dlat:d,dlng:e}}function latlngInverseOffset(a,b,c){var d=111111*b,e=111111*Math.cos(toRadians(a))*c;return{dx:e,dy:d}}function latLngToAngle(a,b,c,d,e){var f,g,h;return f=c-a,g=d-b,h=Math.atan2(g,f),e&&(h=Math.PI/2-h),h}function haversine(a,b,c,d){a=toRadians(a),b=toRadians(b),c=toRadians(c),d=toRadians(d);var e=6372800,f=c-a,g=d-b,h=Math.sin(f/2)*Math.sin(f/2)+Math.sin(g/2)*Math.sin(g/2)*Math.cos(a)*Math.cos(c),i=2*Math.asin(Math.sqrt(h));return e*i}function distance3d(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e}function Stats(a){var b=this,c=a||[];return b.getArithmeticMean=function(){for(var a=0,b=c.length,d=0;b>d;d++)a+=c[d];return a/b},b.getGeometricMean=function(){for(var a=1,b=c.length,d=0;b>d;d++)a*=c[d];return Math.pow(a,1/b)},b.getHarmonicMean=function(){for(var a=0,b=c.length,d=0;b>d;d++)a+=1/c[d];return b/a},b.getStandardDeviation=function(){for(var a=this.getArithmeticMean(),b=0,d=c.length,e=0;d>e;e++)b+=Math.pow(c[e]-a,2);return Math.pow(b/d,.5)},b.getStandardError=function(){var a=this.getStandardDeviation(),b=c.length,d=a/Math.sqrt(b);return d},b.getMedian=function(){var a=c.length,b=Math.floor(a/2),d=c.sort(function(a,b){return a-b});return d[b]},b.getMin=function(){return Math.min.apply(Math,c)},b.getMax=function(){return Math.max.apply(Math,c)},b.setArray=function(a){return c=a,b},b.getArray=function(){return c},b}function lineWithRoundHead(a,b,c,d,e,f,g,h,i,j,k,l,m){var n="none",o="none",p=i?i:"rgba(255,255,255,1)",q="rgba(255,255,255,1)",r="rgba(255,255,255,1)",s="rgba(255,255,255,1)";if(h){if("none"!==h&&"stroke"!==h&&"fill"!==h&&"both"!==h)throw"lineWithRoundHead(): "+h+" is not a valid input.";n=h}if(k){if("none"!==k&&"stroke"!==k&&"fill"!==k&&"both"!==k)throw"lineWithRoundHead(): "+k+" is not a valid input.";
o=k}i&&(p=i),j&&(q=j),l&&(r=l),m&&(s=m);var t=Math.atan2(f-c,e-b),u=b+d*Math.cos(t),v=c+d*Math.sin(t),w=e-g*Math.cos(t),x=f-g*Math.sin(t);a.save(),a.lineWidth=2,a.beginPath(),a.moveTo(u,v),a.lineTo(w,x),a.stroke(),a.closePath(),a.restore(),"none"!==n&&(a.save(),a.fillStyle=q,a.strokeStyle=p,a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),"stroke"===n?a.stroke():"fill"===n?a.fill():"both"===n&&(a.fill(),a.stroke()),a.closePath(),a.restore()),"none"!==o&&(a.save(),a.fillStyle=s,a.strokeStyle=r,a.beginPath(),a.arc(e,f,g,0,2*Math.PI,!0),"stroke"===o?a.stroke():"fill"===o?a.fill():"both"===o&&(a.fill(),a.stroke()),a.closePath(),a.restore())}function imageCoordinateToCanvasCoordinate(a,b,c,d){d||(d=1);var e=(a-svl.svImageWidth*c.heading/360)*d/svl.alpha_x+svl.canvasWidth/2,f=(b-svl.svImageHeight*c.pitch/180)*d/svl.alpha_y+svl.canvasHeight/2;return{x:e,y:f}}function getHeadingEstimate(a,b,c,d){"number"!=typeof a&&(a=parseFloat(a)),"number"!=typeof b&&(b=parseFloat(b)),"number"!=typeof d&&(d=parseFloat(d)),"number"!=typeof c&&(c=parseFloat(c));var e=d-b,f=c-a;if(0===f||0===e)return 0;var g=toDegrees(Math.atan(e/f));return 90-g}function getLabelCursorImagePath(){return{Walk:{id:"Walk",cursorImagePath:void 0},CurbRamp:{id:"CurbRamp",cursorImagePath:svl.rootDirectory+"img/cursors/pen.png"},NoCurbRamp:{id:"NoCurbRamp",cursorImagePath:svl.rootDirectory+"img/cursors/pen.png"},Obstacle:{id:"Obstacle",cursorImagePath:svl.rootDirectory+"img/cursors/pen.png"},SurfaceProblem:{id:"SurfaceProblem",cursorImagePath:svl.rootDirectory+"img/cursors/pen.png"},Other:{id:"Other",cursorImagePath:svl.rootDirectory+"img/cursors/pen.png"}}}function getLabelIconImagePath(a){return{Walk:{id:"Walk",iconImagePath:void 0},CurbRamp:{id:"CurbRamp",iconImagePath:svl.rootDirectory+"img/Icon_CurbRamp.svg"},NoCurbRamp:{id:"NoCurbRamp",iconImagePath:svl.rootDirectory+"/img/icons/Sidewalk/Icon_NoCurbRamp-14.svg"},Obstacle:{id:"Obstacle",iconImagePath:null},SurfaceProblem:{id:"SurfaceProblem",iconImagePath:null},Other:{id:"Other",iconImagePath:null},Void:{id:"Void",iconImagePath:null},Unclear:{id:"Unclear",iconImagePath:null},StopSign:{id:"StopSign",iconImagePath:svl.rootDirectory+"/img/icons/Icon_BusStop.png"},StopSign_OneLeg:{id:"StopSign_OneLeg",iconImagePath:svl.rootDirectory+"/img/icons/Icon_BusStopSign_SingleLeg.png"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",iconImagePath:svl.rootDirectory+"/img/icons/Icon_BusStopSign_TwoLegged.png"},StopSign_Column:{id:"StopSign_Column",iconImagePath:svl.rootDirectory+"/img/icons/Icon_BusStopSign_Column.png"},StopSign_None:{id:"StopSign_None",iconImagePath:svl.rootDirectory+"/img/icons/Icon_BusStop.png"},Landmark_Shelter:{id:"Landmark_Shelter",iconImagePath:svl.rootDirectory+"/img/icons/Icon_BusStopShelter.png"},Landmark_Bench:{id:"Landmark_Bench",iconImagePath:svl.rootDirectory+"/img/icons/Icon_Bench.png"},Landmark_TrashCan:{id:"Landmark_TrashCan",iconImagePath:svl.rootDirectory+"/img/icons/Icon_TrashCan2.png"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",iconImagePath:svl.rootDirectory+"/img/icons/Icon_Mailbox2.png"},Landmark_OtherPole:{id:"Landmark_OtherPole",iconImagePath:svl.rootDirectory+"/img/icons/Icon_OtherPoles.png"}}}function getLabelInstructions(){return{Walk:{id:"Walk",instructionalText:"Explore mode: Find and label curb ramps at this intersection.",textColor:"rgba(255,255,255,1)"},CurbRamp:{id:"CurbRamp",instructionalText:'Label mode: Locate and draw an outline around the <span class="underline">curb ramp</span>',textColor:"rgba(255,255,255,1)"},NoCurbRamp:{id:"NoCurbRamp",instructionalText:'Label mode: Locate and draw an outline around where a <span class="underline">curb ramp is missing</span>',textColor:"rgba(255,255,255,1)"},Obstacle:{id:"Obstacle",instructionalText:'Label mode: Locate and draw an outline around a <span class="underline">obstacle in path</span>',textColor:"rgba(255,255,255,1)"},Other:{id:"Other",instructionalText:"Label mode",textColor:"rgba(255,255,255,1)"},SurfaceProblem:{id:"SurfaceProblem",instructionalText:'Label mode: Locate and draw an outline around a <span class="underline">sidewalk surface problem</span>',textColor:"rgba(255,255,255,1)"},StopSign:{id:"StopSign",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_OneLeg:{id:"StopSign_OneLeg",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_Column:{id:"StopSign_Column",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},Landmark_Shelter:{id:"Landmark_Shelter",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus shelter</span>',textColor:"rgba(255,255,255,1)"},Landmark_Bench:{id:"Landmark_Bench",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bench</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_TrashCan:{id:"Landmark_TrashCan",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">trash can</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">mailbox or news paper box</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_OtherPole:{id:"Landmark_OtherPole",instructionalText:'Label mode: Locate and click at the bottom of poles such as <span class="underline bold">traffic sign, traffic light, and light pole</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"}}}function getRibbonConnectionPositions(){return{Walk:{id:"Walk",text:"Walk",labelRibbonConnection:"25px"},CurbRamp:{id:"CurbRamp",labelRibbonConnection:"112px"},NoCurbRamp:{id:"NoCurbRamp",labelRibbonConnection:"188px"},Obstacle:{id:"Obstacle",labelRibbonConnection:"264px"},SurfaceProblem:{id:"SurfaceProblem",labelRibbonConnection:"340px"},Other:{id:"Other",labelRibbonConnection:"416px"},StopSign:{id:"StopSign",text:"Stop Sign",labelRibbonConnection:"112px"},StopSign_OneLeg:{id:"StopSign_OneLeg",text:"One-leg Stop Sign",labelRibbonConnection:"112px"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",text:"Two-leg Stop Sign",labelRibbonConnection:"112px"},StopSign_Column:{id:"StopSign_Column",text:"Column Stop Sign",labelRibbonConnection:"112px"},Landmark_Shelter:{id:"Landmark_Shelter",text:"Bus Shelter",labelRibbonConnection:"188px"},Landmark_Bench:{id:"Landmark_Bench",text:"Bench",labelRibbonConnection:"265px"},Landmark_TrashCan:{id:"Landmark_TrashCan",text:"Trash Can",labelRibbonConnection:"338px"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",labelRibbonConnection:"411px"},Landmark_OtherPole:{id:"Landmark_OtherPole",labelRibbonConnection:"484px"}}}function getLabelDescriptions(){return{Walk:{id:"Walk",text:"Walk"},CurbRamp:{id:"CurbRamp",text:"Curb Ramp"},NoCurbRamp:{id:"NoCurbRamp",text:"Missing Curb Ramp"},Obstacle:{id:"Obstacle",text:"Obstacle in a Path"},Other:{id:"Other",text:"Other"},SurfaceProblem:{id:"SurfaceProblem",text:"Surface Problem"},Void:{id:"Void",text:"Void"},Unclear:{id:"Unclear",text:"Unclear"},StopSign:{id:"StopSign",text:"Bus Stop Sign"},StopSign_OneLeg:{id:"StopSign_OneLeg",text:"One-leg Stop Sign"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",text:"Two-leg Stop Sign"},StopSign_Column:{id:"StopSign_Column",text:"Column Stop Sign"},StopSign_None:{id:"StopSign_None",text:"Not provided"},Landmark_Shelter:{id:"Landmark_Shelter",text:"Bus Stop Shelter"},Landmark_Bench:{id:"Landmark_Bench",text:"Bench"},Landmark_TrashCan:{id:"Landmark_TrashCan",text:"Trash Can / Recycle Can"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",text:"Mailbox / News Paper Box"},Landmark_OtherPole:{id:"Landmark_OtherPole",text:"Traffic Sign / Pole"}}}function getLabelColors(){return SidewalkColorScheme()}function SidewalkColorScheme(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},CurbRamp:{id:"CurbRamp",fillStyle:"rgba(0, 244, 38, 0.9)"},NoCurbRamp:{id:"NoCurbRamp",fillStyle:"rgba(255, 39, 113, 0.9)"},Obstacle:{id:"Obstacle",fillStyle:"rgba(0, 161, 203, 0.9)"},Other:{id:"Other",fillStyle:"rgba(204, 204, 204, 0.9)"},SurfaceProblem:{id:"SurfaceProblem",fillStyle:"rgba(215, 0, 96, 0.9)"},Void:{id:"Void",fillStyle:"rgba(255, 255, 255, 0)"},Unclear:{id:"Unclear",fillStyle:"rgba(128, 128, 128, 0.5)"}}}function colorScheme2(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},CurbRamp:{id:"CurbRamp",fillStyle:"rgba(106, 230, 36, 0.9)"},NoCurbRamp:{id:"NoCurbRamp",fillStyle:"rgba(215, 0, 96, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(0, 161, 203, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(215, 0, 96, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(252, 217, 32, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(97, 174, 36, 0.9)"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",fillStyle:"rgba(67, 113, 190, 0.9)"},Landmark_OtherPole:{id:"Landmark_OtherPole",fillStyle:"rgba(249, 79, 101, 0.9)"}}}var svl=svl||{},GSVPANO=GSVPANO||{};GSVPANO.PanoLoader=function(a){"use strict";var b,c,d=a||{},e=new google.maps.StreetViewService,f=0,g=0,h=document.createElement("canvas"),i=h.getContext("2d"),j=0,k="";"panoId"in a&&(c=a.panoId),this.setProgress=function(a){this.onProgress&&this.onProgress(a)},this.throwError=function(a){this.onError?this.onError(a):console.error(a)},this.adaptTextureToZoom=function(){var a=416*Math.pow(2,b),c=416*Math.pow(2,b-1);h.width=a,h.height=c},this.composeFromTile=function(a,b,c){i.drawImage(c,512*a,512*b),f++;var d=Math.round(100*f/g);this.setProgress(d),f===g&&(this.canvas=h,this.onPanoramaLoad&&this.onPanoramaLoad())},this.composePanorama=function(){this.setProgress(0),console.log("Loading panorama for zoom "+b+"...");var a,d,e,h=Math.pow(2,b),i=Math.pow(2,b-1),j=this;for(f=0,g=h*i,e=0;i>e;e++)for(d=0;h>d;d++)a="http://maps.google.com/cbk?output=tile&panoid="+c+"&zoom="+b+"&x="+d+"&y="+e+"&"+Date.now(),function(b,c){var d=new Image;d.addEventListener("load",function(){j.composeFromTile(b,c,this)}),d.crossOrigin="",d.src=a}(d,e)},this.load=function(a){console.log("Load for",a);var b=this;e.getPanoramaByLocation(a,50,function(d,e){if(e===google.maps.StreetViewStatus.OK){b.onPanoramaData&&b.onPanoramaData(d);var f=google.maps.geometry.spherical.computeHeading(a,d.location.latLng);j=(d.tiles.centerHeading-f)*Math.PI/180,k=d.copyright,b.copyright=d.copyright,c=d.location.pano,b.panoId=c,b.location=a,b.composePanorama()}else b.onNoPanoramaData&&b.onNoPanoramaData(e),b.throwError("Could not retrieve panorama for the following reason: "+e)})},this.loadById=function(a){var b=this;e.getPanoramaById(a,function(a,d){if(d===google.maps.StreetViewStatus.OK){b.onPanoramaData&&b.onPanoramaData(a);var e=google.maps.geometry.spherical.computeHeading(location,a.location.latLng);j=(a.tiles.centerHeading-e)*Math.PI/180,k=a.copyright,b.copyright=a.copyright,c=a.location.pano,b.panoId=c,b.location=location,b.composePanorama()}else b.onNoPanoramaData&&b.onNoPanoramaData(d),b.throwError("Could not retrieve panorama for the following reason: "+d)})},this.setZoom=function(a){b=a,this.adaptTextureToZoom()},this.setZoom(d.zoom||1)};var GSVPANO=GSVPANO||{};GSVPANO.PanoPointCloudLoader=function(a){"use strict";this.load=function(a){var b,c=this;b="http://maps.google.com/cbk?output=json&cb_client=maps_sv&v=4&dm=1&pm=1&ph=1&hl=en&panoid="+a,$.ajax({url:b,dataType:"jsonp"}).done(function(b,d,e){var f,g;try{f=c.decode(b.model.depth_map),g=c.parse(f)}catch(h){console.error("Error loading depth map for pano "+a+"\n"+h.message+"\nAt "+h.filename+"("+h.lineNumber+")"),g=c.createEmptyPointCloud()}if(c.onPointCloudLoad){for(var i,j,k,l,m=[],n=0;n<g.pointCloud.length;n+=3)i=g.pointCloud[n],j=g.pointCloud[n+1],k=g.pointCloud[n+2],l=i*i+j*j+k*k,1e4>l&&m.push({x:i,y:j,z:k,id:n});c.pointCloud=g,c.pointCloud.tree=null,c.onPointCloudLoad()}}).fail(function(a,d,e){console.error("Request failed: "+b+"\n"+d+"\n"+e);var f=c.createEmptyPointCloud();c.onPointCloudLoad&&(c.pointCloud=f,c.onPointCloudLoad())})},this.decode=function(a){for(var b,c,d,e;a.length%4!=0;)a+="=";for(a=a.replace(/-/g,"+"),a=a.replace(/_/g,"/"),c=$.base64.decode(a),e=zpipe.inflate(c),d=new Uint8Array(e.length),b=0;b<e.length;++b)d[b]=e.charCodeAt(b);return d},this.parseHeader=function(a){return{headerSize:a.getUint8(0),numberOfPlanes:a.getUint16(1,!0),width:a.getUint16(3,!0),height:a.getUint16(5,!0),offset:a.getUint16(7,!0)}},this.parsePlanes=function(a,b){var c,d,e,f=[],g=[],h=[0,0,0];for(c=0;c<a.width*a.height;++c)g.push(b.getUint8(a.offset+c));for(c=0;c<a.numberOfPlanes;++c)e=a.offset+a.width*a.height+4*c*4,h[0]=b.getFloat32(e,!0),h[1]=b.getFloat32(e+4,!0),h[2]=b.getFloat32(e+8,!0),d=b.getFloat32(e+12,!0),f.push({n:h.slice(0),d:d});return{planes:f,indices:g}},this.computeDepthMap=function(a,b,c){var d,e,f,g,h,i,j,k=null,l=[0,0,0],m=a.width,n=a.height;k=new Float32Array(m*n);var o=new Float32Array(n),p=new Float32Array(n),q=new Float32Array(m),r=new Float32Array(m);for(e=0;n>e;++e)h=(n-e-.5)/n*Math.PI,o[e]=Math.sin(h),p[e]=Math.cos(h);for(d=0;m>d;++d)g=(m-d-.5)/m*2*Math.PI+Math.PI/2,q[d]=Math.sin(g),r[d]=Math.cos(g);for(e=0;n>e;++e)for(d=0;m>d;++d)f=b[e*m+d],l[0]=o[e]*r[d],l[1]=o[e]*q[d],l[2]=p[e],f>0?(i=c[f],j=Math.abs(i.d/(l[0]*i.n[0]+l[1]*i.n[1]+l[2]*i.n[2])),k[e*m+(m-d-1)]=j):k[e*m+(m-d-1)]=1e19;return{width:m,height:n,depthMap:k}},this.computePointCloud=function(a,b,c){var d,e,f,g,h,i,j,k=null,l=[0,0,0],m=a.width,n=a.height;k=new Float32Array(3*m*n);var o=new Float32Array(m),p=new Float32Array(m),q=new Float32Array(n),r=new Float32Array(n);for(e=0;n>e;++e)g=(n-e-.5)/n*Math.PI,q[e]=Math.sin(g),r[e]=Math.cos(g);for(d=0;m>d;++d)h=(m-d-.5)/m*2*Math.PI+Math.PI/2,o[d]=Math.sin(h),p[d]=Math.cos(h);for(e=0;n>e;++e)for(d=0;m>d;++d)f=b[e*m+d],l[0]=q[e]*p[d],l[1]=q[e]*o[d],l[2]=r[e],f>0?(i=c[f],j=Math.abs(i.d/(l[0]*i.n[0]+l[1]*i.n[1]+l[2]*i.n[2])),k[3*e*m+3*d]=j*l[0],k[3*e*m+3*d+1]=j*l[1],k[3*e*m+3*d+2]=j*l[2]):(k[3*e*m+3*d]=1e19,k[3*e*m+3*d+1]=1e19,k[3*e*m+3*d+2]=1e19);return{width:m,height:n,pointCloud:k}},this.parse=function(a){var b,c,d,a,e,f=this;return b=new DataView(a.buffer),c=f.parseHeader(b),d=f.parsePlanes(c,b),e=f.computePointCloud(c,d.indices,d.planes)},this.createEmptyDepthMap=function(){for(var a={width:512,height:256,depthMap:new Float32Array(131072)},b=0;131072>b;++b)a.depthMap[b]=1e19;return a},this.createEmptyPointCloud=function(){for(var a={width:512,height:256,pointCloud:new Float32Array(393216)},b=0;393216>b;++b)a.pointCloud[b]=1e19;return a}};var svl=svl||{},svl=svl||{};svl.canvasWidth=720,svl.canvasHeight=480,svl.svImageHeight=6656,svl.svImageWidth=13312,svl.alpha_x=4.6,svl.alpha_y=-4.65,svl._labelCounter=0,svl.getLabelCounter=function(){return svl._labelCounter++};var svl=svl||{},svl=svl||{},svl=svl||{};svl.formatRecordsToGoldenLabels=function(a){var b,c,d,e,f,g={},h=a.length;for(b=0;h>b;b++)if(d="LabelGSVPanoramaId"in a[b]?a[b].LabelGSVPanoramaId:"GSVPanoramaId"in a[b]?a[b].GSVPanoramaId:void 0,e="Lat"in a[b]?a[b].Lat:"labelLat"in a[b]?a[b].labelLat:void 0,f="Lng"in a[b]?a[b].Lng:"labelLng"in a[b]?a[b].labelLng:void 0,"1"!=a[b].Deleted){c=a[b].LabelId,c in g||(g[c]=[]);var i={AmazonTurkerId:a[b].AmazonTurkerId,LabelId:a[b].LabelId,LabelGSVPanoramaId:d,LabelType:a[b].LabelType,LabelPointId:a[b].LabelPointId,svImageX:a[b].svImageX,svImageY:a[b].svImageY,originalCanvasCoordinate:{x:a[b].originalCanvasX,y:a[b].originalCanvasY},originalHeading:a[b].originalHeading,originalPitch:a[b].originalPitch,originalZoom:a[b].originalZoom,heading:a[b].heading,pitch:a[b].pitch,zoom:a[b].zoom,Lat:e,Lng:f};"PhotographerHeading"in a[b]&&"PhotographerPitch"in a[b]&&(i.PhotographerHeading=parseFloat(a[b].PhotographerHeading),i.PhotographerPitch=parseFloat(a[b].PhotographerPitch)),g[c].push(i)}var j=[];for(c in g)j.push(g[c]);return j},svl.formatRecordsToLabels=svl.formatRecordsToGoldenLabels;var svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},panorama;svl.panorama=panorama,svl.getPanoId=getPanoId,svl.getPosition=getPosition,svl.getPOV=getPOV,svl.getLinks=getLinks;var fogMode=!0,fogSet=!1,current,first,previousPoints=[],radius=.1,isNotfirst=0,paths;svl.fog=void 0;var au=[],pty=[],polys=[],svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{};svl.gsvImageCoordinate2CanvasCoordinate=function(a,b,c){var d,e,f=c.zoom,g=svl.svImageWidth*svl.zoomFactor[f],h=svl.svImageHeight*svl.zoomFactor[f];a*=svl.zoomFactor[f],b*=svl.zoomFactor[f],d=a-g*c.heading/360,d=d/svl.alpha_x+svl.canvasWidth/2;var i=360*svl.alpha_x*(svl.canvasWidth/2)/g+10;return c.heading<i?g-svl.alpha_x*(svl.canvasWidth/2)<a&&(d=a-g-g*c.heading/360,d=d/svl.alpha_x+svl.canvasWidth/2):c.heading>360-i&&svl.alpha_x*(svl.canvasWidth/2)>a&&(d=a+g-g*c.heading/360,d=d/svl.alpha_x+svl.canvasWidth/2),e=b-h/2*(c.pitch/90),e=e/svl.alpha_y+svl.canvasHeight/2,{x:d,y:e}},svl.zoomFactor={1:1,2:2.1,3:4,4:8,5:16};var svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{},svl=svl||{};svl.util=svl.util||{},"function"!=typeof Object.create&&(Object.create=function(a){var b=function(){};return b.prototype=a,new b}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),Array.prototype.remove=function(a,b){var c=this.slice(parseInt(b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.sum=function(){return this.reduce(function(a,b){return a+b})},Array.prototype.mean=function(){return this.sum()/this.length},"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var userAgent=navigator.userAgent.toLowerCase();jQuery.browser={version:(userAgent.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1],chrome:/chrome/.test(userAgent),safari:/webkit/.test(userAgent)&&!/chrome/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)},svl.util.getBrowser=getBrowser,svl.util.scaleImageCoordinate=scaleImageCoordinate;var svl=svl||{};svl.util=svl.util||{},svl.util.color={},svl.util.color.RGBToRGBA=function(a,b){b||(b="0.5");var c;return void 0!==a&&(c="rgba(",c+=a.substring(4,a.length-1)+","+b+")"),c},svl.util.color.changeAlphaRGBA=changeAlphaRGBA,svl.util.color.changeDarknessRGBA=changeDarknessRGBA,svl.util.color.rgbToHsl=rgbToHsl,svl.util.color.hslToRgb=hslToRgb;var svl=svl||{};svl.util=svl.util||{},svl.util.math={},svl.util.math.toDegrees=toDegrees,svl.util.math.toRadians=toRadians,svl.util.math.latlngOffset=latlngOffset,svl.util.math.latlngInverseOffset=latlngInverseOffset,svl.util.math.latLngToAngle=latLngToAngle,svl.util.math.haversine=haversine,svl.util.math.distance3d=distance3d;var svl=svl||{};svl.util=svl.util||{},svl.util.shape={},svl.util.shape.lineWithRoundHead=lineWithRoundHead;var svl=svl||{};svl.misc={},svl.misc.imageCoordinateToCanvasCoordinate=imageCoordinateToCanvasCoordinate,svl.misc.getLabelCursorImagePath=getLabelCursorImagePath,svl.misc.getIconImagePaths=getLabelIconImagePath,svl.misc.getLabelInstructions=getLabelInstructions,svl.misc.getLabelDescriptions=getLabelDescriptions,svl.misc.getLabelColors=getLabelColors;