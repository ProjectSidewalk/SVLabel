function ActionStack(a,b){function c(a){svw.ui&&svw.ui.actionStack&&(f=svw.ui.actionStack.redo,g=svw.ui.actionStack.undo,f.css("opacity",.5),g.css("opacity",.5),f.bind("click",d),g.bind("click",e))}function d(){i.disableRedo||("tracker"in svw&&svw.tracker.push("Click_Redo"),h.redo())}function e(){i.disableUndo||("tracker"in svw&&svw.tracker.push("Click_Undo"),h.undo())}var f,g,h={className:"ActionStack"},i={actionStackCursor:0,disableRedo:!1,disableUndo:!1},j={disableRedo:!1,disableUndo:!1},k=[];return h.disableRedo=function(){return j.disableRedo?!1:(i.disableRedo=!0,svw.ui&&svw.ui.actionStack&&f.css("opacity",.5),this)},h.disableUndo=function(){return j.disableUndo?!1:(i.disableUndo=!0,svw.ui&&svw.ui.actionStack&&g.css("opacity",.5),this)},h.enableRedo=function(){return j.disableRedo?!1:(i.disableRedo=!1,svw.ui&&svw.ui.actionStack&&f.css("opacity",1),this)},h.enableUndo=function(){return j.disableUndo?!1:(i.disableUndo=!1,svw.ui&&svw.ui.actionStack&&g.css("opacity",1),this)},h.getStatus=function(a){return a in i||console.warn("You have passed an invalid key for status."),i[a]},h.lockDisableRedo=function(){return j.disableRedo=!0,this},h.lockDisableUndo=function(){return j.disableUndo=!0,this},h.pop=function(){return k.length>0&&(i.actionStackCursor-=1,k.splice(i.actionStackCursor)),this},h.push=function(a,b){var c=["addLabel","deleteLabel"];if(-1===c.indexOf(a))throw h.className+": Illegal action.";var d={action:a,label:b,index:i.actionStackCursor};return 0!==k.length&&k.length>i.actionStackCursor&&k.splice(i.actionStackCursor),k.push(d),i.actionStackCursor+=1,this},h.redo=function(){if(!i.disableRedo){if(k.length>i.actionStackCursor){var a=k[i.actionStackCursor];"addLabel"===a.action?("tracker"in svw&&svw.tracker.push("Redo_AddLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!1)):"deleteLabel"===a.action&&("tracker"in svw&&svw.tracker.push("Redo_RemoveLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!0),a.label.setVisibility("hidden")),i.actionStackCursor+=1}"canvas"in svw&&svw.canvas.clear().render2()}},h.size=function(){return k.length},h.undo=function(){if(!i.disableUndo){if(i.actionStackCursor-=1,i.actionStackCursor>=0){var a=k[i.actionStackCursor];"addLabel"===a.action?("tracker"in svw&&svw.tracker.push("Undo_AddLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!0)):"deleteLabel"===a.action&&("tracker"in svw&&svw.tracker.push("Undo_RemoveLabel",{labelId:a.label.getProperty("labelId")}),a.label.setStatus("deleted",!1),a.label.setVisibility("visible"))}else i.actionStackCursor=0;"canvas"in svw&&svw.canvas.clear().render2()}},h.unlockDisableRedo=function(){return j.disableRedo=!1,this},h.unlockDisableUndo=function(){return j.disableUndo=!1,this},h.getLock=function(a){return a in j||console.warn("You have passed an invalid key for status."),j[a]},h.updateOpacity=function(){svw.ui&&svw.ui.actionStack&&(i.actionStackCursor<k.length?f.css("opacity",1):f.css("opacity",.5),i.actionStackCursor>0?g.css("opacity",1):g.css("opacity",.5),i.disableUndo&&g.css("opacity",.5),i.disableRedo&&f.css("opacity",.5))},c(b),h}function getBusStopPositionLabel(){return{NextToCurb:{id:"NextToCurb",label:"Next to curb"},AwayFromCurb:{id:"AwayFromCurb",label:"Away from curb"},None:{id:"None",label:"Not provided"}}}function getHeadingEstimate(a,b,c,d){"number"!=typeof a&&(a=parseFloat(a)),"number"!=typeof b&&(b=parseFloat(b)),"number"!=typeof d&&(d=parseFloat(d)),"number"!=typeof c&&(c=parseFloat(c));var e=d-b,f=c-a;if(0===f||0===e)return 0;var g=toDegrees(Math.atan(e/f));return 90-g}function getLabelCursorImagePath(){return{Walk:{id:"Walk",cursorImagePath:void 0},StopSign:{id:"StopSign",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_OneLeg:{id:"StopSign_OneLeg",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_Column:{id:"StopSign_Column",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},StopSign_None:{id:"StopSign_None",cursorImagePath:"public/img/cursors/Cursor_BusStop2.png"},Landmark_Shelter:{id:"Landmark_Shelter",cursorImagePath:"public/img/cursors/Cursor_BusStopShelter2.png"},Landmark_Bench:{id:"Landmark_Bench",cursorImagePath:"public/img/cursors/Cursor_Bench2.png"},Landmark_TrashCan:{id:"Landmark_TrashCan",cursorImagePath:"public/img/cursors/Cursor_TrashCan3.png"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",cursorImagePath:"public/img/cursors/Cursor_Mailbox2.png"},Landmark_OtherPole:{id:"Landmark_OtherPole",cursorImagePath:"public/img/cursors/Cursor_OtherPole.png"}}}function getLabelIconImagePath(a){return{Walk:{id:"Walk",iconImagePath:void 0},StopSign:{id:"StopSign",iconImagePath:"public/img/icons/Icon_BusStop.png"},StopSign_OneLeg:{id:"StopSign_OneLeg",iconImagePath:"public/img/icons/Icon_BusStopSign_SingleLeg.png"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",iconImagePath:"public/img/icons/Icon_BusStopSign_TwoLegged.png"},StopSign_Column:{id:"StopSign_Column",iconImagePath:"public/img/icons/Icon_BusStopSign_Column.png"},StopSign_None:{id:"StopSign_None",iconImagePath:"public/img/icons/Icon_BusStop.png"},Landmark_Shelter:{id:"Landmark_Shelter",iconImagePath:"public/img/icons/Icon_BusStopShelter.png"},Landmark_Bench:{id:"Landmark_Bench",iconImagePath:"public/img/icons/Icon_Bench.png"},Landmark_TrashCan:{id:"Landmark_TrashCan",iconImagePath:"public/img/icons/Icon_TrashCan2.png"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",iconImagePath:"public/img/icons/Icon_Mailbox2.png"},Landmark_OtherPole:{id:"Landmark_OtherPole",iconImagePath:"public/img/icons/Icon_OtherPoles.png"}}}function getLabelInstructions(){return{Walk:{id:"Walk",instructionalText:"Explore mode: Find the closest bus stop and label surrounding landmarks",textColor:"rgba(255,255,255,1)"},StopSign:{id:"StopSign",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_OneLeg:{id:"StopSign_OneLeg",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},StopSign_Column:{id:"StopSign_Column",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus stop sign</span>',textColor:"rgba(255,255,255,1)"},Landmark_Shelter:{id:"Landmark_Shelter",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bus shelter</span>',textColor:"rgba(255,255,255,1)"},Landmark_Bench:{id:"Landmark_Bench",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">bench</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_TrashCan:{id:"Landmark_TrashCan",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">trash can</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",instructionalText:'Label mode: Locate and click at the bottom of the <span class="underline">mailbox or news paper box</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"},Landmark_OtherPole:{id:"Landmark_OtherPole",instructionalText:'Label mode: Locate and click at the bottom of poles such as <span class="underline bold">traffic sign, traffic light, and light pole</span> nearby a bus stop',textColor:"rgba(255,255,255,1)"}}}function getRibbonConnectionPositions(){return{Walk:{id:"Walk",text:"Walk",labelRibbonConnection:"25px"},StopSign:{id:"StopSign",text:"Stop Sign",labelRibbonConnection:"112px"},StopSign_OneLeg:{id:"StopSign_OneLeg",text:"One-leg Stop Sign",labelRibbonConnection:"112px"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",text:"Two-leg Stop Sign",labelRibbonConnection:"112px"},StopSign_Column:{id:"StopSign_Column",text:"Column Stop Sign",labelRibbonConnection:"112px"},Landmark_Shelter:{id:"Landmark_Shelter",text:"Bus Shelter",labelRibbonConnection:"188px"},Landmark_Bench:{id:"Landmark_Bench",text:"Bench",labelRibbonConnection:"265px"},Landmark_TrashCan:{id:"Landmark_TrashCan",text:"Trash Can",labelRibbonConnection:"338px"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",labelRibbonConnection:"411px"},Landmark_OtherPole:{id:"Landmark_OtherPole",labelRibbonConnection:"484px"}}}function getLabelDescriptions(){return{Walk:{id:"Walk",text:"Walk"},StopSign:{id:"StopSign",text:"Bus Stop Sign"},StopSign_OneLeg:{id:"StopSign_OneLeg",text:"One-leg Stop Sign"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",text:"Two-leg Stop Sign"},StopSign_Column:{id:"StopSign_Column",text:"Column Stop Sign"},StopSign_None:{id:"StopSign_None",text:"Not provided"},Landmark_Shelter:{id:"Landmark_Shelter",text:"Bus Stop Shelter"},Landmark_Bench:{id:"Landmark_Bench",text:"Bench"},Landmark_TrashCan:{id:"Landmark_TrashCan",text:"Trash Can / Recycle Can"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",text:"Mailbox / News Paper Box"},Landmark_OtherPole:{id:"Landmark_OtherPole",text:"Traffic Sign / Pole"}}}function getLabelColors(){return colorScheme2()}function colorScheme1(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(102, 194, 165, 0.9)"},StopSign_None:{id:"StopSign_None",fillStyle:"rgba(102, 194, 165, 0.9"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(252, 141, 98, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(141, 160, 203, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(231, 138, 195, 0.9)"}}}function colorScheme2(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(0, 161, 203, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(0, 161, 203, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(215, 0, 96, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(252, 217, 32, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(97, 174, 36, 0.9)"},Landmark_MailboxAndNewsPaperBox:{id:"Landmark_MailboxAndNewsPaperBox",fillStyle:"rgba(67, 113, 190, 0.9)"},Landmark_OtherPole:{id:"Landmark_OtherPole",fillStyle:"rgba(249, 79, 101, 0.9)"}}}function colorScheme3(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(97, 210, 214, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(97, 210, 214, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(97, 210, 214, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(97, 210, 214, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(237, 20, 111, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(237, 222, 69, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(155, 240, 233, 0.9)"}}}function colorScheme4(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(252, 217, 32, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(252, 217, 32, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(252, 217, 32, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(252, 217, 32, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(229, 59, 81, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(60, 181, 181, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(236, 108, 32, 0.9)"}}}function colorScheme5(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(208, 221, 43, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(208, 221, 43, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(208, 221, 43, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(208, 221, 43, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(152, 199, 61, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(0, 169, 224, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(103, 205, 220, 0.9)"}}}function colorScheme6(){return{Walk:{id:"Walk",fillStyle:"rgba(0, 0, 0, 0.9)"},StopSign:{id:"StopSign",fillStyle:"rgba(210, 54, 125, 0.9)"},StopSign_OneLeg:{id:"StopSign_OneLeg",fillStyle:"rgba(210, 54, 125, 0.9)"},StopSign_TwoLegs:{id:"StopSign_TwoLegs",fillStyle:"rgba(210, 54, 125, 0.9)"},StopSign_Column:{id:"StopSign_Column",fillStyle:"rgba(210, 54, 125, 0.9)"},Landmark_Shelter:{id:"Landmark_Shelter",fillStyle:"rgba(188, 160, 0, 0.9)"},Landmark_Bench:{id:"Landmark_Bench",fillStyle:"rgba(207, 49, 4, 0.9)"},Landmark_TrashCan:{id:"Landmark_TrashCan",fillStyle:"rgba(1, 142, 74, 0.9)"}}}function Canvas(a,b){function c(a){var b=document.getElementById("label-canvas");k=b.getContext("2d"),r.width=b.width,r.height=b.height,a&&"evaluationMode"in a&&(n.evaluationMode=a.evaluationMode),w&&(w.bind("mousedown",e),w.bind("mouseup",f),w.bind("mousemove",g)),y&&y.bind("click",i)}function d(){svw.tracker.push("LabelingCanvas_FinishLabeling");var a=svw.ribbon.getStatus("selectedLabelType"),b=getLabelColors()[a],c=getLabelDescriptions()[svw.ribbon.getStatus("selectedLabelType")],d=getLabelIconImagePath()[c.id].iconImagePath;o.fillStyleInnerCircle=b.fillStyle,o.iconImagePath=d;var e,f=s.length,g=[],h=svw.getPOV();for(e=0;f>e;e++)g.push(new Point(s[e].x,s[e].y,h,o));var i=new Path(g,{}),j=getPosition(),k={canvasWidth:svw.canvasWidth,canvasHeight:svw.canvasHeight,canvasDistortionAlphaX:svw.alpha_x,canvasDistortionAlphaY:svw.alpha_y,labelId:svw.getLabelCounter(),labelType:c.id,labelDescription:c.text,labelFillStyle:b.fillStyle,panoId:getPanoId(),panoramaLat:j.lat,panoramaLng:j.lng,panoramaHeading:h.heading,panoramaPitch:h.pitch,panoramaZoom:h.zoom,svImageWidth:svw.svImageWidth,svImageHeight:svw.svImageHeight,svMode:"html4"};if("panorama"in svw&&"getPhotographerPov"in svw.panorama){var l=svw.panorama.getPhotographerPov();k.photographerHeading=l.heading,k.photographerPitch=l.pitch}var m=Label(i,k);if(!m)throw"Failed to add a new label.";p.currentLabel=new Label(i,k),v.push(p.currentLabel),svw.actionStack.push("addLabel",p.currentLabel),s=[],svw.ribbon.backToWalk(),"goldenInsertion"in svw&&svw.goldenInsertion&&svw.goldenInsertion.isRevisingLabels()&&svw.goldenInsertion.reviewLabels()}function e(a){m.isLeftDown=!0,m.leftDownX=mouseposition(a,this).x,m.leftDownY=mouseposition(a,this).y,n.evaluationMode||svw.tracker.push("LabelingCanvas_MouseDown",{x:m.leftDownX,y:m.leftDownY}),m.prevMouseDownTime=(new Date).getTime()}function f(a){var b;if(m.isLeftDown=!1,m.leftUpX=mouseposition(a,this).x,m.leftUpY=mouseposition(a,this).y,b=(new Date).getTime(),!n.evaluationMode)if(!p.disableLabeling&&b-m.prevMouseUpTime>300){var c;if(!svw.ribbon)throw l.className+" drawingLayerMouseUp(): ribbon not defined.";var e=svw.ribbon.getStatus("selectedLabelType"),f=getLabelDescriptions();if(c=f[e],p.drawing){var g=!1,h=s.length;if(h>2){var i=Math.sqrt(Math.pow(s[0].x-m.leftUpX,2)+Math.pow(s[0].y-m.leftUpY,2));i<n.radiusThresh&&(g=!0,p.drawing=!1,d())}if(!g){var j={x:m.leftUpX,y:m.leftUpY};s.push(j)}}else{p.drawing=!0,"tracker"in svw&&svw.tracker&&svw.tracker.push("LabelingCanvas_StartLabeling");var j={x:m.leftUpX,y:m.leftUpY};s.push(j)}l.clear(),l.setVisibilityBasedOnLocation("visible",getPanoId()),l.render2()}else if(b-m.prevMouseUpTime<400){var h=s.length;p.drawing&&h>2&&(p.drawing=!1,d(),l.clear(),l.setVisibilityBasedOnLocation("visible",getPanoId()),l.render2())}svw.tracker.push("LabelingCanvas_MouseUp",{x:m.leftUpX,y:m.leftUpY}),m.prevMouseUpTime=(new Date).getTime(),m.prevMouseDownTime=0}function g(b){var c=mouseposition(b,this);if(m.currX=c.x,m.currY=c.y,!("ribbon"in svw))throw l.className+": Import the RibbonMenu.js and instantiate it!";var d=svw.misc.getLabelCursorImagePath(),e=svw.ribbon.getStatus("mode");if(e){var f=d[e].cursorImagePath,g="url("+f+") 6 25, auto";t&&t.isAnyOpen()&&(g="default"),a(this).css("cursor",g)}if(!p.drawing){var i=h(m.currX,m.currY);i&&"Path"===i.className?(l.showLabelTag(p.currentLabel),i.renderBoundingBox(k)):l.showLabelTag(void 0)}l.clear(),l.render2(),m.prevX=mouseposition(b,this).x,m.prevY=mouseposition(b,this).y}function h(a,b){var c,d,e;for(d=v.length,e=!1,c=0;d>c;c+=1)if(e=v[c].isOn(a,b))return p.currentLabel=v[c],e;return!1}function i(){if(!p.disableLabelDelete){svw.tracker.push("Click_LabelDelete");var a=l.getCurrentLabel();if(!a){var b=x.css("left"),c=x.css("top");b=b.replace("px",""),c=c.replace("px",""),b=parseInt(b,10)+5,c=parseInt(c,10)+5;var d=h(b,c);if(d&&"Point"===d.className){var e=d.belongsTo();a=e.belongsTo()}else d&&"Label"===d.className?a=d:d&&"Path"===d.className&&(a=d.belongsTo())}a&&(l.removeLabel(a),svw.actionStack.push("deleteLabel",l.getCurrentLabel()),x.css("visibility","hidden"),q.showLabelTag&&l.unlockShowLabelTag())}}function j(){if(!svw.ribbon)return!1;var a=0,b=s.length,c=getLabelColors()[svw.ribbon.getStatus("selectedLabelType")],d=c.fillStyle;if(d=svw.util.color.changeAlphaRGBA(d,.5),k.strokeStyle="rgba(255,255,255,1)",k.lineWidth=2,b>1){var e=s[1],f=s[0],g=Math.sqrt(Math.pow(s[0].x-m.currX,2)+Math.pow(s[0].y-m.currY,2));g<n.radiusThresh&&b>2?svw.util.shape.lineWithRoundHead(k,f.x,f.y,2*n.tempPointRadius,e.x,e.y,n.tempPointRadius,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d):svw.util.shape.lineWithRoundHead(k,f.x,f.y,n.tempPointRadius,e.x,e.y,n.tempPointRadius,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d)}for(a=2;b>a;a++){var e=s[a],f=s[a-1];svw.util.shape.lineWithRoundHead(k,f.x,f.y,5,e.x,e.y,5,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d)}g<n.radiusThresh&&b>2?svw.util.shape.lineWithRoundHead(k,s[b-1].x,s[b-1].y,n.tempPointRadius,s[0].x,s[0].y,2*n.tempPointRadius,"both","rgba(255,255,255,1)",d,"none","rgba(255,255,255,1)",d):svw.util.shape.lineWithRoundHead(k,s[b-1].x,s[b-1].y,n.tempPointRadius,m.currX,m.currY,n.tempPointRadius,"both","rgba(255,255,255,1)",d,"stroke","rgba(255,255,255,1)",d)}var k,l={className:"Canvas",testCases:{}},m={currX:0,currY:0,prevX:0,prevY:0,leftDownX:0,leftDownY:0,leftUpX:0,leftUpY:0,isLeftDown:!1,prevMouseDownTime:0,prevMouseUpTime:0},n={evaluationMode:!1,radiusThresh:7,showDeleteMenuTimeOutToken:void 0,tempPointRadius:5},o={fillStyleInnerCircle:"rgba(0,0,0,1)",lineWidthOuterCircle:2,iconImagePath:void 0,radiusInnerCircle:5,radiusOuterCircle:6,strokeStyleOuterCircle:"rgba(255,255,255,1)",storedInDatabase:!1},p={currentLabel:null,disableLabelDelete:!1,disableLabelEdit:!1,disableLabeling:!1,disableWalking:!1,drawing:!1,lockCurrentLabel:!1,lockDisableLabelDelete:!1,lockDisableLabelEdit:!1,lockDisableLabeling:!1,svImageCoordinatesAdjusted:!1,totalLabelCount:0,visibilityMenu:"hidden"},q={showLabelTag:!1},r={height:0,width:0},s=[],t=void 0,u=[],v=[],w=(0===a("#labelCanvas").length?null:a("#labelCanvas"),0===a("div#labelDrawingLayer").length?null:a("div#labelDrawingLayer")),x=0===a("#Holder_LabelDeleteIcon").length?null:a("#Holder_LabelDeleteIcon"),y=(0===a("#Holder_LabelEditIcon").length?null:a("#Holder_LabelEditIcon"),0===a("#LabelDeleteIcon").length?null:a("#LabelDeleteIcon"));return l.cancelDrawing=function(){return"tracker"in svw&&svw.tracker&&svw.tracker.push("LabelingCanvas_CancelLabeling"),s=[],p.drawing=!1,l.clear().render2(),this},l.clear=function(){return k?k.clearRect(0,0,r.width,r.height):console.warn("The ctx is not set."),this},l.disableLabelDelete=function(){return p.lockDisableLabelDelete?!1:(p.disableLabelDelete=!0,this)},l.disableLabelEdit=function(){return p.lockDisableLabelEdit?!1:(p.disableLabelEdit=!0,this)},l.disableLabeling=function(){return p.lockDisableLabeling?!1:(p.disableLabeling=!0,this)},l.enableLabelDelete=function(){return p.lockDisableLabelDelete?!1:(p.disableLabelDelete=!1,this)},l.enableLabelEdit=function(){return p.lockDisableLabelEdit?!1:(p.disableLabelEdit=!1,this)},l.enableLabeling=function(){return p.lockDisableLabeling?!1:(p.disableLabeling=!1,this)},l.getCurrentLabel=function(){return p.currentLabel},l.getLabels=function(a){return a||(a="user"),"system"===a?l.getSystemLabels(!1):l.getUserLabels(!1)},l.getLock=function(a){return q[a]},l.getNumLabels=function(){var a,b=v.length,c=0;for(a=0;b>a;a++)!v[a].isDeleted()&&v[a].isVisible()&&c++;return c},l.getStatus=function(a){return a in p||console.warn("You have passed an invalid key for status."),p[a]},l.getSystemLabels=function(b){return b||(b=!1),b?u:a.extend(!0,[],u)},l.getUserLabelCount=function(){var a=l.getUserLabels();return a=a.filter(function(a){return!a.isDeleted()&&a.isVisible()}),a.length},l.getUserLabels=function(b){return b||(b=!1),b?v:a.extend(!0,[],v)},l.hideDeleteLabel=function(a,b){return t.hideDeleteLabel(),this},l.insertLabel=function(a,b){b||(b="user");var c,d,e,f,g=svw.misc.getLabelColors(),h=svw.misc.getIconImagePaths(),i=a.length,j=[];for(c=0;i>c;c+=1)d=a[c],e={heading:d.originalHeading,pitch:d.originalPitch,zoom:d.originalZoom},f=new Point,"PhotographerHeading"in d&&d.PhotographerHeading&&"PhotographerPitch"in d&&d.PhotographerPitch&&f.setPhotographerPov(parseFloat(d.PhotographerHeading),parseFloat(d.PhotographerPitch)),f.resetSVImageCoordinate({x:parseInt(d.svImageX,10),y:parseInt(d.svImageY,10)}),f.resetProperties({fillStyleInnerCircle:g[d.LabelType].fillStyle,lineWidthOuterCircle:2,iconImagePath:h[d.LabelType].iconImagePath,originalCanvasCoordinate:d.originalCanvasCoordinate,originalHeading:d.originalHeading,originalPitch:d.originalPitch,originalZoom:d.originalZoom,pov:e,radiusInnerCircle:5,radiusOuterCircle:6,strokeStyleOuterCircle:"rgba(255,255,255,1)",storedInDatabase:!1}),j.push(f);var k,l={},m=svw.misc.getLabelDescriptions();k=new Path(j),l.canvasWidth=svw.canvasWidth,l.canvasHeight=svw.canvasHeight,l.canvasDistortionAlphaX=svw.alpha_x,l.canvasDistortionAlphaY=svw.alpha_y,l.labelId=a[0].LabelId,l.labelerId=a[0].AmazonTurkerId,l.labelType=a[0].LabelType,l.labelDescription=m[l.labelType].text,l.labelFillStyle=g[l.labelType].fillStyle,l.panoId=a[0].LabelGSVPanoramaId,l.panoramaLat=a[0].Lat,l.panoramaLng=a[0].Lng,l.panoramaHeading=a[0].heading,l.panoramaPitch=a[0].pitch,l.panoramaZoom=a[0].zoom,l.svImageWidth=svw.svImageWidth,l.svImageHeight=svw.svImageHeight,l.svMode="html4","PhotographerPitch"in a[0]&&"PhotographerHeading"in a[0]&&(l.photographerHeading=a[0].PhotographerHeading,l.photographerPitch=a[0].PhotographerPitch);var n=new Label(k,l);"system"===b?u.push(n):v.push(n)},l.isDrawing=function(){return p.drawing},l.isOn=function(a,b){return h(a,b)},l.lockCurrentLabel=function(){return p.lockCurrentLabel=!0,this},l.lockDisableLabelDelete=function(){return p.lockDisableLabelDelete=!0,this},l.lockDisableLabelEdit=function(){return p.lockDisableLabelEdit=!0,this},l.lockDisableLabeling=function(){return p.lockDisableLabeling=!0,this},l.lockShowLabelTag=function(){return q.showLabelTag=!0,this},l.pushLabel=function(a){return p.currentLabel=a,v.push(a),svw.actionStack&&svw.actionStack.push("addLabel",a),this},l.removeAllLabels=function(){return v=[],this},l.removeLabel=function(a){return a?(svw.tracker.push("RemoveLabel",{labelId:a.getProperty("labelId")}),a.setStatus("deleted",!0),a.setStatus("visibility","hidden"),"goldenInsertion"in svw&&svw.goldenInsertion&&svw.goldenInsertion.isRevisingLabels()&&svw.goldenInsertion.reviewLabels(),l.clear(),l.render2(),this):!1},l.render=function(){svw.getPOV();return this},l.render2=function(){if(!k)return console.warn("The ctx is not set."),this;var a,b,c,d={Landmark_Bench:0,Landmark_Shelter:0,Landmark_TrashCan:0,Landmark_MailboxAndNewsPaperBox:0,Landmark_OtherPole:0,StopSign:0,CurbRamp:0,NoCurbRamp:0};p.totalLabelCount=0;var e=svw.getPOV();if(!p.svImageCoordinatesAdjusted){var f=svw.panorama.getPhotographerPov();if(f&&"heading"in f&&"pitch"in f){var g;for(c=v.length,a=0;c>a;a+=1){b=v[a];var h=b.getPoints(!0),i=h.length;for(g=0;i>g;g++){var l=h[g].getProperties(),m=h[g].getGSVImageCoordinate();if("photographerHeading"in l&&l.photographerHeading){var o=f.heading-l.photographerHeading,q=f.pitch-l.photographerPitch,r=(m.x+o/360*svw.svImageWidth+svw.svImageWidth)%svw.svImageWidth,s=m.y+q/90*svw.svImageHeight;h[g].resetSVImageCoordinate({x:r,y:s})}}}for(c=u.length,a=0;c>a;a+=1){b=u[a];var h=b.getPoints(!0),i=h.length;for(g=0;i>g;g++){var l=h[g].getProperties(),m=h[g].getGSVImageCoordinate();if("photographerHeading"in l&&l.photographerHeading){var o=f.heading-l.photographerHeading,q=f.pitch-l.photographerPitch,r=(m.x+o/360*svw.svImageWidth+svw.svImageWidth)%svw.svImageWidth,s=m.y+q/180*svw.svImageHeight;h[g].resetSVImageCoordinate({x:r,y:s})}}}p.svImageCoordinatesAdjusted=!0}}for(c=v.length,a=0;c>a;a+=1)b=v[a],n.evaluationMode?b.render(k,e,!0):b.render(k,e),b.isVisible()&&!b.isDeleted()&&(d[b.getLabelType()]+=1,p.totalLabelCount+=1);for(c=u.length,a=0;c>a;a+=1)b=u[a],n.evaluationMode?b.render(k,e,!0):b.render(k,e);return p.drawing&&j(),"form"in svw&&svw.form.checkSubmittable(),"progressPov"in svw&&svw.progressPov.updateCompletionRate(),svw.labeledLandmarkFeedback&&svw.labeledLandmarkFeedback.setLabelCount(d),svw.actionStack&&svw.actionStack.updateOpacity(),svw.zoomControl&&svw.zoomControl.updateOpacity(),"goldenInsertion"in svw&&svw.goldenInsertion&&svw.goldenInsertion.renderMessage(),this},l.renderBoundingBox=function(a){return a.renderBoundingBox(k),this},l.setCurrentLabel=function(a){return p.lockCurrentLabel?!1:(p.currentLabel=a,this)},l.setStatus=function(a,b){if(!(a in p))throw l.className+": Illegal status name.";return"disableLabeling"===a?"boolean"==typeof b?(b?l.disableLabeling():l.enableLabeling(),this):!1:"disableMenuClose"===a?"boolean"==typeof b?(b?l.disableMenuClose():l.enableMenuClose(),this):!1:void("disableLabelDelete"===a?b===!0?l.disableLabelDelete():b===!1&&l.enableLabelDelete():p[a]=b)},l.showLabelTag=function(a){if(!q.showLabelTag){var b,c,d=!1;if(c=v.length,a)for(b=0;c>b;b+=1)v[b].getLabelId()===a.getLabelId()?(v[b].setTagVisibility("visible"),d=!0):(v[b].setTagVisibility("hidden"),v[b].resetTagCoordinate());else{for(b=0;c>b;b++)v[b].setTagVisibility("hidden"),v[b].resetTagCoordinate();x.css("visibility","hidden")}return d||x.css("visibility","hidden"),l.clear().render2(),this}},l.setTagVisibility=function(a){return l.showLabelTag(a)},l.setVisibility=function(a){var b=0,c=0;for(c=v.length,b=0;c>b;b+=1)v[b].unlockVisibility().setVisibility("visible");return this},l.setVisibilityBasedOnLocation=function(a){var b=0,c=0;for(c=v.length,b=0;c>b;b+=1)v[b].setVisibilityBasedOnLocation(a,getPanoId());return this},l.setVisibilityBasedOnLabelerId=function(a,b,c){var d=0,e=0;for(e=v.length,d=0;e>d;d+=1)v[d].setVisibilityBasedOnLabelerId(a,b,c);return this},l.setVisibilityBasedOnLabelerIdAndLabelTypes=function(a,b,c){var d=0,e=0;for(e=v.length,d=0;e>d;d+=1)v[d].setVisibilityBasedOnLabelerIdAndLabelTypes(a,b,c);return this},l.showDeleteLabel=function(a,b){t.showDeleteLabel(a,b)},l.unlockCurrentLabel=function(){return p.lockCurrentLabel=!1,this},l.unlockDisableLabelDelete=function(){return p.lockDisableLabelDelete=!1,this},l.unlockDisableLabelEdit=function(){return p.lockDisableLabelEdit=!1,this},l.unlockDisableLabeling=function(){return p.lockDisableLabeling=!1,this},l.unlockShowLabelTag=function(){return q.showLabelTag=!1,this},c(b),l}function ExampleWindow(a,b){function c(b){f=a(b.domIds.holder),g=a(b.domIds.closeButtonHolder),h=a(b.domIds.StopSign_OneLeg),i=a(b.domIds.StopSign_TwoLegs),j=a(b.domIds.StopSign_Column),k=a(b.domIds.NextToCurb),l=a(b.domIds.AwayFromCurb),p={StopSign_OneLeg:h,StopSign_TwoLegs:i,StopSign_Column:j,NextToCurb:k,AwayFromCurb:l},g.bind({click:m.close,mouseenter:d,mouseleave:e})}function d(){return a(this).css({cursor:"pointer"}),this}function e(){return a(this).css({cursor:"default"}),this}var f,g,h,i,j,k,l,m={className:"ExampleWindow"},n={exampleCategories:["StopSign_OneLeg","StopSign_TwoLegs","StopSign_Column","NextToCurb","AwayFromCurb"]},o={open:!1},p={};return m.close=function(){return o.open=!1,f.css({visibility:"hidden"}),a.each(p,function(a,b){b.css({visibility:"hidden"})}),this},m.isOpen=function(){return o.open},m.show=function(b){return-1===n.exampleCategories.indexOf(b)?!1:(o.open=!0,f.css({visibility:"visible"}),a.each(p,function(a,c){console.log(a),a===b?c.css({visibility:"visible"}):c.css({visibility:"hidden"})}),this)},c(b),m}function Form(a,b){function c(b){var c=(""!==getURLParameter("groupId"),""!==getURLParameter("hitId")),d=""!==getURLParameter("workerId"),f=getURLParameter("assignmentId");if(D.onboarding=b.onboarding,D.dataStoreUrl=b.dataStoreUrl,"assignmentId"in b&&b.assignmentId&&(D.assignmentId=b.assignmentId),"hitId"in b&&b.hitId&&(D.hitId=b.hitId),"turkerId"in b&&b.turkerId&&(D.turkerId=b.turkerId),"userExperiment"in b&&b.userExperiment&&(D.userExperiment=!0),p=a("#BusStopLabelerForm"),q=a("#CommentField"),r=a("#Button_Submit"),s=a("#Button_Skip"),t=a("#BusStopAbsence_Submit"),u=a("#BusStopAbsence_Cancel"),v=a(".Radio_BusStopAbsence"),w=a("#Text_BusStopAbsenceOtherReason"),x=a("#Holder_SkipOptions"),y=a("#Holder_PageOverlay"),D.userExperiment&&(A=a("#task-difficulty-button"),z=a("#task-difficulty-wrapper")),a('input[name="assignmentId"]').attr("value",D.assignmentId),a('input[name="workerId"]').attr("value",D.turkerId),a('input[name="hitId"]').attr("value",D.hitId),f&&"ASSIGNMENT_ID_NOT_AVAILABLE"===f?(D.isPreviewMode=!0,D.isAMTTask=!0,C.unlockDisableSubmit().disableSubmit().lockDisableSubmit(),C.unlockDisableSkip().disableSkip().lockDisableSkip()):d&&!f?(D.isPreviewMode=!1,D.isAMTTask=!1):f||c||d?(D.isPreviewMode=!1,D.isAMTTask=!0):(D.isPreviewMode=!1,D.isAMTTask=!1),D.isSandbox=!1,D.isAMTTask&&-1!==document.referrer.indexOf("workersandbox.mturk.com")&&(D.isSandbox=!0,p.prop("action","https://workersandbox.mturk.com/mturk/externalSubmit")),D.isAMTTask&&D.isPreviewMode){var h='<div class="amt-preview-warning-holder"><div class="amt-preview-warning">Warning: you are on a Preview Mode!</div></div>';a("body").append(h),C.disableSubmit(),C.lockDisableSubmit()}D.commentFieldMessage=q.attr("title"),q.val(D.commentFieldMessage),e(),q.bind("focus",focusCallback),q.bind("blur",blurCallback),p.bind("submit",g),s.bind("click",k),t.on("click",j),u.on("click",l),v.on("click",m),w.get().length>0&&(w[0].oninput=n),D.userExperiment&&A.bind("click",o)}function d(){var b,c,d,e={},f=svw.map.getInitialPanoId();b=D.hitId?D.hitId:getURLParameter("hitId"),c=D.assignmentId?D.assignmentId:getURLParameter("assignmentId"),d=D.turkerId?D.turkerId:getURLParameter("workerId"),d||(d="Test_Kotaro"),b||(b="Test_Hit"),c||(c="Test_Assignment"),e.assignment={amazon_turker_id:d,amazon_hit_id:b,amazon_assignment_id:c,interface_type:"StreetViewLabeler",interface_version:"3",completed:0,need_qualification:0,task_description:D.taskDescription},e.labelingTask={task_panorama_id:D.taskPanoramaId,task_gsv_panorama_id:f,no_label:0,description:"",previous_labeling_task_id:D.previousLabelingTaskId},e.labelingTaskEnvironment={browser:getBrowser(),browser_version:getBrowserVersion(),browser_width:a(window).width(),browser_height:a(window).height(),screen_width:screen.width,screen_height:screen.height,avail_width:screen.availWidth,avail_height:screen.availHeight,operating_system:getOperatingSystem()},e.userInteraction=svw.tracker.getActions(),e.labels=[];for(var g=svw.canvas.getLabels(),h=0;h<g.length;h+=1){var i=g[h],j=i.getProperties(),k=i.getPath().getPoints(),l=k.length,m={deleted:i.isDeleted()?1:0,label_id:i.getLabelId(),label_type:i.getLabelType(),label_gsv_panorama_id:j.panoId,label_points:[],label_additional_information:void 0
};"photographerHeading"in j&&"photographerPitch"in j&&(m.photographer_heading=j.photographerHeading,m.photographer_pitch=j.photographerPitch);for(var n=0;l>n;n+=1){var o=k[n],p=o.getGSVImageCoordinate(),r={svImageX:p.x,svImageY:p.y,originalCanvasX:o.originalCanvasCoordinate.x,originalCanvasY:o.originalCanvasCoordinate.y,originalHeading:o.originalPov.heading,originalPitch:o.originalPov.pitch,originalZoom:o.originalPov.zoom,canvasX:o.canvasCoordinate.x,canvasY:o.canvasCoordinate.y,heading:o.pov.heading,pitch:o.pov.pitch,zoom:o.pov.zoom,lat:j.panoramaLat,lng:j.panoramaLng,svImageHeight:j.svImageHeight,svImageWidth:j.svImageWidth,canvasHeight:j.canvasHeight,canvasWidth:j.canvasWidth,alphaX:j.canvasDistortionAlphaX,alphaY:j.canvasDistortionAlphaY};m.label_points.push(r)}e.labels.push(m)}0===e.labels.length&&(e.labelingTask.no_label=0);var s=q.val();return e.comment=void 0,s&&s!==q.attr("title")&&(e.comment=q.val()),e}function e(){t.attr("disabled",!0),t.css("color","rgba(96,96,96,0.5)")}function f(){t.attr("disabled",!1),t.css("color","rgba(96,96,96,1)")}function g(b){(!D.isAMTTask||D.taskRemaining>1)&&b.preventDefault();var c=D.dataStoreUrl,e={};if(E.disableSubmit)return i(),!1;if(window.location.reload(),"goldenInsertion"in svw&&svw.goldenInsertion){svw.goldenInsertion.reviewLabels();return C.disableSubmit().lockDisableSubmit(),C.disableSkip().lockDisableSkip(),!1}if(t.attr("disabled",!0),y.css("visibility","visible"),D.userExperiment&&!E.taskDifficulty)return E.submitType="submit",z.css("visibility","visible"),!1;if(!D.onboarding){svw.tracker.push("TaskSubmit"),e=d(),void 0!=E.taskDifficulty&&(e.taskDifficulty=E.taskDifficulty,e.labelingTask.description="TaskDifficulty:"+E.taskDifficulty,E.taskDifficultyComment&&(e.comment="TaskDifficultyCommentField:"+E.taskDifficultyComment+";InterfaceCommentField:"+e.comment));try{a.ajax({async:!1,url:c,type:"post",data:e,dataType:"json",success:function(a){a.error&&console.log(a.error)},error:function(a){throw a}})}catch(b){return console.error(b),!1}return D.taskRemaining>1?(window.location.reload(),!1):D.isAMTTask?!0:(window.location.reload(),!1)}return!1}function h(){if(!("goldenInsertion"in svw&&svw.goldenInsertion))throw C.className+": This method cannot be called without GoldenInsertion";svw.tracker.push("GoldenInsertion_Submit");var b,c=D.dataStoreUrl;svw.goldenInsertion.disableOkButton(),b=d(),b.labelingTask.description="GoldenInsertion";try{a.ajax({async:!1,url:c,type:"post",data:b,dataType:"json",success:function(a){"object"==typeof a&&"error"in a&&a.error&&console.log(a.error)},error:function(a){throw a}})}catch(e){return console.error(e),!1}return window.location.reload(),!1}function i(){var b=parseInt(100*svw.progressPov.getCompletionRate(),10);if(!("onboarding"in svw&&svw.onboarding)&&100>b){var c,d="You have inspected "+b+"% of the scene. Let's inspect all the corners before you submit the task!",e=a("#Holder_OnboardingMessageBox");if(B.clear(),B.renderMessage(300,250,d,350,140),B.renderArrow(650,282,710,282),"hidden"===E.disabledButtonMessageVisibility){E.disabledButtonMessageVisibility="visible";var f='<button id="TempOKButton" class="button bold" style="left:20px;position:relative; width:100px;">OK</button>';e.append(f),c=a("#TempOKButton"),c.bind("click",function(){c.remove(),B.clear(),E.disabledButtonMessageVisibility="hidden"})}}}function j(b){(!D.isAMTTask||D.taskRemaining>1)&&b.preventDefault();var c=D.dataStoreUrl,e={};if("goldenInsertion"in svw&&svw.goldenInsertion){C.disableSubmit().lockDisableSubmit(),s.attr("disabled",!0),t.attr("disabled",!0),x.css({visibility:"hidden"});svw.goldenInsertion.reviewLabels();return!1}if(r.attr("disabled",!0),s.attr("disabled",!0),t.attr("disabled",!0),y.css("visibility","visible"),D.userExperiment&&!E.taskDifficulty)return E.submitType="skip",z.css("visibility","visible"),!1;if("Other:"===E.radioValue&&(E.skipReasonDescription="Other: "+w.val()),!D.onboarding){svw.tracker.push("TaskSubmitSkip"),e=d(),e.noLabels=!0,e.labelingTask.no_label=1,e.labelingTask.description=E.skipReasonDescription,void 0!=E.taskDifficulty&&(e.taskDifficulty=E.taskDifficulty,e.labelingTask.description="TaskDifficulty:"+E.taskDifficulty,E.taskDifficultyComment&&(e.comment="TaskDifficultyCommentField:"+E.taskDifficultyComment+";InterfaceCommentField:"+e.comment));try{a.ajax({async:!1,url:c,type:"post",data:e,success:function(a){a.error&&console.log(a.error)},error:function(a){throw a}})}catch(b){return console.error(b),!1}return D.taskRemaining>1?(window.location.reload(),!1):D.isAMTTask?(document.getElementById("BusStopLabelerForm").submit(),!0):(window.location.reload(),!1)}return!1}function k(a){return a.preventDefault(),E.disableSkip?i():(svw.tracker.push("Click_OpenSkipWindow"),x.css({visibility:"visible"})),!1}function l(a){return a.preventDefault(),svw.tracker.push("Click_CloseSkipWindow"),x.css({visibility:"hidden"}),!1}function m(){if(E.radioValue=a(this).attr("value"),svw.tracker.push("Click_SkipRadio",{RadioValue:E.radioValue}),"Other:"!==E.radioValue)E.skipReasonDescription=E.radioValue,f();else{var b=w.val();b?f():e()}}function n(){if(E.radioValue&&"Other:"===E.radioValue){var a=w.val();a?f():e()}}function o(b){E.taskDifficulty=parseInt(a('input[name="taskDifficulty"]:radio:checked').val(),10),E.taskDifficultyComment=a("#task-difficulty-comment").val(),E.taskDifficultyComment=""!=E.taskDifficultyComment?E.taskDifficultyComment:void 0,console.log(E.taskDifficultyComment),E.taskDifficulty&&("submitType"in E&&"submit"==E.submitType?g(b):"submitType"in E&&"skip"==E.submitType&&j(b))}var p,q,r,s,t,u,v,w,x,y,z,A,B,C={className:"Form"},D={commentFieldMessage:void 0,isAMTTask:!1,isPreviewMode:!1,previousLabelingTaskId:void 0,dataStoreUrl:void 0,onboarding:!1,taskRemaining:0,taskDescription:void 0,taskPanoramaId:void 0,hitId:void 0,assignmentId:void 0,turkerId:void 0,userExperiment:!1},E={disabledButtonMessageVisibility:"hidden",disableSkipButton:!1,disableSubmit:!1,radioValue:void 0,skipReasonDescription:void 0,submitType:void 0,taskDifficulty:void 0,taskDifficultyComment:void 0},F={disableSkipButton:!1,disableSubmit:!1};return C.checkSubmittable=function(){if("progressPov"in svw&&svw.progressPov)var a=svw.progressPov.getCompletionRate();else var a=0;var b=svw.canvas.getNumLabels();return.01>1-a?(b>0?(C.enableSubmit(),C.disableSkip()):(C.disableSubmit(),C.enableSkip()),!0):(C.disableSubmit(),C.disableSkip(),!1)},C.compileSubmissionData=function(){return d()},C.disableSubmit=function(){return F.disableSubmit?!1:(E.disableSubmit=!0,r.css("opacity",.5),this)},C.disableSkip=function(){return F.disableSkip?!1:(E.disableSkip=!0,s.css("opacity",.5),this)},C.enableSubmit=function(){return F.disableSubmit?!1:(E.disableSubmit=!1,r.css("opacity",1),this)},C.enableSkip=function(){return F.disableSkip?!1:(E.disableSkip=!1,s.css("opacity",1),this)},C.goldenInsertionSubmit=function(){return h()},C.isPreviewMode=function(){return D.isPreviewMode},C.lockDisableSubmit=function(){return F.disableSubmit=!0,this},C.lockDisableSkip=function(){return F.disableSkip=!0,this},C.setPreviousLabelingTaskId=function(a){return D.previousLabelingTaskId=a,this},C.setTaskDescription=function(a){return D.taskDescription=a,this},C.setTaskRemaining=function(a){return D.taskRemaining=a,this},C.setTaskPanoramaId=function(a){return D.taskPanoramaId=a,this},C.unlockDisableSubmit=function(){return F.disableSubmit=!1,this},C.unlockDisableSkip=function(){return F.disableSkipButton=!1,this},c(b),C}function GoldenInsertion(a,b){function c(a){"goldenLabelVisibility"in a&&(p.goldenLabelVisibility=a.goldenLabelVisibility),l=new Onboarding(a,b),m=b("#ModeSwitchButton_CurbRamp"),n=b("#ModeSwitchButton_NoCurbRamp")}function d(){q.currentLabel=void 0,l.clear()}function e(){if(!("form"in svw&&svw.form))throw o.className+": Cannnot submit without a Form object.";svw.form.goldenInsertionSubmit()}function f(a,b){return a.relativeHeading<b.relativeHeading?-1:a.relativeHeading>b.relativeHeading?1:0}function g(a){if("canvas"in svw&&svw.canvas&&"map"in svw&&svw.map){svw.tracker.push("GoldenInsertion_ReviseFalseNegative");var b,c=a.getLabelId(),d=svw.canvas.getSystemLabels(!0),e=d.length;for(b=0;e>b;b++)c==d[b].getLabelId()?(a=d[b],a.unlockVisibility().setVisibility("visible").lockVisibility()):d[b].unlockVisibility().setVisibility("hidden").lockVisibility();var f=a.getLabelPov(),g=a.getLabelType();q.currentLabel=a,"CurbRamp"===g?q.boxMessage="You did not label this <b>curb ramp</b>. Please draw an outline around it.":q.boxMessage="You did not label this <b>missing curb ramp</b>. Please draw an outline around it.",svw.messageBox.hide(),svw.map.setPov(f,p.cameraMovementDuration,function(){q.currentLabel=a,j(),"CurbRamp"===g?svw.ribbon.modeSwitch("CurbRamp"):"NoCurbRamp"===g&&svw.ribbon.modeSwitch("NoCurbRamp")});var h="rgba(0,0,255, 0.5)";a.fill(h).blink(5)}}function h(a,b){if(b&&"number"==typeof b||(b=0),"canvas"in svw&&svw.canvas&&"map"in svw&&svw.map){svw.tracker.push("GoldenInsertion_ReviseFalsePositive");var c,d=a.getLabelId(),e=svw.canvas.getUserLabels(!0),f=svw.canvas.getUserLabelCount();for(c=0;f>c;c++)if(d==e[c].getLabelId()){a=e[c];break}var g=a.getLabelPov(),h=a.getLabelType();q.currentLabel=a,"CurbRamp"===h?b>0?q.boxMessage='This label does not precisely outline the <b>curb ramp</b>. Mouse over the label and click <img src="public/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.':q.boxMessage='There does not appear to be a curb ramp to label here. Mouse over the label and click <img src="public/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.':b>0?q.boxMessage='Your label is not on a <b>missing curb ramp</b>. Mouse over the label and click <img src="public/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.':q.boxMessage='There does not appear to be any missing curb ramp to label here. Mouse over the label and click <img src="public/img/icons/Sidewalk/Icon_Delete.svg" class="MessageBoxIcons"/> to delete.',svw.messageBox.hide(),svw.map.setPov(g,p.cameraMovementDuration,function(){q.currentLabel=a,j()});var i="rgba(255, 0, 0, 0.7)";a.fill(i).blink(5)}}function i(){if("canvas"in svw&&svw.canvas&&"form"in svw&&svw.form&&"map"in svw&&svw.map&&"panorama"in svw&&svw.panorama){svw.tracker.push("GoldenInsertion_ReviewLabels");var a=svw.canvas.getLabels("user"),c=svw.canvas.getLabels("system"),i=[];d(),a=a.filter(function(a){return!a.isDeleted()&&a.isVisible()});var j=a.map(function(a){return a.labeledBy="user",a}),l=c.map(function(a){return a.labeledBy="system",a}),i=j.concat(l);i=i.map(function(a){var b=svw.panorama.getPov().heading,c=a.getLabelPov().heading,d=10;return a.relativeHeading=parseInt((c-b+360)%360),a.relativeHeading=a.relativeHeading<360-a.relativeHeading?a.relativeHeading:360-a.relativeHeading,a.relativeHeading="system"===a.labeledBy?a.relativeHeading+d:a.relativeHeading,a}),i.sort(f);var m,n,o,s,t,u=i.length;for(n=0;u>n;n++)if(!("correct"in i[n]&&i[n].correct)){t=!1;var v=0;if("user"===i[n].labeledBy){for(s=c.length,o=0;s>o;o++)if(i[n].getLabelType()===c[o].getLabelType()&&(m=i[n].overlap(c[o]),m>v&&(v=m),"CurbRamp"===i[n].getLabelType()&&m>p.curbRampThreshold||"NoCurbRamp"===i[n].getLabelType()&&m>p.noCurbRampThreshold)){i[n].correct=!0,c[o].correct=!0,t=!0;break}if(!t)return void(q.hasMistake?h(i[n],v):(k(h,{label:i[n],overlap:v}),q.hasMistake=!0))}else{for(s=a.length,o=0;s>o;o++)if(i[n].getLabelType()===a[o].getLabelType()&&(m=i[n].overlap(a[o]),"CurbRamp"===i[n].getLabelType()&&m>p.curbRampThreshold||"NoCurbRamp"===i[n].getLabelType()&&m>p.noCurbRampThreshold)){i[n].correct=!0,a[o].correct=!0,t=!0;break}if(!t)return void(q.hasMistake?g(i[n]):(k(g,{label:i[n]}),q.hasMistake=!0))}}var w="<div style='height: 10px'></div>";if(q.hasMistake)var x="Great, you corrected all the mistakes! Please try to be as accurate as possible. Your labels will be used to make our cities better and more accessible.Now, let's move on to the next task. <br/>"+w+r;else var x="Fantastic! You labeled everything correctly! Let's move on to the next task. <br />"+w+r;var y=0,z=320,A=700,B=null;return svw.messageBox.setMessage(x).setPosition(y,z,A,B,!0).show(),void b("#GoldenInsertionOkButton").bind("click",e)}}function j(){l.clear();var a=q.currentLabel.getBoundingBox(),b=a.x+a.width+50,c=a.y+a.height/2+60;svw.messageBox.setMessage(q.boxMessage).setPosition(b,c).show(),l.renderArrow(b,a.y+a.height/2+10,b-25,a.y+a.height/2,{arrowWidth:3})}function k(a,c){if(!c)return!1;if(!("label"in c&&c.label))return!1;var d="<div style='height: 10px'></div>",e='<img src="public/img/icons/Icon_WarningSign.svg" class="MessageBoxIcons" style="height:30px; width:30px; top:6px;"/> Uh oh, looks like there is a problem with your labels. Let\'s see if we can fix this. <br />'+d+r,f=0,g=320,h=720,i=null;svw.messageBox.setMessage(e).setPosition(f,g,h,i,!0).show(),b("#GoldenInsertionOkButton").bind("click",function(){svw.messageBox.hide(),"overlap"in c?a(c.label,c.overlap):a(c.label)})}var l,m,n,o={className:"GoldenInsertion"},p={cameraMovementDuration:500,curbRampThreshold:.35,goldenLabelVisibility:"hidden",noCurbRampThreshold:.1},q={boxMessage:"",currentLabel:void 0,hasMistake:!1,revisingLabels:!1},r='<button id="GoldenInsertionOkButton" class="button" style="">OK</button>';return o.disableOkButton=function(){b("#GoldenInsertionOkButton").unbind("click"),b("#GoldenInsertionOkButton").css("opacity",.7)},o.getGoldenLabelVisibility=function(){return p.goldenLabelVisibility},o.isRevisingLabels=function(){return q.revisingLabels},o.renderMessage=function(){q.currentLabel&&""!==q.boxMessage&&j()},o.reviewLabels=function(){return q.revisingLabels=!0,i()},c(a),o}function Keyboard(a){function b(){h=a("#CommentField").length>0?a("#CommentField"):null,i=a("#task-difficulty-comment").length>0?a("#task-difficulty-comment"):null,j=a("#Text_BusStopAbsenceOtherReason").length>0?a("#Text_BusStopAbsenceOtherReason"):null,h&&(h.bind("focus",g),h.bind("blur",f)),i&&(i.bind("focus",g),i.bind("blur",f)),j&&(j.bind("focus",g),j.bind("blur",f)),a(document).bind("keyup",d),a(document).bind("keydown",c),a(document).bind("mouseup",e)}function c(a){if(!l.focusOnTextField)switch("tracker"in svw&&svw.tracker.push("KeyDown",{keyCode:a.keyCode}),a.keyCode){case 16:l.shiftDown=!0}}function d(a){if(!l.focusOnTextField)switch("tracker"in svw&&svw.tracker.push("KeyUp",{keyCode:a.keyCode}),a.keyCode){case 16:l.shiftDown=!1;break;case 27:svw.canvas.cancelDrawing();break;case 67:svw.ribbon.modeSwitchClick("CurbRamp");break;case 69:svw.ribbon.modeSwitchClick("Walk");break;case 77:svw.ribbon.modeSwitchClick("NoCurbRamp");break;case 90:l.shiftDown?"zoomControl"in svw&&svw.zoomControl.zoomOut():"zoomControl"in svw&&svw.zoomControl.zoomIn()}}function e(a){var b;a=a||window.event,"which"in a?b=3==a.which:"button"in a&&(b=2==a.button),b&&k.clearShiftDown()}function f(){l.focusOnTextField=!1}function g(){l.focusOnTextField=!0}var h,i,j,k={className:"Keyboard"},l={focusOnTextField:!1,shiftDown:!1};return k.clearShiftDown=function(){return l.shiftDown=!1,this},k.getStatus=function(a){return a in l||console.warn("You have passed an invalid key for status."),l[a]},k.isShiftDown=function(){return l.shiftDown},k.setStatus=function(a,b){return a in l&&(l[a]=b),this},b(),k}function Label(a,b){function c(a,b){try{if(!b){var c='The passed "path" is empty.';throw c}g=b;for(attrName in h)if("tagHeight"!==attrName&&"tagWidth"!==attrName&&"tagX"!==attrName&&"tagY"!==attrName&&"labelerId"!==attrName&&"photographerPov"!==attrName&&"photographerHeading"!==attrName&&"photographerPitch"!==attrName||a[attrName]){if(!(attrName in a)){var c='"'+attrName+'" is not in the passed parameter.';throw c}h[attrName]=a[attrName]}return g.setBelongsTo(f),!0}catch(d){return console.error(f.className,":","Error initializing the Label object.",d),!1}}function d(a){if(3!==arguments.length)return!1;var b=g.getBoundingBox(),c=h.labelDescription,d=c.split("\n");"DefaultValue"!==h.labelerId&&d.push("Labeler: "+h.labelerId),a.font="10.5pt Calibri";for(var e=h.tagHeight*d.length,f=-1,i=0;i<d.length;i+=1){var j=a.measureText(d[i]).width+5;j>f&&(f=j)}h.tagWidth=f;var k,l;a.save(),a.lineWidth=3.5,a.fillStyle="rgba(255,255,255,1)",a.strokeStyle="rgba(255,255,255,1)",a.beginPath();var m=15;m>b.width&&(m=b.width-1),k=b.x<5?5:b.x,b.y+b.height<400?(a.moveTo(k+m,b.y+b.height),a.lineTo(k+m,b.y+b.height+10),a.stroke(),a.closePath(),a.restore(),l=b.y+b.height+10):(a.moveTo(k+m,b.y),a.lineTo(k+m,b.y-10),a.stroke(),a.closePath(),a.restore(),l=b.y-e-20);var n=16,o=30,p=10;a.save(),a.lineCap="square",a.lineWidth=2,a.fillStyle="rgba(255, 255, 255, 0.9)",a.strokeStyle="rgba(255,255,255,1)",a.beginPath(),a.moveTo(k,l),a.lineTo(k+f+n+o,l),a.lineTo(k+f+n+o,l+e+p),a.lineTo(k,l+e+p),a.lineTo(k,l),a.fill(),a.stroke(),a.closePath(),a.restore(),a.save(),a.fillStyle="#000";var q,r,s,t,u,v=h.labelType,w=getLabelIconImagePath()[v].iconImagePath;q=new Image,r=s=25,t=k+5,u=l+2,q.src=w,a.drawImage(q,t,u,r,s);for(var i=0;i<d.length;i+=1)a.fillText(d[i],k+n+20,l+20+20*i);a.restore()}function e(){if("hidden"!==i.tagVisibility){var a=g.getBoundingBox(),b=a.x+a.width-20,c=a.y,d=$("#Holder_LabelDeleteIcon");d.css({visibility:"visible",left:b,top:c})}}var f={className:"Label"},g=void 0,h={canvasWidth:void 0,canvasHeight:void 0,canvasDistortionAlphaX:void 0,canvasDistortionAlphaY:void 0,labelerId:"DefaultValue",labelId:"DefaultValue",labelType:void 0,labelDescription:void 0,labelFillStyle:void 0,panoId:void 0,panoramaLat:void 0,panoramaLng:void 0,panoramaHeading:void 0,panoramaPitch:void 0,panoramaZoom:void 0,photographerHeading:void 0,photographerPitch:void 0,svImageWidth:void 0,svImageHeight:void 0,svMode:void 0,tagHeight:20,tagWidth:1,tagX:-1,tagY:-1},i={deleted:!1,tagVisibility:"visible",visibility:"visible"},j={tagVisibility:!1,visibility:!1};return f.blink=function(a,b){a?0>a&&(a=0):a=3;var c,d,e=!0,g=f.getPath(),h=g.getPoints(),i=h.length,j="rgba(200,200,200,0.1)",k=g.getFillStyle();return c=setInterval(function(){if(a>0)if(e){for(e=!1,g.setFillStyle(j),d=0;i>d;d++)h[d].setFillStyle(j);svw.canvas.clear().render2()}else{for(e=!0,g.setFillStyle(k),d=0;i>d;d++)h[d].setFillStyle(k);svw.canvas.clear().render2(),a-=1}else{if(b){for(g.setFillStyle(j),d=0;i>d;d++)h[d].setFillStyle(j);svw.canvas.clear().render2()}f.setAlpha(.05),svw.canvas.clear().render2(),window.clearInterval(c)}},500),this},f.fadeFillStyle=function(a){var b=f.getPath(),c=b.getPoints(),d=0,e=c.length,g=void 0;for(a||(a="default"),g="gray"===a?"rgba(200,200,200,0.5)":"rgba(255,165,0,0.8)",b.setFillStyle(g);e>d;d++)c[d].setFillStyle(g);return this},f.getBoundingBox=function(a){var b=f.getPath();return b.getBoundingBox(a)},f.getCoordinate=function(){if(g&&g.points.length>0){var a=g.getPOV();return $.extend(!0,{},g.points[0].getCanvasCoordinate(a))}return g},f.getGSVImageCoordinate=function(){return g&&g.points.length>0?g.points[0].getGSVImageCoordinate():void 0},f.getImageCoordinates=function(){return g?g.getImageCoordinates():!1},f.getLabelId=function(){return h.labelId},f.getLabelType=function(){return h.labelType},f.getPath=function(a){return g?a?g:$.extend(!0,{},g):!1},f.getPoint=function(){return g&&g.points.length>0?g.points[0]:g},f.getPoints=function(a){return g?g.getPoints(a):!1},f.getLabelPov=function(){var a,b=parseInt(h.panoramaPitch,10),c=parseInt(h.panoramaZoom,10),d=f.getPoints(),e=d.map(function(a){return a.svImageCoordinate.x});if(e.max()-e.min()>svw.svImageWidth/2){e=e.map(function(a){return a<svw.svImageWidth/2&&(a+=svw.svImageWidth),a});var g=parseInt(e.mean(),10)%svw.svImageWidth}else var g=parseInt(e.mean(),10);return a=parseInt(g/svw.svImageWidth*360,10)%360,{heading:parseInt(a,10),pitch:b,zoom:c}},f.getProperties=function(){return $.extend(!0,{},h)},f.getProperty=function(a){return a in h?h[a]:!1},f.getstatus=function(a){return i[a]},f.getVisibility=function(){return i.visibility},f.fill=function(a){var b=f.getPath(),c=b.getPoints(),d=0,e=c.length;for(b.setFillStyle(a);e>d;d++)c[d].setFillStyle(a);return this},f.highlight=function(){var a="rgba(255,165,0,0.8)";return f.fill(a)},f.isDeleted=function(){return i.deleted},f.isOn=function(a,b){if(i.deleted||"hidden"===i.visibility)return!1;var c=g.isOn(a,b);return c?c:!1},f.isVisible=function(){return"visible"===i.visibility?!0:!1},f.lockTagVisibility=function(){return j.tagVisibility=!0,this},f.lockVisibility=function(){return j.visibility=!0,this},f.overlap=function(a,b){if(b||(b="boundingbox"),"boundingbox"!==b)throw f.className+": "+mobede+" is not a valid option.";var c=f.getPath(),d=a.getPath();return c.overlap(d,b)},f.removePath=function(){g.removePoints(),g=void 0},f.render=function(a,b,c){if(c||(c=!1),!i.deleted&&"visible"===i.visibility){if("visible"===i.tagVisibility){h.labelDescription;c||(d(a),g.renderBoundingBox(a),e())}g.render2(a,b)}return this},f.resetFillStyle=function(){var a=f.getPath(),b=a.getPoints(),c=0,d=b.length;for(a.resetFillStyle();d>c;c++)b[c].resetFillStyle();return this},f.resetTagCoordinate=function(){return h.tagX=0,h.tagY=0,this},f.setAlpha=function(a){var b=f.getPath(),c=b.getPoints(),d=0,e=c.length,g=b.getFillStyle();for(g=svw.util.color.changeAlphaRGBA(g,.3),b.setFillStyle(g);e>d;d++)c[d].setFillStyle(g);return this},f.setIconPath=function(a){if(g&&g.points[0]){var b=g.points[0];return b.setIconPath(a),this}return!1},f.setLabelerId=function(a){return h.labelerId=a,this},f.setStatus=function(a,b){a in i&&("visibility"!==a||"visible"!==b&&"hidden"!==b?"tagVisibility"!==a||"visible"!==b&&"hidden"!==b?"deleted"===a&&"boolean"==typeof b&&(i[a]=b):f.setTagVisibility(b):f.setVisibility(b))},f.setTagVisibility=function(a){return j.tagVisibility||("visible"===a||"hidden"===a)&&(i.tagVisibility=a),this},f.setSubLabelDescription=function(a){var b=getLabelDescriptions(),c=b[a].text;return h.labelProperties.subLabelDescription=c,this},f.setVisibility=function(a){return j.visibility||(i.visibility=a),this},f.setVisibilityBasedOnLocation=function(a,b){return i.deleted||(b===h.panoId?f.setVisibility(a):(a="visible"===a?"hidden":"visible",f.setVisibility(a))),this},f.setVisibilityBasedOnLabelerId=function(a,b,c){return void 0===c?-1!==b.indexOf(h.labelerId)?f.unlockVisibility().setVisibility(a).lockVisibility():(a="visible"===a?"hidden":"visible",f.unlockVisibility().setVisibility(a).lockVisibility()):c?-1!==b.indexOf(h.labelerId)&&f.unlockVisibility().setVisibility(a).lockVisibility():-1===b.indexOf(h.labelerId)&&f.unlockVisibility().setVisibility(a).lockVisibility(),this},f.setVisibilityBasedOnLabelerIdAndLabelTypes=function(a,b,c){var d,e=b.length,g=!1;for(d=0;e>d;d+=1)-1!==b[d].userIds.indexOf(h.labelerId)&&-1!==b[d].labelTypesToRender.indexOf(h.labelProperties.labelType)&&(g=!0);void 0===c?g?f.unlockVisibility().setVisibility(a).lockVisibility():(a="visible"===a?"hidden":"visible",f.unlockVisibility().setVisibility(a).lockVisibility()):c?g&&f.unlockVisibility().setVisibility(a).lockVisibility():g||f.unlockVisibility().setVisibility(a).lockVisibility()},f.unlockTagVisibility=function(){return j.tagVisibility=!1,this},f.unlockVisibility=function(){return j.visibility=!1,this},f.runTestCases=function(){module("Label tests"),test("functioning",function(){ok(!0,"Test")})},c(b,a)?f:!1}function LabeledLandmarkFeedback(a,b){function c(a){svw.ui&&svw.ui.ribbonMenu&&(d=svw.ui.labeledLandmark.curbRamp,e=svw.ui.labeledLandmark.noCurbRamp,f=svw.ui.labeledLandmark.submitted,d.html(0),e.html(0))}var d,e,f,g={className:"LabeledLandmarkFeedback"};return g.setLabelCount=function(a){return svw.ui&&svw.ui.ribbonMenu&&(d.html(a.CurbRamp),e.html(a.NoCurbRamp)),this},g.setSubmittedLabelMessage=function(a){if(!a)return this;if(svw.ui&&svw.ui.ribbonMenu)if("message"in a)f.html(b);else if("numCurbRampLabels"in a&&"numMissingCurbRampLabels"in a){var b="You've submitted <b>"+a.numCurbRampLabels+"</b> curb ramp labels and <br /><b>"+a.numMissingCurbRampLabels+"</b> missing curb ramp labels.";f.html(b)}return this},c(b),g}function Main(a,b){function c(b){b=b||{},svw.ui=new UI(a),svw.tracker=new Tracker,svw.keyboard=new Keyboard(a),svw.canvas=new Canvas(a),svw.form=new Form(a,b.form),svw.examples=void 0,svw.overlayMessageBox=new OverlayMessageBox(a),svw.missionDescription=new MissionDescription(a,b.missionDescription),svw.labeledLandmarkFeedback=new LabeledLandmarkFeedback(a),svw.qualificationBadges=void 0,svw.progressFeedback=new ProgressFeedback(a),svw.actionStack=new ActionStack(a),svw.ribbon=new RibbonMenu(a),svw.messageBox=new MessageBox(a),svw.zoomControl=new ZoomControl(a),svw.tooltip=void 0,svw.onboarding=void 0,svw.progressPov=new ProgressPov(a),svw.form.disableSubmit(),svw.tracker.push("TaskStart");var c={};c.canvas=svw.canvas,c.overlayMessageBox=svw.overlayMessageBox;var d,e,f,g="_AUz5cV_ofocoDbesxY3Kw",h=[],i=-1,j=-1,k=-1,l=!1;i=1,j=1,k=i-j,f=k/i,svw.form.setTaskRemaining(j),svw.form.setTaskDescription("TestTask"),svw.form.setTaskPanoramaId(g),d=parseFloat(38.894799),e=parseFloat(-77.021906),f=parseFloat(f),c.Lat=d,c.Lng=e,c.panoramaPov={heading:0,pitch:-10,zoom:1},c.taskPanoId=g,h=[c.taskPanoId],c.availablePanoIds=h,svw.missionDescription.setCurrentStatusDescription('Your mission is to <span class="bold">find and label</span> presence and absence of curb ramps at intersections.'),svw.progressFeedback.setProgress(f),svw.progressFeedback.setMessage("You have finished "+(i-j)+" out of "+i+"."),l?(svw.messageBox.setPosition(10,120,width=400,height=void 0,background=!0),svw.messageBox.setMessage("<span class='bold'>Remember, label all the landmarks close to the bus stop.</span> Now the actual task begins. Click OK to start the task."),svw.messageBox.appendOKButton(),svw.messageBox.show()):svw.messageBox.hide(),svw.map=new Map(c),svw.map.setStatus("hideNonavailablePanoLinks",!0)}var d={moduleName:"MainUI"};return c(b),d}function getPanoId(){if(svw.panorama){var a=svw.panorama.getPano();return a}throw"getPanoId() (in Map.js): panorama not defined."}function getPosition(){if(!svw.panorama)throw"getPosition() (in Map.js): panorama not defined.";var a=svw.panorama.getPosition();if(a){var b={lat:a.lat(),lng:a.lng()};return b}}function getPOV(){if(svw.panorama){for(var a=svw.panorama.getPov();a.heading<0;)a.heading+=360;for(;a.heading>360;)a.heading-=360;return a}throw"getPOV() (in Map.js): panoarama not defined."}function getLinks(){if(svw.panorama){var a=svw.panorama.getLinks();return a}throw"getLinks() (in Map.js): panorama not defined."}function Map(a){function b(a){if(I.properties=N,N.browser=getBrowser(),v=a.overlayMessageBox,!a.taskPanoId)throw a.Lat&&a.Lng?(x=new google.maps.LatLng(a.Lat,a.Lng),w={mode:"html4",position:x,pov:N.panoramaPov},I.className+" init(): Specifying a dropping point with a latlng coordinate is no longer a good idea. It does not drop the pegman on the specified position."):I.className+" init(): The pano id nor panorama position is give. Cannot initialize the panorama.";w={mode:"html4",pov:N.panoramaPov,pano:a.taskPanoId};var b=document.getElementById("pano");svw.panorama=new google.maps.StreetViewPanorama(b,w),svw.panorama.set("addressControl",!1),svw.panorama.set("clickToGo",!1),svw.panorama.set("disableDefaultUI",!0),svw.panorama.set("linksControl",!0),svw.panorama.set("navigationControl",!1),svw.panorama.set("panControl",!1),svw.panorama.set("zoomControl",!1),N.initialPanoId=a.taskPanoId,B=svw.ui.map.canvas,C=svw.ui.map.drawingLayer,D=svw.ui.map.pano,E=svw.ui.map.streetViewHolder,F=svw.ui.map.viewControlLayer,G=svw.ui.map.modeSwitchWalk,H=svw.ui.map.modeSwitchDraw,O.availablePanoIds=a.availablePanoIds,F.bind("mousedown",q),F.bind("mouseup",r),F.bind("mousemove",s),F.bind("mouseleave",t),google.maps.event.addListener(svw.panorama,"pov_changed",l),google.maps.event.addListener(svw.panorama,"position_changed",l),google.maps.event.addListener(svw.panorama,"pano_changed",o),y.setStreetView(svw.panorama),google.maps.event.addListenerOnce(svw.panorama,"pano_changed",I.modeSwitchWalkClick),S=setInterval(k,100),"onboarding"in svw&&svw.onboarding&&"Onboarding_LabelingCurbRampsDifficultScene"===svw.onboarding.className&&(Q.zoomViewAngles=[Math.PI/2,Math.PI/4,Math.PI/8]),Q.interval=setInterval(j,250),K=setInterval(c,.2),N.isInternetExplore=$.browser.msie,N.isInternetExplore&&F.append('<canvas width="720px" height="480px"  class="Window_StreetView" style=""></canvas>')}function c(){var a=$(".gmnoprint");a.length>0&&(window.clearInterval(K),$.each($(".gmnoprint"),function(a,b){var c=$(b).find("img");c&&c.css("visibility","hidden")}))}function d(){O.lockDisableWalking||(h(),G.css("opacity",.5),O.disableWalking=!0)}function e(){O.lockDisableWalking||(n(),G.css("opacity",1),O.disableWalking=!1)}function f(){var a=svw.getPOV();if(a){var b=a.heading,c=b*(Math.PI/180);svw.fog.updateFromPOV(current,radius,c,Math.PI/2)}}function g(){return D.find("svg").parent()}function h(){"chrome"===N.browser?$("path").css("visibility","hidden"):$("path").css("visibility","hidden")}function i(){var a=g();F.append(a),"mozilla"===N.browser?F.append(B):"msie"===N.browser&&F.insertBefore(C)}function j(){current&&(Q.center=current,Q.radius=200,current=svw.panorama.getPosition(),svw.fog=new Fog(y,Q),fogSet=!0,window.clearInterval(Q.interval),f())}function k(){var a=F.find("path").length;0!==a&&(O.svLinkArrowsLoaded=!0,window.clearTimeout(S)),O.svLinkArrowsLoaded||h()}function l(){if(svw.canvas){getPosition(),svw.getPOV().heading;svw.canvas.clear(),O.currentPanoId!==svw.getPanoId()&&svw.canvas.setVisibilityBasedOnLocation("visible",svw.getPanoId()),O.currentPanoId=svw.getPanoId(),"Evaluation"===N.mode&&myTables.updateCanvas(),svw.canvas.render2()}fogMode&&"fog"in svw&&(current=svw.panorama.getPosition(),current&&fogSet&&f()),$("svg")[0]&&(R||(R=!0,$("svg")[0].addEventListener("mousedown",function(a){n()})))}function m(a){switch(a){case"ZoomOut":F.css("cursor","url(img/cursors/Cursor_ZoomOut.png) 4 4, move");break;case"OpenHand":F.css("cursor","url(img/cursors/openhand.cur) 4 4, move");break;case"ClosedHand":F.css("cursor","url(img/cursors/closedhand.cur) 4 4, move");break;default:F.css("cursor","default")}}function n(a){if(!O.svLinkArrowsLoaded){var b=F.find("path").length;0===b?i():O.svLinkArrowsLoaded=!0}O.hideNonavailablePanoLinks&&O.availablePanoIds?$.each($("path"),function(a,b){if($(b).attr("pano")){var c=$(b).attr("pano"),d=O.availablePanoIds.indexOf(c);-1===d?($(b).prev().prev().remove(),$(b).prev().remove(),$(b).remove()):($(b).prev().prev().css("visibility","visible"),$(b).prev().css("visibility","visible"),$(b).css("visibility","visible"))}}):"chrome"===N.browser?$("path").css("visibility","visible"):(a||(a=0),$("path").css("visibility","hidden"))}function o(){if(!svw.panorama)throw I.className+" updateMap(): panorama not defined.";var a=svw.panorama.getPosition();y.setCenter(a),svw.canvas&&(svw.canvas.clear(),svw.canvas.setVisibilityBasedOnLocation("visible",svw.getPanoId()),"Evaluation"===N.mode&&myTables.updateCanvas(),svw.canvas.render2()),fogSet&&f()}function p(a,b){if(!svw.panorama)throw J+" updatePov(): panorama not defined!";var c=svw.panorama.getPov(),d=.25;c.heading-=d*a,c.pitch+=d*b,c.pitch>N.maxPitch?c.pitch=N.maxPitch:c.pitch<N.minPitch&&(c.pitch=N.minPitch),N.minHeading&&N.maxHeading&&(N.minHeading<=N.maxHeading?c.heading>N.maxHeading?c.heading=N.maxHeading:c.heading<N.minHeading&&(c.heading=N.minHeading):c.heading<N.minHeading&&c.heading>N.maxHeading&&(Math.abs(c.heading-N.maxHeading)<Math.abs(c.heading-N.minHeading)?c.heading=N.maxHeading:c.heading=N.minHeading)),N.panoramaPov=c,svw.panorama.setPov(c)}function q(a){if(P.isLeftDown=!0,P.leftDownX=mouseposition(a,this).x,P.leftDownY=mouseposition(a,this).y,!O.disableWalking)try{m(svw.keyboard.isShiftDown()?"ZoomOut":"ClosedHand")}catch(a){console.error(a)}if(!O.panoLinkListenerSet)try{$("svg")[0].addEventListener("click",function(a){var b=a.target.getAttribute("pano");b&&svw.tracker.push("WalkTowards",{TargetPanoId:b})}),O.panoLinkListenerSet=!0}catch(b){}svw.tracker.push("ViewControl_MouseDown",{x:P.leftDownX,y:P.leftDownY})}function r(a){var b;if(P.isLeftDown=!1,P.leftUpX=mouseposition(a,this).x,
P.leftUpY=mouseposition(a,this).y,svw.tracker.push("ViewControl_MouseUp",{x:P.leftUpX,y:P.leftUpY}),!O.disableWalking)try{m(svw.keyboard.isShiftDown()?"ZoomOut":"OpenHand")}catch(a){console.error(a)}b=(new Date).getTime(),b-P.prevMouseUpTime<300&&(svw.tracker.push("ViewControl_DoubleClick"),svw.keyboard.isShiftDown()?(svw.zoomControl.zoomOut(),svw.tracker.push("ViewControl_ZoomOut")):(svw.zoomControl.pointZoomIn(P.leftUpX,P.leftUpY),svw.tracker.push("ViewControl_ZoomIn"))),P.prevMouseUpTime=b}function s(a){if(P.currX=mouseposition(a,this).x,P.currY=mouseposition(a,this).y,O.disableWalking)m("default");else if(n(2e3),!P.isLeftDown)try{m(svw.keyboard.isShiftDown()?"ZoomOut":"OpenHand")}catch(a){console.error(a)}if(P.isLeftDown&&O.disableWalking===!1){var b=P.currX-P.prevX,c=P.currY-P.prevY,d=svw.getPOV(),e=d.zoom,f=svw.zoomFactor[e];b/=2*f,c/=2*f,b*=1.5,c*=1.5,p(b,c)}if("canvas"in svw&&svw.canvas){var g=svw.canvas.isOn(P.currX,P.currY);if(g&&"Point"===g.className){var h=g.belongsTo(),i=h.belongsTo();svw.canvas.setCurrentLabel(i),svw.canvas.showLabelTag(i),svw.canvas.clear(),svw.canvas.render2()}else if(g&&"Label"===g.className){var i=g;svw.canvas.setCurrentLabel(i),svw.canvas.showLabelTag(i)}else if(g&&"Path"===g.className){var j=g.belongsTo();svw.canvas.clear(),svw.canvas.render2(),svw.canvas.showLabelTag(j)}else svw.canvas.showLabelTag(void 0),svw.canvas.setCurrentLabel(void 0)}P.prevX=mouseposition(a,this).x,P.prevY=mouseposition(a,this).y}function t(a){P.isLeftDown=!1}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I={className:"Map"},J="Map",K=void 0,L={renderLabels:!1},M=[],N={browser:"unknown",latlng:{lat:void 0,lng:void 0},initialPanoId:void 0,panoramaPov:{heading:359,pitch:-10,zoom:1},maxPitch:0,minPitch:-35,minHeading:void 0,maxHeading:void 0,mode:"Labeling",isInternetExplore:void 0},O={availablePanoIds:void 0,currentPanoId:void 0,disableWalking:!1,hideNonavailablePanoLinks:!1,lockDisableWalking:!1,panoLinkListenerSet:!1,svLinkArrowsLoaded:!1},P={currX:0,currY:0,prevX:0,prevY:0,leftDownX:0,leftDownY:0,leftUpX:0,leftUpY:0,isLeftDown:!1},Q={interval:void 0,ready:void 0},R=!1,S=void 0;if(a.panoramaPov?N.panoramaPov=a.panoramaPov:N.panoramaPov={heading:0,pitch:0,zoom:1},a.latlng)N.latlng=a.latlng;else{if(!("Lat"in a&&"Lng"in a))throw I.className+": latlng not defined.";N.latlng={lat:a.Lat,lng:a.Lng}}x=new google.maps.LatLng(N.latlng.lat,N.latlng.lng),z={center:x,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,maxZoom:20,minZoom:14,overviewMapControl:!1,panControl:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!0,zoomControl:!1,zoom:18};var T=document.getElementById("google-maps");return y=new google.maps.Map(T,z),A=[{featureType:"all",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"on"}]},{elementType:"labels",stylers:[{visibility:"off"}]}],y.setOptions({styles:A}),I.disableWalking=function(){return O.lockDisableWalking?!1:(d(),this)},I.enableWalking=function(){return O.lockDisableWalking?!1:(e(),this)},I.getInitialPanoId=function(){return N.initialPanoId},I.getMaxPitch=function(){return N.maxPitch},I.getMinPitch=function(){return N.minPitch},I.getProperty=function(a){return a in N?N[a]:!1},I.hideLinks=function(){return h(),this},I.lockDisableWalking=function(){return O.lockDisableWalking=!0,this},I.lockRenderLabels=function(){return L.renderLabels=!0,this},I.modeSwitchWalkClick=function(){F.css("z-index","1"),C.css("z-index","0"),O.disableWalking||(n(),i())},I.modeSwitchLabelClick=function(){C.css("z-index","1"),F.css("z-index","0"),"mozilla"===N.browser&&C.append(B),h()},I.plotMarkers=function(){if(u){var a=void 0,b=0,c=void 0,d=void 0,e=void 0;a=u.getLabels(),b=a.length;for(var f=0;f<M.length;f+=1)M[f].setMap(null);for(M=[],f=0;b>f;f++)if(c=a[f].getProperties(),d=c.labelProperties.labelType,e=c.panoramaProperties.latlng,-1===c.labelerId.indexOf("Researcher")){var g=new google.maps.LatLng(e.lat,e.lng),h=new google.maps.Marker({position:g,map:y,zIndex:f});M.push(h)}}return!1},I.setHeadingRange=function(a){return N.minHeading=a[0],N.maxHeading=a[1],this},I.setMode=function(a){return N.mode=a,this},I.setPitchRange=function(a){return N.minPitch=a[0],N.maxPitch=a[1],this},I.setPov=function(a,b,c){if("panorama"in svw&&svw.panorama){var d,e=svw.panorama.getPov();if(a.heading=parseInt(a.heading,10),a.pitch=parseInt(a.pitch,10),a.zoom=parseInt(a.zoom,10),a.pitch>N.maxPitch?a.pitch=N.maxPitch:a.pitch<N.minPitch&&(a.pitch=N.minPitch),N.minHeading&&N.maxHeading&&(N.minHeading<=N.maxHeading?a.heading>N.maxHeading?a.heading=N.maxHeading:a.heading<N.minHeading&&(a.heading=N.minHeading):a.heading<N.minHeading&&a.heading>N.maxHeading&&(Math.abs(a.heading-N.maxHeading)<Math.abs(a.heading-N.minHeading)?a.heading=N.maxHeading:a.heading=N.minHeading)),b){var f,g=25,h=(a.heading-e.heading+360)%360,i=360-h;f=i>h?h*(g/b):-i*(g/b);var j,k=a.pitch-e.pitch;j=k*(g/b),d=window.setInterval(function(){var b=a.heading-e.heading;Math.abs(b)>1?(e.heading+=f,e.pitch+=j,e.heading=(e.heading+360)%360,e.pitch=e.pitch,svw.panorama.setPov(e)):(a.zoom||(a.zoom=1),svw.panorama.setZoom(a.zoom),window.clearInterval(d),c&&c())},g)}else svw.panorama.setPov(a)}return this},I.setStatus=function(a,b){if(a in O){if("disableWalking"===a){if("boolean"!=typeof b)return!1;b?d():e()}else O[a]=b;return this}return!1},I.unlockDisableWalking=function(){return O.lockDisableWalking=!1,this},I.unlockRenderLabels=function(){return L.renderLabels=!1,this},I.test=function(){u.testCases.renderLabels()},b(a),I}function MessageBox(a,b){function c(){d=a("#Holder_Message"),e=a("#MessageBox")}var d,e,f={className:"MessageBox"},g='<button id="MessageBoxOkButton" class="button" style="position: absolute; bottom: 10px; left: 10px;">OK</button>';return f.setMessage=function(a){return e.html(a),this},f.setPosition=function(a,b,c,f,g){return a&&"number"==typeof a&&(a+="px"),b&&"number"==typeof b&&(b+="px"),c?"number"==typeof c&&(c+="px"):c="240px",f&&"number"==typeof f&&(f+="px"),g||(g=!1),g?(d.css({height:"100%",left:"0px",top:"0px",visibility:"visible",width:"100%",zIndex:1e3}),e.css({left:a,top:b,width:c,zIndex:1e3}),f&&e.css("height",f)):(d.css({height:"1px",left:a,top:b,width:"1px",zIndex:1e3}),e.css({left:"0px",top:"0px",width:c}),f&&e.css("height",f)),this},f.appendOKButton=function(b){e.css("padding-bottom","50px"),e.append(g),a("#MessageBoxOkButton").on("click",function(){"tracker"in svw&&svw.tracker&&(b?svw.tracker.push("MessageBox_ClickOk",{message:b}):svw.tracker.push("MessageBox_ClickOk")),d.css({visibility:"hidden"}),e.css({"padding-bottom":"",visibility:"hidden"}),a("#MessageBoxOkButton").remove()})},f.hide=function(){return e.css("visibility","hidden"),d.css("visibility","hidden"),this},f.show=function(a){return a||(a=!1),e.css("visibility","visible"),a&&d.css("visibility","visible"),this},c(),f}function MissionDescription(a,b){function c(a){svw.ui&&svw.ui.missinDescription&&(d=svw.ui.missinDescription.description,d.html(a.description))}var d,e={className:"MissionDescription"};return e.setCurrentStatusDescription=function(a){return svw.ui&&svw.ui.missinDescription&&d.html(a),this},c(b),e}function OverlayMessageBox(a,b){function c(){svw.ui&&svw.ui.overlayMessage&&(d=svw.ui.overlayMessage.message,e=svw.ui.overlayMessage.box,f.setMessage("Walk"))}var d,e,f={className:"OverlayMessageBox"},g={visibility:"visible"};return f.setMessage=function(a,b){var c=svw.misc.getLabelInstructions(),f=svw.misc.getLabelColors();if(a in c&&a in f){var g=f[a],h=changeAlphaRGBA(g.fillStyle,.85);return h=changeDarknessRGBA(h,.35),e.css({background:h}),d.css({color:c[a].textColor}),b?d.html(b):d.html("<strong>"+c[a].instructionalText+"</strong>"),this}return!1},f.setVisibility=function(a){return("visible"===a||"hidden"===a)&&(g.visibility=a),this},c(),f}function Path(a,b){function c(a,b){var c,d;for(m.points=a,c=a.length,d=0;c>d;d+=1)a[d].setBelongsTo(m);if(b)for(var e in b)e in n&&(n[e]=b[e]);n.fillStyle=changeAlphaRGBA(a[0].getProperty("fillStyleInnerCircle"),.5),n.originalFillStyle=n.fillStyle,n.originalStrokeStyle=n.strokeStyle}function d(){return n.lineWidth}function e(){return n.fillStyle}function f(a){n.fillStyle=a}function g(a){var b,c,d,e=a?a:getPOV(),f=-1,g=1e6,h=-1,j=1e6;for(d=i(e),c=d.length,b=0;c>b;b+=1){var k=d[b];k.x<g&&(g=k.x),k.x>f&&(f=k.x),k.y<j&&(j=k.y),k.y>h&&(h=k.y)}return{x:g,y:j,width:f-g,height:h-j}}function h(){var a,b,c=j(),d=c.length,e=-1,f=1e6,g=-1e6,h=1e6,i=!1;for(a=0;d>a;a++)b=c[a],b.x<f&&(f=b.x),b.x>e&&(e=b.x),b.y<h&&(h=b.y),b.y>g&&(g=b.y);if(e-f>5e3)for(i=!0,e=-1,f=1e6,a=0;d>a;a++)b=c[a],b.x>6e3?b.x<f&&(f=b.x):b.x>e&&(e=b.x);return i?{x:f,y:h,width:svw.svImageWidth-f+e,height:g-h,boundary:!0}:{x:f,y:h,width:e-f,height:g-h,boundary:!1}}function i(a){var b,c,d=j(),e=d.length,f=[],g=1e7,h=-1;for(b=0;e>b;b+=1)g>d[b].x&&(g=d[b].x),h<d[b].x&&(h=d[b].x);var i=3328;for(b=0;e>b;b+=1)a.heading<180?h>svw.svImageWidth-i&&d[b].x>i&&(d[b].x-=svw.svImageWidth):i>g&&d[b].x<svw.svImageWidth-i&&(d[b].x+=svw.svImageWidth),c=svw.gsvImageCoordinate2CanvasCoordinate(d[b].x,d[b].y,a),f.push(c);return f}function j(){var a,b=m.points.length,c=[];for(a=0;b>a;a+=1)c.push(m.points[a].getGSVImageCoordinate());return c}function k(a){var b=g();a.save(),a.lineWidth=2,a.strokeStyle="rgba(255,255,255,1)",a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(b.x+b.width,b.y),a.lineTo(b.x+b.width,b.y+b.height),a.lineTo(b.x,b.y+b.height),a.lineTo(b.x,b.y),a.stroke(),a.closePath(),a.restore()}var l,m={className:"Path",points:void 0},n={fillStyle:"rgba(255,255,255,0.5)",lineCap:"round",lineJoin:"round",lineWidth:"3",numPoints:a.length,originalFillStyle:void 0,originalStrokeStyle:void 0,strokeStyle:"rgba(255,255,255,1)",strokeStyle_bg:"rgba(255,255,255,1)"},o={visibility:"visible"};return m.belongsTo=function(){return l?l:!1},m.getPOV=function(){return a[0].getPOV()},m.getBoundingBox=function(a){return g(a)},m.getLineWidth=function(){return d()},m.getFill=function(){return e()},m.getFillStyle=function(){return n.fillStyle},m.getSvImageBoundingBox=function(){return h()},m.getImageCoordinates=function(){return j()},m.getPoints=function(a){return a||(a=!1),a?m.points:$.extend(!0,[],m.points)},m.isOn=function(a,b){var c,d,e,f,h;for(f=m.points.length,d=0;f>d;d+=1)if(e=m.points[d],h=e.isOn(a,b))return h;return c=g(),c.x<a&&c.x+c.width>a&&c.y<b&&c.y+c.height>b?this:!1},m.overlap=function(a,b){b||(b="boundingbox");var c=0;if("boundingbox"===b){var d,e,f=h(),g=a.getSvImageBoundingBox();f.boundary&&g.boundary||(f.boundary?(f.x=f.x-svw.svImageWidth,g.x>6e3&&(g.x=g.x-svw.svImageWidth)):g.boundary&&(g.x=g.x-svw.svImageWidth,f.x>6e3&&(f.x=f.x-svw.svImageWidth))),d=f.x<g.x?f.x:g.x,e=f.y<g.y?f.y:g.y,f.x-=d,g.x-=d,f.y-=e,g.y-=e;var i=f.x,j=f.x+f.width,k=f.y,l=f.y+f.height,m=g.x,n=g.x+g.width,o=g.y,p=g.y+g.height,q=0,r=0,s=n>j?n:j,t=p>l?p:l,u=0,v=0,w=!1,x=!1;for(q=0;s>q;q++)for(r=0;t>r;r++)w=q>i&&j>q&&r>k&&l>r,x=q>m&&n>q&&r>o&&p>r,w&&x&&(v+=1),(w||x)&&(u+=1);c=v/u}return c},m.removePoints=function(){m.points=void 0},m.render2=function(a,b){return m.render(b,a)},m.render=function(a,b){if("visible"===o.visibility){var c,d,e;c=m.points.length;var f=i(a);for(d=m.points[0],b.save(),b.beginPath(),n.fillStyle?b.fillStyle=n.fillStyle:(n.fillStyle=changeAlphaRGBA(d.getProperty("fillStyleInnerCircle"),.5),n.originalFillStyle=n.fillStyle,b.fillStyle=n.fillStyle),b.moveTo(f[0].x,f[0].y),e=1;c>e;e+=1)b.lineTo(f[e].x,f[e].y);for(b.lineTo(f[0].x,f[0].y),b.fill(),b.closePath(),b.restore(),e=0;c>e;e+=1)d=m.points[e],d.render(a,b);for(e=0;c>e;e+=1){if(e>0)var g=f[e],h=f[e-1];else var g=f[e],h=f[c-1];var j=d.getProperty("radiusInnerCircle");b.save(),b.strokeStyle=n.strokeStyle,svw.util.shape.lineWithRoundHead(b,h.x,h.y,j,g.x,g.y,j),b.restore()}}},m.renderBoundingBox=function(a){k(a)},m.resetFillStyle=function(){return n.fillStyle=n.originalFillStyle,this},m.resetStrokeStyle=function(){return n.strokeStyle=n.originalStrokeStyle,this},m.setFill=function(a){return f("rgba"==a.substring(0,4)?a:"rgba"+a.substring(3,a.length-1)+",0.5)"),this},m.setBelongsTo=function(a){return l=a,this},m.setLineWidth=function(a){return isNaN(a)||(n.lineWidth=""+a),this},m.setFillStyle=function(a){return void 0!=a&&(n.fillStyle=a),this},m.setStrokeStyle=function(a){return n.strokeStyle=a,this},m.setVisibility=function(a){return("visible"===a||"hidden"===a)&&(o.visibility=a),this},c(a,b),m}function Point(a,b,c,d){"use strict";function e(a,b,c,d){var e=c.zoom,f=svw.zoomFactor[e],g=svw.svImageHeight,h=svw.svImageWidth;k.svImageCoordinate={},k.svImageCoordinate.x=h*c.heading/360+svw.alpha_x*(a-svw.canvasWidth/2)/f,k.svImageCoordinate.y=g/2*c.pitch/90+svw.alpha_y*(b-svw.canvasHeight/2)/f,k.svImageCoordinate.x<0&&(k.svImageCoordinate.x=k.svImageCoordinate.x+h),k.canvasCoordinate={x:a,y:b},k.originalCanvasCoordinate={x:a,y:b},k.pov={heading:c.heading,pitch:c.pitch,zoom:c.zoom},k.originalPov={heading:c.heading,pitch:c.pitch,zoom:c.zoom};for(var i in m){if("iconImagePath"===i){if(!d.iconImagePath)continue;m.iconImagePath=d.iconImagePath}i in d?m[i]=d[i]:-1===n.indexOf(i)}return m.originalFillStyleInnerCircle=m.fillStyleInnerCircle,m.originalStrokeStyleOuterCircle=m.strokeStyleOuterCircle,!0}function f(){return!0}function g(){return k.canvasCoordinate.x}function h(){return k.canvasCoordinate.y}function i(){return m.fillStyleInnerCircle}function j(){return c}void 0==d.fillStyle&&(d.fillStyle="rgba(255,255,255,0.5)");var k={className:"Point",svImageCoordinate:void 0,canvasCoordinate:void 0,originalCanvasCoordinate:void 0,pov:void 0,originalPov:void 0},l=void 0,m={fillStyleInnerCircle:d.fillStyle,lineWidthOuterCircle:2,iconImagePath:void 0,originalFillStyleInnerCircle:void 0,originalStrokeStyleOuterCircle:void 0,radiusInnerCircle:4,radiusOuterCircle:5,strokeStyleOuterCircle:"rgba(255,255,255,1)",storedInDatabase:!1},n=["originalFillStyleInnerCircle","originalStrokeStyleOuterCircle"],o={deleted:!1,visibility:"visible",visibilityIcon:"visible"};k.belongsTo=function(){return l?l:!1},k.getPOV=function(){return j()},k.getCanvasCoordinate=function(a){return k.canvasCoordinate=svw.gsvImageCoordinate2CanvasCoordinate(k.svImageCoordinate.x,k.svImageCoordinate.y,a),svw.gsvImageCoordinate2CanvasCoordinate(k.svImageCoordinate.x,k.svImageCoordinate.y,a)},k.getCanvasX=g,k.getCanvasY=h,k.getFill=i,k.getFillStyle=function(){return i()},k.getGSVImageCoordinate=function(){return $.extend(!0,{},k.svImageCoordinate)},k.getProperty=function(a){if(!(a in m))throw k.className+' : A property name "'+a+'" does not exist in properties.';return m[a]},k.getProperties=function(){return $.extend(!0,{},m)},k.isOn=function(a,b){var c=m.radiusOuterCircle/2+3;return a<k.canvasCoordinate.x+c&&a>k.canvasCoordinate.x-c&&b<k.canvasCoordinate.y+c&&b>k.canvasCoordinate.y-c?this:!1},k.render=function(a,b){if("visible"===o.visibility){var c,d,e;m.radiusInnerCircle;c=k.getCanvasCoordinate(a),d=c.x,e=c.y,b.save(),b.strokeStyle=m.strokeStyleOuterCircle,b.lineWidth=m.lineWidthOuterCircle,b.beginPath(),b.arc(d,e,m.radiusOuterCircle,2*Math.PI,0,!0),b.closePath(),b.stroke(),b.fillStyle=m.fillStyleInnerCircle,b.beginPath(),b.arc(d,e,m.radiusInnerCircle,2*Math.PI,0,!0),b.closePath(),b.fill(),b.restore()}},k.resetFillStyle=function(){return m.fillStyleInnerCircle=m.originalFillStyleInnerCircle,this},k.resetSVImageCoordinate=function(a){return k.svImageCoordinate=a,k.canvasCoordinate={x:0,y:0},this},k.resetStrokeStyle=function(){return m.strokeStyleOuterCircle=m.originalStrokeStyleOuterCircle,this},k.setBelongsTo=function(a){return l=a,this},k.setFillStyle=function(a){return m.fillStyleInnerCircle=a,this},k.setIconPath=function(a){return m.iconImagePath=a,this},k.setPhotographerPov=function(a,b){return m.photographerHeading=a,m.photographerPitch=b,this},k.setProperties=function(a){for(key in a)key in m&&(m[key]=a[key]);return"originalCanvasCoordinate"in a&&(k.originalCanvasCoordinate=a.originalCanvasCoordinate),k.pov=k.pov||{},"pov"in a&&(k.pov=a.pov),"heading"in a&&(k.pov.heading=a.heading),"pitch"in a&&(k.pov.pitch=a.pitch),"zoom"in a&&(k.pov.zoom=a.zoom),k.originalPov=k.originalPov||{},"originalHeading"in a&&(k.originalPov.heading=a.originalHeading),"originalPitch"in a&&(k.originalPov.pitch=a.originalPitch),"originalZoom"in a&&(k.originalPov.zoom=a.originalZoom),m.originalFillStyleInnerCircle||(m.originalFillStyleInnerCircle=m.fillStyleInnerCircle),m.originalStrokeStyleOuterCircle||(m.originalStrokeStyleOuterCircle=m.strokeStyleOuterCircle),this},k.setStrokeStyle=function(a){return m.strokeStyleOuterCircle=a,this},k.setVisibility=function(a){return("visible"===a||"hidden"===a)&&(o.visibility=a),this},k.resetProperties=k.setProperties;var p=arguments.length;return 4===p?e(a,b,c,d):f(),k}function ProgressFeedback(a,b){function c(b){d=a("#ProgressBarContainer"),e=a("#ProgressBarFilled"),f=a("#Progress_Message"),h.progressBarWidth=d.width(),b&&b.message?g.setMessage(b.message):g.setMessage(""),g.setProgress(0)}var d,e,f,g={className:"ProgressFeedback"},h={progressBarWidth:void 0},i={progress:void 0};return g.setMessage=function(a){f.html(a)},g.setProgress=function(a){if("number"!=typeof a&&(a=parseFloat(a)),NaN===a)throw new TypeError(g.className+": The passed value cannot be parsed.");if(a>1&&(a=1,console.error(g.className+": You can not pass a value larger than 1 to setProgress.")),i.progress=a,h.progressBarWidth){var b,c,d;.5>a?(b=255,c=parseInt(255*a*2)):(b=parseInt(255*(1-a)*2),c=255),d="rgba("+b+","+c+",0,1)",e.css({background:d,width:a*h.progressBarWidth})}return this},c(b),g}function ProgressPov(a,b){function c(a){g=svw.ui.progressPov.rate,h=svw.ui.progressPov.bar,i=svw.ui.progressPov.filler,k.surveyedAngles=new Array(100);for(var b=0;100>b;b++)k.surveyedAngles[b]=0;if(a&&a.pov)k.previousHeading=a.pov.heading;else try{var c=svw.getPov();k.previousHeading=c.heading}catch(e){k.previousHeading=0}d()}function d(){var a=100*j.getCompletionRate();return a=a.toFixed(0,10),a+="%",g.html(a),this}function e(){var a,b,c,d=j.getCompletionRate(),e=255;.5>d?(a=e,b=parseInt(e*d*2)):(a=parseInt(e*(1-d)*2),b=e),c="rgba("+a+","+b+",0,1)",d*=100,d=d.toFixed(0,10),d-=.8,d+="%",i.css({background:c,width:d})}function f(){d(),e()}var g,h,i,j={className:"ProgressPov"},k={currentCompletionRate:0,previousHeading:0,surveyedAngles:void 0};return j.getCompletionRate=function(){try{if(k.currentCompletionRate<1){var a=25,b=svw.getPOV(),c=b.heading,d=(c-a+360)%360,e=(c+a)%360,f=Math.floor(d/360*100),g=Math.floor(e/360*100),h=0;if(g>f)for(h=f;g>h;h++)k.surveyedAngles[h]=1;else{for(h=f;100>h;h++)k.surveyedAngles[h]=1;for(h=0;g>h;h++)k.surveyedAngles[h]=1}var i=Math.floor(c/360*100),j=k.previousHeading;if(c!==j){var l=Math.floor(j/360*100),m=c-j;if(m>0&&300>m||-300>m)for(h=l;h==k.surveyedAngles.length&&(h=0),k.surveyedAngles[h]=1,h!=i;h++);else for(h=l;-1==h&&(h=k.surveyedAngles.length-1),k.surveyedAngles[h]=1,h!=i;h--);}var n=k.surveyedAngles.reduce(function(a,b){return a+b});return k.currentCompletionRate=n/100,k.previousHeading=c,n/100}return 1}catch(o){return 0}},j.setCompletedHeading=function(a){var b,c=a[0],d=a[1],e=Math.floor(c/360*100),f=Math.floor(d/360*100);for(b=e;f>b;b++)k.surveyedAngles[b]=1;return this},j.updateCompletionRate=function(){return f()},c(b),j}function QualificationBadges(a,b){function c(b){d=a("#BadgeImageHolder_BusStopAuditor"),e=a("#BadgeImageHolder_BusStopExplorer"),d.html('<img src="'+g.badgePlaceHolderImagePath+'" class="'+g.badgeClassName+'">'),e.html('<img src="'+g.badgePlaceHolderImagePath+'" class="'+g.badgeClassName+'">')}var d,e,f={className:"QualificationBadges"},g={badgeClassName:"Badge",badgePlaceHolderImagePath:"public/img/badges/EmptyBadge.png",busStopAuditorImagePath:"public/img/badges/Onboarding_BusStopExplorerBadge_Orange.png",busStopExplorerImagePath:"public/img/badges/Onboarding_BusStopInspector_Green.png"};return f.giveBusStopAuditorBadge=function(){return d.html('<img src="'+g.busStopAuditorImagePath+'" class="'+g.badgeClassName+'">'),this},f.giveBusStopExplorerBadge=function(){e.html('<img src="'+g.busStopExplorerImagePath+'" class="'+g.badgeClassName+'">')},c(b),f}function RibbonMenu(a,b){function c(){var b=getBrowser();"mozilla"===b?o.originalBackgroundColor="-moz-linear-gradient(center top , #fff, #eee)":"msie"===b?o.originalBackgroundColor="#ffffff":o.originalBackgroundColor="-webkit-gradient(linear, left top, left bottom, from(#fff), to(#eee))";var c=svw.misc.getLabelColors();svw.ui&&svw.ui.ribbonMenu&&(j=svw.ui.ribbonMenu.streetViewHolder,k=svw.ui.ribbonMenu.bottonBottomBorders,l=svw.ui.ribbonMenu.connector,m=svw.ui.ribbonMenu.buttons,a.each(k,function(b,d){var e=a(d).attr("value"),f=c[e].fillStyle;"Walk"===e&&a(d).css("width","56px"),a(d).css("border-top-color",f),a(d).css("background",f)}),i(p.mode),h(p.mode),m.bind("click",e),m.bind({mouseenter:f,mouseleave:g}))}function d(b){var c;if(c="string"==typeof b?b:a(this).attr("val"),p.disableModeSwitch===!1){var d,e,f;"canvas"in svw&&svw.canvas&&svw.canvas.isDrawing()&&svw.canvas.cancelDrawing(),d=getLabelColors(),e=getRibbonConnectionPositions(),f=d[c].fillStyle,"map"in svw&&svw.map&&("Walk"===c?(n.setStatus("mode","Walk"),n.setStatus("selectedLabelType",void 0),svw.map&&svw.map.modeSwitchWalkClick()):(n.setStatus("mode",c),n.setStatus("selectedLabelType",c),svw.map&&svw.map.modeSwitchLabelClick())),svw.ui&&svw.ui.ribbonMenu&&(i(c),h(c),l.css("left",e[c].labelRibbonConnection),l.css("border-left-color",f),j.css("border-color",f)),svw.overlayMessageBox&&svw.overlayMessageBox.setMessage(c)}}function e(){if(p.disableModeSwitch===!1){var b;if(b=a(this).attr("val"),p.allowedMode&&p.allowedMode!==b)return!1;svw.tracker.push("Click_ModeSwitch_"+b),d(b)}}function f(){if(p.disableModeSwitch===!1){var b=a(this).attr("val");if(p.allowedMode&&p.allowedMode!==b)return!1;h(b),i(b)}}function g(){p.disableModeSwitch===!1&&(i(p.mode),h(p.mode))}function h(b){if(svw.ui&&svw.ui.ribbonMenu){var c,d,e,f;d=getLabelColors(),e=d[b].fillStyle,a.each(m,function(d,g){c=a(g).attr("val"),c===b?(f="Walk"===c?"#ccc":e,a(this).css({background:f})):(f=o.originalBackgroundColor,c!==p.mode&&a(this).css({background:f}))})}return this}function i(b){if(svw.ui&&svw.ui.ribbonMenu){var c,d,e;d=getLabelColors(),e=d[b].fillStyle,a.each(m,function(d,f){c=a(f).attr("val"),c===b?a(this).css({"border-color":e,"border-style":"solid","border-width":o.borderWidth}):c!==p.mode&&a(this).css({"border-color":o.modeSwitchDefaultBorderColor,"border-style":"solid","border-width":o.borderWidth})})}return this}var j,k,l,m,n={className:"RibbonMenu"},o={borderWidth:"3px",modeSwitchDefaultBorderColor:"rgba(200,200,200,0.75)",originalBackgroundColor:"white"},p={disableModeSwitch:!1,lockDisableModeSwitch:!1,mode:"Walk",selectedLabelType:void 0};return n.backToWalk=function(){return d("Walk"),this},n.disableModeSwitch=function(){return p.lockDisableModeSwitch||(p.disableModeSwitch=!0,svw.ui&&svw.ui.ribbonMenu&&m.css("opacity",.5)),this},n.disableLandmarkLabels=function(){return svw.ui&&svw.ui.ribbonMenu&&a.each(m,function(b,c){var d=a(c).attr("val");"Walk"!==d&&"StopSign"!==d&&"Landmark_Shelter"!==d&&a(c).css("opacity",.5)}),p.disableLandmarkLabels=!0,this},n.enableModeSwitch=function(){return p.lockDisableModeSwitch||(p.disableModeSwitch=!1,svw.ui&&svw.ui.ribbonMenu&&m.css("opacity",1)),this},n.enableLandmarkLabels=function(){return svw.ui&&svw.ui.ribbonMenu&&a.each(m,function(b,c){a(c).attr("val");a(c).css("opacity",1)}),p.disableLandmarkLabels=!1,this},n.lockDisableModeSwitch=function(){return p.lockDisableModeSwitch=!0,this},n.modeSwitch=function(a){d(a)},n.modeSwitchClick=function(a){d(a)},n.getStatus=function(a){return a in p?p[a]:void console.warn(n.className,'You cannot access a property "'+a+'".')},n.setAllowedMode=function(a){return p.allowedMode=a,this},n.setStatus=function(a,b){try{if(a in p)return"disableModeSwitch"===a?"boolean"==typeof b?(b?n.disableModeSwitch():n.enableModeSwitch(),this):!1:(p[a]=b,this);var c='"'+a+'" is not a modifiable status.';throw c}catch(d){return console.error(n.className,d),!1}},n.unlockDisableModeSwitch=function(){return p.lockDisableModeSwitch=!1,this},c(b),n}function RightClickMenu(a){function b(a){B=a.canvas,C=a.ribbonMenu,D=$("div#labelDrawingLayer_LabelMenu"),E=$("#labelDrawingLayer_LabelMenuBar"),F=$("div#LabelDeleteMenu"),G=$("div#Holder_RightClickMenu"),H=$("input.Radio_BusStopType"),I=$("button#LabelDeleteMenu_DeleteButton"),J=$("button#LabelDeleteMenu_CancelButton"),K=$(".BusStopLabelMenuItem"),P=$("#Holder_BusStopLabelMenuOptionCloseIcon"),L=$("#BusStopPositionMenu"),M=$("#BusStopPositionMenu_MenuBar"),N=$(".BusStopPositionMenu_MenuItem"),O=$("#BusStopPositinoMenu_BackButton"),Q=$("#Holder_BusStopPositionMenuCloseIcon"),R=$(".RightClickMenuBar"),S=$(".Holder_BusStopLabelMenuQuestionMarkIcon"),T=$(".Holder_BusStopPositionMenuQuestionMarkIcon"),K.bind("mouseup",g),K.bind("mouseenter",h),K.bind("mouseleave",i),E.bind("mousedown",j),E.bind("mouseup",k),E.bind("mousemove",l),P.bind("click",m),P.bind("mouseenter",n),P.bind("mouseleave",o),N.bind("mouseup",p),N.bind("mouseenter",q),N.bind("mouseleave",r),M.bind("mousedown",v),M.bind("mouseup",w),M.bind("mousemove",x),Q.bind("click",u),Q.bind("mouseenter",s),Q.bind("mouseleave",t),S.bind({mouseenter:c,mouseleave:d,mouseup:e}),T.bind({mouseenter:c,mouseleave:d,mouseup:e}),R.bind("mouseenter",f),O.bind("click",A)}function c(a){$(this).find(".tooltip").css("visibility","visible")}function d(){$(this).find(".tooltip").css("visibility","hidden")}function e(a){a.stopPropagation();var b=$(this).parent().attr("value");myExamples.show(b)}function f(){$(this).css("cursor","url(public/img/cursors/openhand.cur) 4 4, move")}function g(){if(!V.disableMenuSelect){var a,b,c,d;a=getLabelColors().StopSign.fillStyle,d=$(this),d.css("background","transparent"),setTimeout(function(){d.css("background",a),setTimeout(function(){d.css("background","transparent"),U.hideBusStopType(),c=d.attr("value"),c||(c="StopSign"),V.currentLabel.setSubLabelDescription(c),b=getLabelIconImagePath()[c].iconImagePath,V.currentLabel.setIconPath(b),B.clear().render(),z()},100)},100)}}function h(){if(!V.disableMenuSelect){var a=getLabelColors().StopSign.fillStyle;return $(this).css({background:a,cursor:"pointer"}),this}return!1}function i(){return V.disableMenuSelect?void 0:($(this).css({background:"transparent",cursor:"default"}),this)}function j(){W.mouseDownOnBusStopLabelMenuBar=!0,$(this).css("cursor","url(public/img/cursors/closedhand.cur) 4 4, move")}function k(){W.mouseDownOnBusStopLabelMenuBar=!1,$(this).css("cursor","url(public/img/cursors/openhand.cur) 4 4, move")}function l(a){if(W.mouseDownOnBusStopLabelMenuBar){var b,c,d=D.css("left"),e=D.css("top");e=parseInt(e.replace("px","")),d=parseInt(d.replace("px","")),b=a.pageX-W.prevX,c=a.pageY-W.prevY,d+=b,e+=c,D.css({left:d,top:e})}W.prevX=a.pageX,W.prevY=a.pageY}function m(){if(!V.disableMenuClose){var a;V.currentLabel&&(a=V.currentLabel.getProperties(),("DefaultValue"===a.labelProperties.busStopPosition||"DefaultValue"===a.labelProperties.subLabelDescription)&&(myCanvas.removeLabel(V.currentLabel),myActionStack.pop())),W.mouseDownOnBusStopLabelMenuBar=!1,U.hideBusStopType(),B.enableLabeling(),myMenu.setStatus("disableModeSwitch",!1)}}function n(){V.disableMenuClose||$(this).css("cursor","pointer")}function o(){$(this).css("cursor","default")}function p(){if(!V.disableMenuSelect){var a,b,c;b=getLabelColors().StopSign.fillStyle,V.currentLabel.setStatus("visibilityTag","visible"),c=$(this),c.css("background","transparent"),a=c.attr("value"),V.currentLabel.setBusStopPosition(a),setTimeout(function(){c.css("background",b),setTimeout(function(){c.css("background","transparent"),y(),myMap.enableWalking(),myMenu.backToWalk()},100)},100)}}function q(){if(!V.disableMenuSelect){var a=getLabelColors().StopSign.fillStyle;return $(this).css({background:a,cursor:"pointer"}),this}}function r(){return V.disableMenuSelect?void 0:($(this).css({background:"transparent",cursor:"default"}),this)}function s(){V.disableMenuClose||$(this).css({cursor:"pointer"})}function t(){$(this).css({cursor:"default"})}function u(){if(!V.disableMenuClose&&V.currentLabel){var a;a=V.currentLabel.getProperties(),("DefaultValue"===a.labelProperties.busStopPosition||"DefaultValue"===a.labelProperties.subLabelDescription)&&(myCanvas.removeLabel(V.currentLabel),myActionStack.pop()),W.mouseDownOnBusStopPositionMenuBar=!1,y(),B.enableLabeling(),myMenu.setStatus("disableModeSwitch",!1)}}function v(a){W.mouseDownOnBusStopPositionMenuBar=!0,$(this).css("cursor","url(public/img/cursors/closedhand.cur) 4 4, move")}function w(a){W.mouseDownOnBusStopPositionMenuBar=!1,$(this).css("cursor","url(public/img/cursors/openhand.cur) 4 4, move")}function x(a){if(W.mouseDownOnBusStopPositionMenuBar){var b,c,d=L.css("left"),e=L.css("top");e=parseInt(e.replace("px","")),d=parseInt(d.replace("px","")),b=a.pageX-W.prevX,c=a.pageY-W.prevY,d+=b,e+=c,L.css({left:d,top:e})}W.prevX=a.pageX,W.prevY=a.pageY}function y(){V.visibilityBusStopPositionMenu="hidden",G.css("visibility","hidden"),L.css("visibility","hidden"),U.isAllClosed()&&(B.setStatus("disableLabeling",!1),myMenu.setStatus("disableModeSwitch",!1),V.disableLabelDelete=!1,V.currentLabel=void 0,myActionStack.unlockDisableRedo().enableRedo().lockDisableRedo(),myActionStack.unlockDisableUndo().enableUndo().lockDisableUndo(),myForm.unlockDisableSubmit().enableSubmit().lockDisableSubmit(),myForm.unlockDisableNoBusStopButton().enableNoBusStopButton().lockDisableNoBusStopButton())}function z(){var a=V.menuPosition.x,b=V.menuPosition.y;V.visibilityBusStopPositionMenu="visible",M.css({background:getLabelColors().StopSign.fillStyle}),a>400&&(a-=300),b>300&&(b-=200),L.css({visibility:"visible",position:"absolute",left:a,top:b,"z-index":4}),B.setStatus("visibilityMenu","visible"),B.disableLabeling(),myMenu.setStatus("disableModeSwitch",!0),myActionStack.unlockDisableRedo().disableRedo().lockDisableRedo(),myActionStack.unlockDisableUndo().disableUndo().lockDisableUndo()}function A(){var a=V.currentLabel;y(),U.showBusStopType(a.getCoordinate().x,a.getCoordinate().y)}var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U={className:"RightClickMenu"},V={currentLabel:void 0,disableLabelDelete:!1,disableMenuClose:!1,disableMenuSelect:!1,lockDisableMenuSelect:!1,visibilityDeleteMenu:"hidden",visibilityBusStopLabelMenu:"hidden",visibilityBusStopPositionMenu:"hidden",menuPosition:{x:-1,y:-1}},W={currX:0,currY:0,prevX:0,prevY:0,leftDownX:0,leftDownY:0,leftUpX:0,leftUpY:0,mouseDownOnBusStopLabelMenuBar:!1,mouseDownOnBusStopPositionMenuBar:!1};return U.close=function(){m(),u()},U.disableMenuClose=function(){return V.disableMenuClose=!0,this},U.disableMenuSelect=function(){return V.lockDisableMenuSelect||(V.disableMenuSelect=!0),this},U.enableMenuClose=function(){return V.disableMenuClose=!1,this},U.enableMenuSelect=function(){return V.lockDisableMenuSelect||(V.disableMenuSelect=!1),this},U.getMenuPosition=function(){return{x:V.menuPosition.x,y:V.menuPosition.y}},U.hideBusStopPosition=function(){return y(),this},U.hideBusStopType=function(){G.css("visibility","hidden"),D.css("visibility","hidden"),V.visibilityBusStopLabelMenu="hidden",B.setStatus("visibilityMenu","hidden"),U.isAllClosed()&&(myActionStack.unlockDisableRedo().enableRedo().lockDisableRedo(),myActionStack.unlockDisableUndo().enableUndo().lockDisableUndo(),myForm.unlockDisableSubmit().disableSubmit().lockDisableSubmit(),myForm.unlockDisableNoBusStopButton().disableNoBusStopButton().lockDisableNoBusStopButton())},U.hideDeleteLabel=function(){G.css("visibility","hidden"),V.visibilityDeleteMenu="hidden",F.css("visibility","hidden"),B.setStatus("visibilityMenu","hidden"),U.isAllClosed()&&(B.enableLabeling(),myMenu.setStatus("disableModeSwitch",!1))},U.isAllClosed=function(){return"hidden"===V.visibilityBusStopLabelMenu&&"hidden"===V.visibilityDeleteMenu&&"hidden"===V.visibilityBusStopPositionMenu?!0:!1},U.isAnyOpen=function(){return!U.isAllClosed()},U.lockDisableMenuSelect=function(){return V.lockDisableMenuSelect=!0,this},U.setStatus=function(a,b){return a in V?"disableMenuClose"===a?"boolean"==typeof b?(b?U.enableMenuClose():U.disableMenuClose(),
this):!1:(V[a]=b,this):!1},U.showBusStopType=function(a,b){if(V.currentLabel=B.getCurrentLabel(),V.currentLabel&&"StopSign"===V.currentLabel.getLabelType()){var c,d;G.css("visibility","visible"),V.visibilityBusStopLabelMenu="visible",E.css({background:getLabelColors().StopSign.fillStyle}),c=a+25,d=b+25,c>400&&(c-=300),d>300&&(d-=200),V.menuPosition.x=c,V.menuPosition.y=d,D.css({visibility:"visible",position:"absolute",left:c,top:d,"z-index":4}),V.visibilityBusStopLabelMenu="visible",B.setStatus("visibilityMenu","visible"),B.setStatus("disableLabeling",!0),B.disableLabeling(),myMap.setStatus("disableWalking",!0),myMenu.setStatus("disableModeSwitch",!0)}},U.showDeleteLabel=function(a,b){var c,d;V.disableLabelDelete||(G.css("visibility","visible"),c=a-5,d=b-5,F.css({visibility:"visible",position:"absolute",left:c,top:d,"z-index":4}),V.visibilityDeleteMenu="visible",V.visibilityMenu="visible",V.disableLabeling=!0,myMenu.setStatus("disableModeSwitch",!0))},U.unlockDisableMenuSelect=function(){return V.lockDisableMenuSelect=!1,this},b(a),U}function Tooltip(a,b){function c(b){d=a(b.domIds.tooltipHolder)}var d,e={className:"Tooltip"};return e.show=function(a){d.html(a),d.css("visibility","visible")},e.hide=function(){d.css("visibility","hidden")},c(b),e}function Tracker(){var a={className:"Tracker"},b=[],c=["TaskStart","TaskSubmit","TaskSubmitSkip","Click_ModeSwitch_Walk","Click_ModeSwitch_CurbRamp","Click_ModeSwitch_NoCurbRamp","Click_Undo","Click_Redo","Click_ZoomIn","Click_ZoomOut","Click_LabelDelete","Click_LabelEdit","Click_Path","Click_OpenSkipWindow","Click_CloseSkipWindow","Click_SkipRadio","LabelingCanvas_MouseUp","LabelingCanvas_MouseDown","LabelingCanvas_CancelLabeling","LabelingCanvas_StartLabeling","LabelingCanvas_FinishLabeling","ViewControl_MouseDown","ViewControl_MouseUp","ViewControl_DoubleClick","ViewControl_ZoomIn","ViewControl_ZoomOut","WalkTowards","KeyDown","KeyUp","RemoveLabel","Redo_AddLabel","Redo_RemoveLabel","Undo_AddLabel","Undo_RemoveLabel","MessageBox_ClickOk","GoldenInsertion_Submit","GoldenInsertion_ReviewLabels","GoldenInsertion_ReviseFalseNegative","GoldenInsertion_ReviseFalsePositive","Onboarding1_Start","Onboarding1_FirstCorner_IntroduceCurbRamps","Onboarding1_FirstCorner_LabelTheFirstCurbRamps","Onboarding1_FirstCorner_RedoLabelingTheFirstCurbRamps","Onboarding1_FirstCorner_SwitchTheModeToCurbRampForLabelTheSecondCurbRamps","Onboarding1_FirstCorner_LabelTheSecondCurbRamps","Onboarding1_FirstCorner_RedoLabelingTheSecondCurbRamps","Onboarding1_GrabAndDragToMoveToTheNextCorner","Onboarding1_KeepDragging","Onboarding1_SecondCorner_ModeSwitchToCurbRamps","Onboarding1_SecondCorner_LabelTheCurbRamps","Onboarding1_SecondCorner_RedoLabelingTheThirdCurbRamps","Onboarding1_SecondCorner_IntroductionToAMissingCurbRamp","Onboarding1_SecondCorner_LabelTheMissingCurbRamp","Onboarding1_SecondCorner_RedoLabelingTheMissingCurbRamps","Onboarding1_DoneLabelingAllTheCorners_EndLabeling","Onboarding1_Submit","Onboarding2_Start","Onboarding2_FirstCorner_IntroduceMissingCurbRamps","Onboarding2_FirstCorner_LabelTheMissingCurbRamps","Onboarding2_FirstCorner_RedoLabelingTheMissingCurbRamps","Onboarding2_FirstCorner_V2_LabelTheFirstMissingCurbRamps","Onboarding2_FirstCorner_V2_RedoLabelingTheFirstMissingCurbRamps","Onboarding2_FirstCorner_V2_ModeSwitchToMissingCurbRamp","Onboarding2_FirstCorner_V2_LabelTheSecondMissingCurbRamps","Onboarding2_FirstCorner_V2_RedoLabelingTheSecondMissingCurbRamps","Onboarding2_FirstCorner_MissingCurbRampExampleLabels","Onboarding2_GrabAndDragToTheSecondCorner","Onboarding2_KeepDraggingToTheSecondCorner","Onboarding2_SecondCorner_ModeSwitchToCurbRamp","Onboarding2_SecondCorner_LabelTheCurbRamp","Onboarding2_SecondCorner_RedoLabelingTheCurbRamps","Onboarding2_SecondCorner_ExamplesOfDiagonalCurbRamps","Onboarding2_RemindAboutTheCompletionRateMeter","Onboarding2_GrabAndDragToTheThirdCorner","Onboarding2_KeepDraggingToTheThirdCorner","Onboarding2_ThirdCorner_FirstZoomIn","Onboarding2_ThirdCorner_FirstModeSwitchToCurbRamp","Onboarding2_ThirdCorner_LabelTheFirstCurbRamp","Onboarding2_ThirdCorner_RedoLabelingTheFirstCurbRamps","Onboarding2_ThirdCorner_AdjustTheCameraAngle","Onboarding2_ThirdCorner_KeepAdjustingTheCameraAngle","Onboarding2_ThirdCorner_SecondZoomIn","Onboarding2_ThirdCorner_SecondModeSwitchToCurbRamp","Onboarding2_ThirdCorner_LabelTheSecondCurbRamps","Onboarding2_ThirdCorner_RedoLabelingTheSecondCurbRamps","Onboarding2_ThirdCorner_FirstZoomOut","Onboarding2_ThirdCorner_SecondZoomOut","Onboarding2_GrabAndDragToTheFourthCorner","Onboarding2_KeepDraggingToTheFourthCorner","Onboarding2_FourthCorner_IntroduceOcclusion","Onboarding2_DoneLabelingAllTheCorners_EndLabeling","Onboarding2_Submit","Onboarding3_Start","Onboarding3_ShowNorthSideOfTheIntersection","Onboarding3_GrabAndDrag","Onboarding3_KeepDragging","Onboarding3_SouthSideOfTheIntersection","Onboarding3_GrabAndDragToNorth","Onboarding3_ClickSkip","Onboarding3_SelectSkipOption","Onboarding3_ClickSkipOk","Onboarding3_finalMessage","Onboarding3_Submit","OnboardingQuickCheck_nextClick","OnboardingQuickCheck_clickQuickCheckImages","OnboardingQuickCheck_submitClick","OnboardingQuickCheck_submit"],d="undefined";return a.getActions=function(){return b},a.getAvailableActionTypes=function(){var a=c.slice(0);return a},a.push=function(a,e){if(-1===c.indexOf(a))return console.warn("Unknown action: "+a),!1;var f,g,h,i,j;j=e?"x"in e&&"y"in e?"x:"+e.x+",y:"+e.y:"TargetPanoId"in e?e.TargetPanoId:"RadioValue"in e?e.RadioValue:"keyCode"in e?"keyCode:"+e.keyCode:"errorType"in e?"errorType:"+e.errorType:"quickCheckImageId"in e?e.quickCheckImageId:"quickCheckCorrectness"in e?e.quickCheckCorrectness:"labelId"in e?"labelId:"+e.labelId:d:d;try{f=svw.getPOV()}catch(k){f={heading:d,pitch:d,zoom:d}}try{g=getPosition()}catch(k){g={lat:d,lng:d}}g||(g={lat:d,lng:d});try{h=getPanoId()}catch(k){h=d}return i={actionType:a,heading:f.heading,lat:g.lat,lng:g.lng,panoId:h,pitch:f.pitch,timestamp:(new Date).getTime(),zoom:f.zoom,note:j},b.push(i),this},a}function UI(a,b){function c(b){$buttonRedo=a("#ActionStackRedoButton"),$buttonUndo=a("#ActionStackUndoButton"),d.actionStack={},d.actionStack.redo=$buttonRedo,d.actionStack.undo=$buttonUndo,$labelCountCurbRamp=a("#LabeledLandmarkCount_CurbRamp"),$labelCountNoCurbRamp=a("#LabeledLandmarkCount_NoCurbRamp"),$submittedLabelMessage=a("#LabeledLandmarks_SubmittedLabelCount"),d.labeledLandmark={},d.labeledLandmark.curbRamp=$labelCountCurbRamp,d.labeledLandmark.noCurbRamp=$labelCountNoCurbRamp,d.labeledLandmark.submitted=$submittedLabelMessage,d.map={},d.map.canvas=a("canvas#labelCanvas"),d.map.drawingLayer=a("div#labelDrawingLayer"),d.map.pano=a("div#pano"),d.map.streetViewHolder=a("div#streetViewHolder"),d.map.viewControlLayer=a("div#viewControlLayer"),d.map.modeSwitchWalk=a("span#modeSwitchWalk"),d.map.modeSwitchDraw=a("span#modeSwitchDraw"),$currentStatusDescription=a("#CurrentStatus_Description"),d.missinDescription={},d.missinDescription.description=$currentStatusDescription,d.overlayMessage={},d.overlayMessage.box=a("#OverlayMessageBox"),d.overlayMessage.message=a("#OverlayMessage"),d.progressPov={},d.progressPov.rate=a("#Holder_CurrentCompletionRate"),d.progressPov.bar=a("#Holder_CurrentCompletionBar"),d.progressPov.filler=a("#Holder_CurrentCompletionBarFiller"),$divStreetViewHolder=a("#Holder_StreetView"),$ribbonButtonBottomLines=a(".RibbonModeSwitchHorizontalLine"),$ribbonConnector=a("#StreetViewLabelRibbonConnection"),$spansModeSwitches=a("span.modeSwitch"),d.ribbonMenu={},d.ribbonMenu.streetViewHolder=$divStreetViewHolder,d.ribbonMenu.buttons=$spansModeSwitches,d.ribbonMenu.bottonBottomBorders=$ribbonButtonBottomLines,d.ribbonMenu.connector=$ribbonConnector,$buttonZoomIn=a("#ZoomControlZoomInButton"),$buttonZoomOut=a("#ZoomControlZoomOutButton"),d.zoomControl={},d.zoomControl.zoomIn=$buttonZoomIn,d.zoomControl.zoomOut=$buttonZoomOut}var d={moduleName:"MainUI"};return d.streetViewPane={},c(b),d}function Validator(a,b){function c(a){var c=b(this),d=c.attr("value");c.css("background","rgba(230, 230, 230, 1)"),I.radioCurrentLabelHoverState=d,l()}function d(a){var c=b(this);c.css("background","transparent"),I.radioCurrentLabelHoverState="ShowLabel",l()}function e(a){var c=b(this).attr("value");I.radioCurrentLabelCheckState=c,l()}function f(a,b){var c,d,e=b.length,f=[],g=1e7,h=-1;for(c=0;e>c;c+=1)g>b[c].x&&(g=b[c].x),h<b[c].x&&(h=b[c].x);var i=3328;for(c=0;e>c;c+=1)a.heading<180?h>svw.svImageWidth-i&&b[c].x>i&&(b[c].x-=svw.svImageWidth):i>g&&b[c].x<svw.svImageWidth-i&&(b[c].x+=svw.svImageWidth),d=svw.gsvImageCoordinate2CanvasCoordinate(b[c].x,b[c].y,a),f.push(d);return f}function g(a){var b,c=a.points.length,d=svw.getPOV(),e=void 0,g=[];for(b=0;c>b;b++)e={x:parseInt(a.points[b].svImageX),y:parseInt(a.points[b].svImageY)},g.push(e);var h,i=f(d,g),j=-1;for(b=0;c>b;b++)h=i[b],j<h.y&&(j=h.y);return j}function h(a){var b,c=a.points.length,d={heading:parseFloat(a.points[0].heading),pitch:parseFloat(a.points[0].pitch),zoom:parseFloat(a.points[0].zoom)},e=void 0,g=[];for(b=0;c>b;b++)e={x:parseInt(a.points[b].svImageX),y:parseInt(a.points[b].svImageY)},g.push(e);var h,i=f(d,g),j=1e6;for(b=0;c>b;b++)h=i[b],j>h.x&&(j=h.x);return j}function i(){var a,b,c=L.length,d=!0;for(a=0;c>a;a++)if(b=L[a],!b.validated){d=!1;break}return d?(I.allLabelsHaveBeenValidated=d,!1):b}function j(){var a,b=L.length,c=0;for(a=0;b>a;a++)L[a].validated&&(c+=1);return c}function k(){x.css("visibility","hidden")}function l(){if(!K)throw G.className+": highlightCurrentLabel(): currentLabel is not set.";var a,b,c,d,e,f,g,h;if(!svw.canvas)throw G.className+": highlightCurrentLabel(): canvas is not defined.";var i=void 0;for(d=svw.canvas.getLabels(),c=d.length,i="ShowLabel"===I.radioCurrentLabelHoverState?!0:!1,a=0;c>a;a++)if(e=d[a],f=e.getPath(!0),K.meta.labelId===d[a].getProperty("labelId")&&i)for(e.setVisibility("visible"),g=f.points,h=g.length,b=0;h>b;b++)g[b].resetFillStyle(),g[b].resetStrokeStyle();else for(e.setVisibility("hidden"),g=f.points,h=g.length,b=0;h>b;b++)g[b].setFillStyle("rgba(255,255,255,0)"),g[b].setStrokeStyle("rgba(255,255,255,0)");svw.canvas.clear(),svw.canvas.render2()}function m(a){H.previewMode=a.previewMode,v=b(a.domIds.holder),x=b("#ValidationDialogWindow"),w=b("#ValidationDialogWindowMenuBar"),y=b("#ValidationLabelValue"),z=b("#ValidationButtonAgree"),A=b("#ValidationButtonDisagree"),B=b(".SpanValidationCurrentLabeliVisibility"),C=b(".RadioValidationCurrentLabelVisibility"),D=b("#NumCompletedTasks"),E=b("#NumTotalTasks"),F=b("#ProgressBarFiller"),w.on({mousedown:r,mouseleave:s,mousemove:t,mouseup:u}),B.hover(c,d),C.on("mousedown",e),z.on("click",p),A.on("click",q),k(),o(),b("#Holder_GoogleMap").css("visibility","hidden")}function n(a){if("number"!=typeof a&&(console.error(G.className,"A parameter of showDialogWindow() should be in milli-seconds (number)."),a=void 0),K){var b,c=g(K),d=h(K);b="CurbRamp"===K.meta.labelType?"We believe the green box (label) is correctly placed on a curb ramp in this image. Do you agree?":'We believe <span class="bold">there should be a curb ramp</span> under the highlighted area.',y.html(b),a?setTimeout(function(){c=g(K),d=h(K),x.css({left:d,top:c+20,visibility:"visible"})},a):x.css({left:d,top:c+20,visibility:"visible"})}}function o(){var a=L.length,b=0;b=j(),D.text(b),E.text(a);var c,d,e,f=b/a,g=parseInt(100*f,10)+"%";.5>f?(c=255,d=parseInt(255*f*2)):(c=parseInt(255*(1-f)*2),d=255),e="rgb(4,"+d+", 0)",F.css({background:e,width:g})}function p(){return K||(K=i()),K.validated=!0,K.validationLabel="Agree",G.validateNext(),o(),H.onboarding?!1:j()<L.length?!1:H.previewMode?(window.location.reload(),!1):!0}function q(){return K||(K=i()),K.validated=!0,K.validationLabel="Disagree",G.validateNext(),o(),H.onboarding?!1:j()<L.length?!1:H.previewMode?(window.location.reload(),!1):!0}function r(a){var b=mouseposition(a,"body");I.menuBarMouseDown=!0,J.menuBarPrevX=b.x,J.menuBarPrevY=b.y,J.menuBarMouseDownX=b.x,J.menuBarMouseDownY=b.y}function s(a){var b=mouseposition(a,"body");I.menuBarMouseDown=!1,J.menuBarMouseUpX=b.x,J.menuBarMouseUpY=b.y}function t(a){var b=mouseposition(a,"body");if(I.menuBarMouseDown&&b&&b.x&&b.y&&J.menuBarPrevX&&J.menuBarPrevX){var c=b.x-J.menuBarPrevX,d=b.y-J.menuBarPrevY,e=parseInt(x.css("left"),10),f=parseInt(x.css("top"),10);x.css({left:e+c,top:f+d})}J.menuBarPrevX=b.x,J.menuBarPrevY=b.y}function u(a){var b=mouseposition(a,"body");I.menuBarMouseDown=!1,J.menuBarMouseUpX=b.x,J.menuBarMouseUpY=b.y}var v,w,x,y,z,A,B,C,D,E,F,G={className:"Validator"},H={onboarding:!1},I={allLabelsHaveBeenValidated:!1,disableAgreeButton:!1,disableDisagreeButton:!1,disableRadioButtons:!1,menuBarMouseDown:!1,radioCurrentLabelCheckState:"ShowLabel",radioCurrentLabelHoverState:"ShowLabel"},J={menuBarMouseDownX:void 0,menuBarMouseDownY:void 0,menuBarMouseUpX:void 0,menuBarMouseUpY:void 0,menuBarPrevX:void 0,menuBarPrevY:void 0},K=void 0,L=[];return G.disableAgreeButton=function(){return I.disableAgreeButton=!0,z.css("opacity","0.5"),z.attr("disabled",!0),this},G.disableDisagreeButton=function(){return I.disableDisagreeButton=!0,A.css("opacity","0.5"),A.attr("disabled",!0),this},G.disableRadioButtons=function(){return I.disableRadioButtons=!0,C.each(function(a,c){b(c).attr("disabled",!0)}),this},G.enableAgreeButton=function(){return I.disableAgreeButton=!1,z.css("opacity","1"),z.attr("disabled",!1),this},G.enableDisagreeButton=function(){I.disableDisagreeButton=!1,A.css("opacity","1"),A.attr("disabled",!1)},G.enableRadioButtons=function(){I.disableRadioButtons=!1,C.each(function(a,c){b(c).attr("disabled",!1)})},G.getLabels=function(){return b.extend(!0,[],L)},G.hideDialogWindow=function(){return k(),this},G.insertLabels=function(a){var b=svw.misc.getLabelDescriptions(),c={};c.canvasWidth=svw.canvasWidth,c.canvasHeight=svw.canvasHeight,c.canvasDistortionAlphaX=svw.alpha_x,c.canvasDistortionAlphaY=svw.alpha_y,c.labelId=a[0].LabelId,c.labelType=a[0].LabelType,c.labelDescription=b[c.labelType].text,c.panoId=a[0].LabelGSVPanoramaId,c.panoramaLat=a[0].Lat,c.panoramaLng=a[0].Lng,c.panoramaHeading=a[0].heading,c.panoramaPitch=a[0].pitch,c.panoramaZoom=a[0].zoom,c.svImageWidth=svw.svImageWidth,c.svImageHeight=svw.svImageHeight,c.svMode="html4";var d={meta:c,points:a,validated:!1,validationLabel:void 0};L.push(d),o()},G.setDialogWindowBorderWidth=function(a){return x.css("border-width",a),this},G.setDialogWindowBorderColor=function(a){return x.css("border-color",a),this},G.showDialogWindow=function(a){return n(a),this},G.sortLabels=function(){function a(a,b){return parseInt(a.points[0].svImageX)<parseInt(b.points[0].svImageX)?-1:parseInt(a.points[0].svImageX)>parseInt(b.points[0].svImageX)?1:0}return L.sort(a),this},G.validateNext=function(a){if(!("map"in svw))throw G.className+": Map is not defined.";if(!("canvas"in svw))throw G.className+": Canvas is not defined.";if(K=i()){var b={heading:parseFloat(K.meta.panoramaHeading),pitch:parseFloat(K.meta.panoramaPitch),zoom:parseFloat(K.meta.zoom)};if(k(),"number"==typeof a&&a>=0){var c=500;svw.map.setPov(b,c),l(),n(c)}else svw.map.setPov(b,500),l(),n(500)}else{if(k(),H.onboarding)return!1;svw.validatorForm.submit()}return this},G.setOnboarding=function(a){H.onboarding=a},m(a),G}function ValidatorForm(a,b){function c(a){for(attr in f)f[attr]=a[attr]}function d(){if(!("validator"in svw&&svw.validator))throw e.className+": Validator not defined.";var a,c,d,h,i,j=f.panoId,k=f.dataStoreUrl,l={};if(a=f.hitId?f.hitId:"Test_Hit",c=f.assignmentId?f.assignmentId:"Test_Assignment",d=f.turkerId?f.turkerId:"Test_Kotaro",!f.onboarding){l.assignment={amazon_turker_id:d,amazon_hit_id:a,amazon_assignment_id:c,interface_type:"StreetViewValidator",interface_version:"1",completed:0,task_description:f.taskDescription},l.labelBinId=g,l.validationTask={task_panorama_id:f.taskPanoramaId,task_gsv_panorama_id:j,description:""},l.validationTaskEnvironment={browser:getBrowser(),browser_version:getBrowserVersion(),browser_width:b(window).width(),browser_height:b(window).height(),screen_width:screen.width,screen_height:screen.height,avail_width:screen.availWidth,avail_height:screen.availHeight,operating_system:getOperatingSystem()},svw.tracker.push("TaskSubmit"),l.userInteraction=svw.tracker.getActions(),l.labels=[];var m=svw.validator.getLabels();for(i=m.length,h=0;i>h;h++){console.log(m[h]);var n={};n.labelId=m[h].points[0].LabelId,n.result="Disagree"===m[h].validationLabel?0:1,l.labels.push(n)}try{b.ajax({async:!1,url:k,type:"post",data:l,dataType:"json",success:function(a){if(a.error)throw a.error.message},error:function(a){throw a}})}catch(o){console.log(o)}if(!(f.taskRemaining>1))return f.isAMTTask?(b('input[name="assignmentId"]').attr("value",c),b('input[name="workerId"]').attr("value",d),b('input[name="hitId"]').attr("value",a),!0):(window.location.reload(),!1);window.location.reload()}return!1}var e={className:"ValidatorForm"},f={dataStoreUrl:void 0,onboarding:void 0,taskDescription:void 0,taskPanoramaId:void 0,assignmentId:void 0,hitId:void 0,turkerId:void 0},g=void 0;return e.setLabelBinId=function(a){return g=a,this},e.submit=function(){return d()},c(a),e}function ZoomControl(a,b){function c(a){svw.ui&&svw.ui.zoomControl&&(h=svw.ui.zoomControl.zoomIn,i=svw.ui.zoomControl.zoomOut,h.bind("click",d),i.bind("click",e))}function d(){if("tracker"in svw&&svw.tracker.push("Click_ZoomIn"),!l.disableZoomIn){var a=svw.panorama.getPov();g(a.zoom+1),svw.canvas.clear().render2()}}function e(){if("traker"in svw&&svw.tracker.push("Click_ZoomOut"),!l.disableZoomOut){var a=svw.panorama.getPov();g(a.zoom-1),svw.canvas.clear().render2()}}function f(a,b){if(!l.disableZoomIn){if("canvas"in svw&&svw.canvas.cancelDrawing(),"panorama"in svw){console.log("hi");var c=svw.panorama.getPov(),d=c.zoom;if(d>=k.maxZoomLevel)return!1;var e=svw.canvasWidth,f=svw.canvasHeight,g=svw.map.getProperty("minPitch"),h=svw.map.getProperty("maxPitch"),i=d,j=(a-e/2)/e*(90/i),m=-(b-f/2)/f*(70/i),n={};n.zoom=d+1,n.heading=c.heading+j,n.pitch=c.pitch+m;var h=svw.map.getMaxPitch(),g=svw.map.getMinPitch();return n.pitch>h?n.pitch=h:n.pitch<g&&(n.pitch=g),svw.panorama.setPov(n),d}return!1}}function g(a){if("number"!=typeof a)return!1;"canvas"in svw&&svw.canvas.cancelDrawing();var b=void 0;return a=parseInt(a),b=1>a?1:a>k.maxZoomLevel?k.maxZoomLevel:a,svw.panorama.setZoom(b),b}var h,i,j={className:"ZoomControl"},k={maxZoomLevel:3,minZoomLevel:1},l={disableZoomIn:!1,disableZoomOut:!1},m={disableZoomIn:!1,disableZoomOut:!1};return j.disableZoomIn=function(){return m.disableZoomIn||(l.disableZoomIn=!0,h&&h.css("opacity",.5)),this},j.disableZoomOut=function(){return m.disableZoomOut||(l.disableZoomOut=!0,i&&i.css("opacity",.5)),this},j.enableZoomIn=function(){return m.disableZoomIn||(l.disableZoomIn=!1,h&&h.css("opacity",1)),this},j.enableZoomOut=function(){return m.disableZoomOut||(l.disableZoomOut=!1,i&&i.css("opacity",1)),this},j.getLock=function(a){if(a in m)return m[a];var b='You cannot access a property "'+a+'".';throw b},j.getStatus=function(a){if(a in l)return l[a];var b='You cannot access a property "'+a+'".';throw b},j.getProperties=function(a){if(a in k)return k[a];var b='You cannot access a property "'+a+'".';throw b},j.lockDisableZoomIn=function(){return m.disableZoomIn=!0,this},j.lockDisableZoomOut=function(){return m.disableZoomOut=!0,this},j.updateOpacity=function(){var a=svw.getPOV();if(a){var b=a.zoom;b>=k.maxZoomLevel?(h.css("opacity",.5),i.css("opacity",1)):b<=k.minZoomLevel?(h.css("opacity",1),i.css("opacity",.5)):(h.css("opacity",1),i.css("opacity",1))}return l.disableZoomIn&&h.css("opacity",.5),l.disableZoomOut&&i.css("opacity",.5),this},j.pointZoomIn=function(a,b){return l.disableZoomIn?!1:f(a,b)},j.setMaxZoomLevel=function(a){return k.maxZoomLevel=a,this},j.setMinZoomLevel=function(a){return k.minZoomLevel=a,this},j.unlockDisableZoomIn=function(){return m.disableZoomIn=!1,this},j.unlockDisableZoomOut=function(){return m.disableZoomOut=!1,this},j.zoomIn=function(){if(l.disableZoomIn)return!1;var a=svw.panorama.getPov();return g(a.zoom+1),svw.canvas.clear().render2(),this},j.zoomOut=function(){if(l.disableZoomOut)return!1;var a=svw.panorama.getPov();return g(a.zoom-1),svw.canvas.clear().render2(),this},c(b),j}var svw=svw||{},svw=svw||{};svw.canvasWidth=720,svw.canvasHeight=480,svw.svImageHeight=6656,svw.svImageWidth=13312,svw.alpha_x=4.6,svw.alpha_y=-4.65,svw._labelCounter=0,svw.getLabelCounter=function(){return svw._labelCounter++};var svw=svw||{};svw.formatRecordsToGoldenLabels=function(a){var b,c,d,e,f,g={},h=a.length;for(b=0;h>b;b++)if(d="LabelGSVPanoramaId"in a[b]?a[b].LabelGSVPanoramaId:"GSVPanoramaId"in a[b]?a[b].GSVPanoramaId:void 0,e="Lat"in a[b]?a[b].Lat:"labelLat"in a[b]?a[b].labelLat:void 0,f="Lng"in a[b]?a[b].Lng:"labelLng"in a[b]?a[b].labelLng:void 0,"1"!=a[b].Deleted){c=a[b].LabelId,c in g||(g[c]=[]);var i={AmazonTurkerId:a[b].AmazonTurkerId,LabelId:a[b].LabelId,LabelGSVPanoramaId:d,LabelType:a[b].LabelType,LabelPointId:a[b].LabelPointId,svImageX:a[b].svImageX,svImageY:a[b].svImageY,originalCanvasCoordinate:{x:a[b].originalCanvasX,y:a[b].originalCanvasY},originalHeading:a[b].originalHeading,originalPitch:a[b].originalPitch,originalZoom:a[b].originalZoom,heading:a[b].heading,pitch:a[b].pitch,zoom:a[b].zoom,Lat:e,Lng:f};"PhotographerHeading"in a[b]&&"PhotographerPitch"in a[b]&&(i.PhotographerHeading=parseFloat(a[b].PhotographerHeading),i.PhotographerPitch=parseFloat(a[b].PhotographerPitch)),g[c].push(i)}var j=[];for(c in g)j.push(g[c]);return j},svw.formatRecordsToLabels=svw.formatRecordsToGoldenLabels;var svw=svw||{},svw=svw||{},svw=svw||{},svw=svw||{},panorama;svw.panorama=panorama,svw.getPanoId=getPanoId,svw.getPosition=getPosition,svw.getPOV=getPOV,svw.getLinks=getLinks;var fogMode=!0,fogSet=!1,current,first,previousPoints=[],radius=.1,isNotfirst=0,paths;svw.fog=void 0;var au=[],pty=[],polys=[],svw=svw||{},svw=svw||{};svw.gsvImageCoordinate2CanvasCoordinate=function(a,b,c){var d,e,f=c.zoom,g=svw.svImageWidth*svw.zoomFactor[f],h=svw.svImageHeight*svw.zoomFactor[f];a*=svw.zoomFactor[f],b*=svw.zoomFactor[f],d=a-g*c.heading/360,d=d/svw.alpha_x+svw.canvasWidth/2;var i=360*svw.alpha_x*(svw.canvasWidth/2)/g+10;return c.heading<i?g-svw.alpha_x*(svw.canvasWidth/2)<a&&(d=a-g-g*c.heading/360,d=d/svw.alpha_x+svw.canvasWidth/2):c.heading>360-i&&svw.alpha_x*(svw.canvasWidth/2)>a&&(d=a+g-g*c.heading/360,d=d/svw.alpha_x+svw.canvasWidth/2),e=b-h/2*(c.pitch/90),e=e/svw.alpha_y+svw.canvasHeight/2,{x:d,y:e}},svw.zoomFactor={1:1,2:2.1,3:4,4:8,5:16};var svw=svw||{},svw=svw||{},svw=svw||{},svw=svw||{},svw=svw||{},svw=svw||{};